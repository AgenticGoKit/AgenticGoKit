<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head><script src="/AgenticGoKitDocs/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=AgenticGoKitDocs/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.148.1">
    <meta name="generator" content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862">
    <meta name="description" content="Testing Strategies for Multi-Agent Systems Comprehensive testing approaches for building reliable and maintainable agent systems
Testing multi-agent systems presents unique challenges due to their distributed nature, asynchronous communication, and external dependencies. This guide covers testing strategies, patterns, and tools specifically designed for AgenticGoKit applications.
🧪 Testing Pyramid for Agent Systems flowchart TDsubgraph &#34;End-to-End Tests (10%)&#34;E2E1[Full System Tests]E2E2[User Journey Tests]E2E3[Performance Tests]endsubgraph &#34;Integration Tests (30%)&#34;INT1[Agent Interaction Tests]INT2[External Service Tests]INT3[Orchestration Tests]INT4[Memory System Tests]INT5[MCP Tool Tests]endsubgraph &#34;Unit Tests (60%)&#34;UNIT1[Individual Agent Tests]UNIT2[Business Logic Tests]UNIT3[Utility Function Tests]UNIT4[Error Handling Tests]UNIT5[State Management Tests]endE2E1 --&gt; INT1E2E2 --&gt; INT2E2E3 --&gt; INT3INT1 --&gt; UNIT1INT2 --&gt; UNIT2INT3 --&gt; UNIT3INT4 --&gt; UNIT4INT5 --&gt; UNIT5classDef e2e fill:#ffebee,stroke:#c62828,stroke-width:2pxclassDef integration fill:#e8f5e8,stroke:#2e7d32,stroke-width:2pxclassDef unit fill:#e3f2fd,stroke:#1565c0,stroke-width:2pxclass E2E1,E2E2,E2E3 e2eclass INT1,INT2,INT3,INT4,INT5 integrationclass UNIT1,UNIT2,UNIT3,UNIT4,UNIT5 unit🔧 Unit Testing Strategies 1. Testing Individual Agents package agents import ( &#34;context&#34; &#34;testing&#34; &#34;time&#34; &#34;github.com/stretchr/testify/assert&#34; &#34;github.com/stretchr/testify/mock&#34; &#34;github.com/kunalkushwaha/agenticgokit/core&#34; ) // Mock LLM Provider for testing type MockLLMProvider struct { mock.Mock } func (m *MockLLMProvider) GenerateResponse(ctx context.Context, prompt string, options map[string]interface{}) (string, error) { args := m.Called(ctx, prompt, options) return args.String(0), args.Error(1) } func TestAnalyzerAgent_Execute(t *testing.T) { tests := []struct { name string event core.Event state *core.State mockResponse string mockError error expectedResult map[string]interface{} expectedError string }{ { name: &#34;successful analysis&#34;, event: core.NewEvent(&#34;analyze&#34;, map[string]interface{}{ &#34;data&#34;: &#34;Sample data to analyze&#34;, }), state: &amp;core.State{ SessionID: &#34;test-session&#34;, Data: map[string]interface{}{ &#34;context&#34;: &#34;test context&#34;, }, }, mockResponse: &#34;Analysis complete: The data shows positive trends&#34;, expectedResult: map[string]interface{}{ &#34;analysis&#34;: &#34;Analysis complete: The data shows positive trends&#34;, &#34;agent&#34;: &#34;analyzer&#34;, &#34;status&#34;: &#34;completed&#34;, }, }, { name: &#34;empty data handling&#34;, event: core.NewEvent(&#34;analyze&#34;, map[string]interface{}{ &#34;data&#34;: &#34;&#34;, }), state: &amp;core.State{SessionID: &#34;test-session&#34;}, expectedError: &#34;no data provided for analysis&#34;, }, { name: &#34;LLM provider error&#34;, event: core.NewEvent(&#34;analyze&#34;, map[string]interface{}{ &#34;data&#34;: &#34;Sample data&#34;, }), state: &amp;core.State{SessionID: &#34;test-session&#34;}, mockError: errors.New(&#34;LLM service unavailable&#34;), expectedError: &#34;LLM request failed: LLM service unavailable&#34;, }, } for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { // Setup mock mockProvider := new(MockLLMProvider) if tt.mockResponse != &#34;&#34; || tt.mockError != nil { mockProvider.On(&#34;GenerateResponse&#34;, mock.Anything, mock.AnythingOfType(&#34;string&#34;), mock.Anything). Return(tt.mockResponse, tt.mockError) } // Create agent with mock agent := NewAnalyzerAgent(&#34;analyzer&#34;, mockProvider) // Execute test result, err := agent.Execute(context.Background(), tt.event, tt.state) // Assertions if tt.expectedError != &#34;&#34; { assert.Error(t, err) assert.Contains(t, err.Error(), tt.expectedError) assert.Nil(t, result) } else { assert.NoError(t, err) assert.NotNil(t, result) for key, expectedValue := range tt.expectedResult { assert.Equal(t, expectedValue, result.Data[key]) } } // Verify mock expectations mockProvider.AssertExpectations(t) }) } }2. Testing State Management func TestStateTransformations(t *testing.T) { tests := []struct { name string initialState *core.State transformation func(*core.State) *core.State expectedData map[string]interface{} }{ { name: &#34;add analysis result&#34;, initialState: &amp;core.State{ SessionID: &#34;test&#34;, Data: map[string]interface{}{ &#34;input&#34;: &#34;test data&#34;, }, }, transformation: func(state *core.State) *core.State { newState := state.Clone() newState.Data[&#34;analysis&#34;] = &#34;completed&#34; newState.Data[&#34;confidence&#34;] = 0.95 return newState }, expectedData: map[string]interface{}{ &#34;input&#34;: &#34;test data&#34;, &#34;analysis&#34;: &#34;completed&#34;, &#34;confidence&#34;: 0.95, }, }, { name: &#34;merge states&#34;, initialState: &amp;core.State{ SessionID: &#34;test&#34;, Data: map[string]interface{}{ &#34;step1&#34;: &#34;completed&#34;, }, }, transformation: func(state *core.State) *core.State { additionalData := map[string]interface{}{ &#34;step2&#34;: &#34;completed&#34;, &#34;final&#34;: true, } return state.Merge(additionalData) }, expectedData: map[string]interface{}{ &#34;step1&#34;: &#34;completed&#34;, &#34;step2&#34;: &#34;completed&#34;, &#34;final&#34;: true, }, }, } for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { result := tt.transformation(tt.initialState) for key, expected := range tt.expectedData { assert.Equal(t, expected, result.Data[key]) } }) } }3. Testing Error Handling func TestErrorHandling(t *testing.T) { tests := []struct { name string setupMock func(*MockLLMProvider) expectedError string shouldRetry bool }{ { name: &#34;timeout error&#34;, setupMock: func(m *MockLLMProvider) { m.On(&#34;GenerateResponse&#34;, mock.Anything, mock.Anything, mock.Anything). Return(&#34;&#34;, context.DeadlineExceeded) }, expectedError: &#34;context deadline exceeded&#34;, shouldRetry: true, }, { name: &#34;rate limit error&#34;, setupMock: func(m *MockLLMProvider) { m.On(&#34;GenerateResponse&#34;, mock.Anything, mock.Anything, mock.Anything). Return(&#34;&#34;, errors.New(&#34;rate limit exceeded&#34;)) }, expectedError: &#34;rate limit exceeded&#34;, shouldRetry: true, }, { name: &#34;authentication error&#34;, setupMock: func(m *MockLLMProvider) { m.On(&#34;GenerateResponse&#34;, mock.Anything, mock.Anything, mock.Anything). Return(&#34;&#34;, errors.New(&#34;invalid API key&#34;)) }, expectedError: &#34;invalid API key&#34;, shouldRetry: false, }, } for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { mockProvider := new(MockLLMProvider) tt.setupMock(mockProvider) agent := NewResilientAgent(&#34;test&#34;, mockProvider) event := core.NewEvent(&#34;test&#34;, &#34;data&#34;) state := &amp;core.State{SessionID: &#34;test&#34;} _, err := agent.Execute(context.Background(), event, state) assert.Error(t, err) assert.Contains(t, err.Error(), tt.expectedError) // Test retry behavior if tt.shouldRetry { // Verify that retries were attempted assert.True(t, mockProvider.AssertNumberOfCalls(t, &#34;GenerateResponse&#34;, 3)) } else { // Verify that no retries were attempted assert.True(t, mockProvider.AssertNumberOfCalls(t, &#34;GenerateResponse&#34;, 1)) } }) } }🔗 Integration Testing 1. Testing Agent Interactions func TestAgentOrchestration(t *testing.T) { // Setup test agents mockProvider := new(MockLLMProvider) mockProvider.On(&#34;GenerateResponse&#34;, mock.Anything, mock.MatchedBy(func(prompt string) bool { return strings.Contains(prompt, &#34;analyze&#34;) }), mock.Anything).Return(&#34;Analysis: Data processed&#34;, nil) mockProvider.On(&#34;GenerateResponse&#34;, mock.Anything, mock.MatchedBy(func(prompt string) bool { return strings.Contains(prompt, &#34;validate&#34;) }), mock.Anything).Return(&#34;Validation: Data is valid&#34;, nil) analyzer := NewAnalyzerAgent(&#34;analyzer&#34;, mockProvider) validator := NewValidatorAgent(&#34;validator&#34;, mockProvider) // Create sequential runner agents := map[string]core.AgentHandler{ &#34;analyzer&#34;: analyzer, &#34;validator&#34;: validator, } config := core.RunnerConfig{ OrchestrationMode: core.OrchestrationSequential, SequentialAgents: []string{&#34;analyzer&#34;, &#34;validator&#34;}, Timeout: 30 * time.Second, } runner := core.NewRunnerWithConfig(config) for name, agent := range agents { runner.RegisterAgent(name, agent) } // Test sequential execution event := core.NewEvent(&#34;process&#34;, map[string]interface{}{ &#34;data&#34;: &#34;test data for processing&#34;, }) results, err := runner.ProcessEvent(context.Background(), event) assert.NoError(t, err) assert.Len(t, results, 2) // Verify execution order and data flow analyzerResult := results[0] validatorResult := results[1] assert.Equal(t, &#34;analyzer&#34;, analyzerResult.Agent) assert.Contains(t, analyzerResult.Data[&#34;analysis&#34;], &#34;Data processed&#34;) assert.Equal(t, &#34;validator&#34;, validatorResult.Agent) assert.Contains(t, validatorResult.Data[&#34;validation&#34;], &#34;Data is valid&#34;) }2. Testing Memory System Integration func TestMemorySystemIntegration(t *testing.T) { // Setup in-memory test database memoryProvider := memory.NewInMemoryProvider() // Create agent with memory agent := NewMemoryEnabledAgent(&#34;test-agent&#34;, mockLLMProvider, memoryProvider) // Test storing and retrieving memories t.Run(&#34;store and retrieve memory&#34;, func(t *testing.T) { event := core.NewEvent(&#34;remember&#34;, map[string]interface{}{ &#34;fact&#34;: &#34;The sky is blue&#34;, &#34;category&#34;: &#34;general_knowledge&#34;, }) state := &amp;core.State{ SessionID: &#34;test-session&#34;, UserID: &#34;test-user&#34;, } result, err := agent.Execute(context.Background(), event, state) assert.NoError(t, err) assert.Equal(t, &#34;stored&#34;, result.Data[&#34;status&#34;]) // Verify memory was stored memories, err := memoryProvider.Search(context.Background(), &#34;sky blue&#34;, 5) assert.NoError(t, err) assert.Len(t, memories, 1) assert.Contains(t, memories[0].Content, &#34;sky is blue&#34;) }) t.Run(&#34;RAG retrieval&#34;, func(t *testing.T) { // Setup mock to expect context from memory mockProvider.On(&#34;GenerateResponse&#34;, mock.Anything, mock.MatchedBy(func(prompt string) bool { return strings.Contains(prompt, &#34;sky is blue&#34;) }), mock.Anything).Return(&#34;Based on the stored knowledge, the sky appears blue due to light scattering&#34;, nil) event := core.NewEvent(&#34;query&#34;, map[string]interface{}{ &#34;question&#34;: &#34;What color is the sky?&#34;, }) state := &amp;core.State{SessionID: &#34;test-session&#34;} result, err := agent.Execute(context.Background(), event, state) assert.NoError(t, err) assert.Contains(t, result.Data[&#34;response&#34;], &#34;blue due to light scattering&#34;) }) }3. Testing MCP Tool Integration func TestMCPToolIntegration(t *testing.T) { // Setup mock MCP server mockServer := &amp;MockMCPServer{} mockServer.On(&#34;ExecuteTool&#34;, &#34;web_search&#34;, map[string]interface{}{ &#34;query&#34;: &#34;AgenticGoKit testing&#34;, }).Return(map[string]interface{}{ &#34;results&#34;: []string{&#34;AgenticGoKit is a Go framework for building multi-agent systems&#34;}, }, nil) // Create agent with MCP tools toolManager := mcp.NewToolManager() toolManager.RegisterServer(&#34;test-server&#34;, mockServer) agent := NewToolEnabledAgent(&#34;test-agent&#34;, mockLLMProvider, toolManager) event := core.NewEvent(&#34;search&#34;, map[string]interface{}{ &#34;query&#34;: &#34;AgenticGoKit testing&#34;, &#34;tool&#34;: &#34;web_search&#34;, }) state := &amp;core.State{SessionID: &#34;test-session&#34;} result, err := agent.Execute(context.Background(), event, state) assert.NoError(t, err) assert.Contains(t, result.Data[&#34;search_results&#34;], &#34;Go framework&#34;) mockServer.AssertExpectations(t) }🌐 End-to-End Testing 1. Full System Tests func TestFullSystemWorkflow(t *testing.T) { // Setup complete system system := setupTestSystem(t) defer system.Cleanup() // Test complete user workflow t.Run(&#34;research assistant workflow&#34;, func(t *testing.T) { // Step 1: User asks a question request := &amp;api.Request{ Type: &#34;research_query&#34;, Data: map[string]interface{}{ &#34;question&#34;: &#34;What are the latest developments in AI agent frameworks?&#34;, &#34;depth&#34;: &#34;comprehensive&#34;, }, UserID: &#34;test-user&#34;, SessionID: &#34;test-session&#34;, } response, err := system.ProcessRequest(context.Background(), request) assert.NoError(t, err) // Verify response structure assert.NotNil(t, response) assert.Equal(t, &#34;success&#34;, response.Status) assert.Contains(t, response.Data, &#34;research_results&#34;) assert.Contains(t, response.Data, &#34;sources&#34;) assert.Contains(t, response.Data, &#34;summary&#34;) // Verify agent execution trace trace := response.Trace assert.NotEmpty(t, trace) // Should have executed: researcher -&gt; analyzer -&gt; validator -&gt; formatter expectedAgents := []string{&#34;researcher&#34;, &#34;analyzer&#34;, &#34;validator&#34;, &#34;formatter&#34;} assert.Len(t, trace, len(expectedAgents)) for i, expectedAgent := range expectedAgents { assert.Equal(t, expectedAgent, trace[i].Agent) assert.Equal(t, &#34;completed&#34;, trace[i].Status) } }) t.Run(&#34;error handling workflow&#34;, func(t *testing.T) { // Simulate external service failure system.SimulateServiceFailure(&#34;web_search&#34;) request := &amp;api.Request{ Type: &#34;research_query&#34;, Data: map[string]interface{}{ &#34;question&#34;: &#34;Test question&#34;, }, UserID: &#34;test-user&#34;, SessionID: &#34;test-session-2&#34;, } response, err := system.ProcessRequest(context.Background(), request) // Should handle gracefully with fallback assert.NoError(t, err) assert.Equal(t, &#34;partial_success&#34;, response.Status) assert.Contains(t, response.Data, &#34;fallback_response&#34;) assert.Contains(t, response.Warnings, &#34;web search unavailable&#34;) }) }2. Performance Testing func TestSystemPerformance(t *testing.T) { system := setupTestSystem(t) defer system.Cleanup() t.Run(&#34;concurrent request handling&#34;, func(t *testing.T) { concurrency := 10 requestsPerWorker := 5 var wg sync.WaitGroup results := make(chan time.Duration, concurrency*requestsPerWorker) errors := make(chan error, concurrency*requestsPerWorker) for i := 0; i &lt; concurrency; i&#43;&#43; { wg.Add(1) go func(workerID int) { defer wg.Done() for j := 0; j &lt; requestsPerWorker; j&#43;&#43; { start := time.Now() request := &amp;api.Request{ Type: &#34;simple_query&#34;, Data: map[string]interface{}{ &#34;question&#34;: fmt.Sprintf(&#34;Test question %d-%d&#34;, workerID, j), }, UserID: fmt.Sprintf(&#34;user-%d&#34;, workerID), SessionID: fmt.Sprintf(&#34;session-%d-%d&#34;, workerID, j), } _, err := system.ProcessRequest(context.Background(), request) duration := time.Since(start) if err != nil { errors &lt;- err } else { results &lt;- duration } } }(i) } wg.Wait() close(results) close(errors) // Collect results var durations []time.Duration for duration := range results { durations = append(durations, duration) } var errorList []error for err := range errors { errorList = append(errorList, err) } // Assertions assert.Empty(t, errorList, &#34;No errors should occur during concurrent processing&#34;) assert.Len(t, durations, concurrency*requestsPerWorker) // Performance assertions avgDuration := calculateAverage(durations) maxDuration := calculateMax(durations) assert.Less(t, avgDuration, 5*time.Second, &#34;Average response time should be under 5 seconds&#34;) assert.Less(t, maxDuration, 10*time.Second, &#34;Max response time should be under 10 seconds&#34;) t.Logf(&#34;Performance results: avg=%v, max=%v, total_requests=%d&#34;, avgDuration, maxDuration, len(durations)) }) }🎭 Test Doubles and Mocking 1. Mock External Services type MockExternalService struct { mock.Mock responses map[string]interface{} delays map[string]time.Duration failures map[string]error } func NewMockExternalService() *MockExternalService { return &amp;MockExternalService{ responses: make(map[string]interface{}), delays: make(map[string]time.Duration), failures: make(map[string]error), } } func (m *MockExternalService) SetResponse(endpoint string, response interface{}) { m.responses[endpoint] = response } func (m *MockExternalService) SetDelay(endpoint string, delay time.Duration) { m.delays[endpoint] = delay } func (m *MockExternalService) SetFailure(endpoint string, err error) { m.failures[endpoint] = err } func (m *MockExternalService) Call(ctx context.Context, endpoint string, params map[string]interface{}) (interface{}, error) { // Simulate delay if delay, exists := m.delays[endpoint]; exists { select { case &lt;-time.After(delay): case &lt;-ctx.Done(): return nil, ctx.Err() } } // Simulate failure if err, exists := m.failures[endpoint]; exists { return nil, err } // Return mock response if response, exists := m.responses[endpoint]; exists { return response, nil } return nil, errors.New(&#34;endpoint not mocked&#34;) }2. Test Fixtures and Builders type TestSystemBuilder struct { agents map[string]core.AgentHandler mockServices map[string]*MockExternalService config core.RunnerConfig } func NewTestSystemBuilder() *TestSystemBuilder { return &amp;TestSystemBuilder{ agents: make(map[string]core.AgentHandler), mockServices: make(map[string]*MockExternalService), config: core.RunnerConfig{ OrchestrationMode: core.OrchestrationSequential, Timeout: 30 * time.Second, }, } } func (b *TestSystemBuilder) WithAgent(name string, agent core.AgentHandler) *TestSystemBuilder { b.agents[name] = agent return b } func (b *TestSystemBuilder) WithMockService(name string, service *MockExternalService) *TestSystemBuilder { b.mockServices[name] = service return b } func (b *TestSystemBuilder) WithOrchestration(mode core.OrchestrationMode, agents []string) *TestSystemBuilder { b.config.OrchestrationMode = mode switch mode { case core.OrchestrationSequential: b.config.SequentialAgents = agents case core.OrchestrationCollaborative: b.config.CollaborativeAgents = agents } return b } func (b *TestSystemBuilder) Build() *TestSystem { runner := core.NewRunnerWithConfig(b.config) for name, agent := range b.agents { runner.RegisterAgent(name, agent) } return &amp;TestSystem{ runner: runner, mockServices: b.mockServices, } } type TestSystem struct { runner core.Runner mockServices map[string]*MockExternalService } func (ts *TestSystem) ProcessRequest(ctx context.Context, request *api.Request) (*api.Response, error) { event := core.NewEvent(request.Type, request.Data) state := &amp;core.State{ SessionID: request.SessionID, UserID: request.UserID, } results, err := ts.runner.ProcessEvent(ctx, event) if err != nil { return nil, err } return &amp;api.Response{ Status: &#34;success&#34;, Data: results[len(results)-1].Data, Trace: convertToTrace(results), }, nil } func (ts *TestSystem) SimulateServiceFailure(serviceName string) { if service, exists := ts.mockServices[serviceName]; exists { service.SetFailure(&#34;*&#34;, errors.New(&#34;simulated service failure&#34;)) } } func (ts *TestSystem) Cleanup() { // Cleanup resources for _, service := range ts.mockServices { service.AssertExpectations(&amp;testing.T{}) } }📊 Test Data Management 1. Test Data Builders type EventBuilder struct { eventType string data map[string]interface{} metadata map[string]interface{} } func NewEventBuilder(eventType string) *EventBuilder { return &amp;EventBuilder{ eventType: eventType, data: make(map[string]interface{}), metadata: make(map[string]interface{}), } } func (b *EventBuilder) WithData(key string, value interface{}) *EventBuilder { b.data[key] = value return b } func (b *EventBuilder) WithMetadata(key string, value interface{}) *EventBuilder { b.metadata[key] = value return b } func (b *EventBuilder) Build() core.Event { event := core.NewEvent(b.eventType, b.data) for key, value := range b.metadata { event.Metadata[key] = value } return event } type StateBuilder struct { sessionID string userID string data map[string]interface{} } func NewStateBuilder() *StateBuilder { return &amp;StateBuilder{ data: make(map[string]interface{}), } } func (b *StateBuilder) WithSession(sessionID string) *StateBuilder { b.sessionID = sessionID return b } func (b *StateBuilder) WithUser(userID string) *StateBuilder { b.userID = userID return b } func (b *StateBuilder) WithData(key string, value interface{}) *StateBuilder { b.data[key] = value return b } func (b *StateBuilder) Build() *core.State { return &amp;core.State{ SessionID: b.sessionID, UserID: b.userID, Data: b.data, } }2. Test Scenarios func TestCommonScenarios(t *testing.T) { scenarios := []struct { name string setup func() (*TestSystem, core.Event, *core.State) validate func(*testing.T, *core.AgentResult, error) }{ { name: &#34;successful_analysis&#34;, setup: func() (*TestSystem, core.Event, *core.State) { system := NewTestSystemBuilder(). WithAgent(&#34;analyzer&#34;, NewMockAnalyzer(&#34;success&#34;)). Build() event := NewEventBuilder(&#34;analyze&#34;). WithData(&#34;content&#34;, &#34;test data&#34;). Build() state := NewStateBuilder(). WithSession(&#34;test-session&#34;). Build() return system, event, state }, validate: func(t *testing.T, result *core.AgentResult, err error) { assert.NoError(t, err) assert.Equal(t, &#34;completed&#34;, result.Data[&#34;status&#34;]) }, }, { name: &#34;timeout_handling&#34;, setup: func() (*TestSystem, core.Event, *core.State) { system := NewTestSystemBuilder(). WithAgent(&#34;slow_agent&#34;, NewSlowMockAgent(10*time.Second)). Build() event := NewEventBuilder(&#34;process&#34;). WithData(&#34;timeout&#34;, &#34;5s&#34;). Build() state := NewStateBuilder(). WithSession(&#34;timeout-test&#34;). Build() return system, event, state }, validate: func(t *testing.T, result *core.AgentResult, err error) { assert.Error(t, err) assert.Contains(t, err.Error(), &#34;timeout&#34;) }, }, } for _, scenario := range scenarios { t.Run(scenario.name, func(t *testing.T) { system, event, state := scenario.setup() defer system.Cleanup() result, err := system.ProcessSingleEvent(context.Background(), event, state) scenario.validate(t, result, err) }) } }🎯 Best Practices 1. Test Organization // Package structure for tests // agents/ // analyzer_test.go - Unit tests for analyzer agent // validator_test.go - Unit tests for validator agent // integration_test.go - Integration tests between agents // orchestration/ // sequential_test.go - Sequential orchestration tests // collaborative_test.go - Collaborative orchestration tests // system/ // e2e_test.go - End-to-end system tests // performance_test.go - Performance and load tests // testutils/ // builders.go - Test data builders // mocks.go - Mock implementations // fixtures.go - Test fixtures and helpers2. Test Configuration // Test configuration management type TestConfig struct { DatabaseURL string RedisURL string MockServices bool LogLevel string TestTimeout time.Duration } func LoadTestConfig() *TestConfig { return &amp;TestConfig{ DatabaseURL: getEnvOrDefault(&#34;TEST_DATABASE_URL&#34;, &#34;postgres://localhost/agentflow_test&#34;), RedisURL: getEnvOrDefault(&#34;TEST_REDIS_URL&#34;, &#34;redis://localhost:6379/1&#34;), MockServices: getEnvOrDefault(&#34;MOCK_SERVICES&#34;, &#34;true&#34;) == &#34;true&#34;, LogLevel: getEnvOrDefault(&#34;TEST_LOG_LEVEL&#34;, &#34;error&#34;), TestTimeout: 30 * time.Second, } }3. Continuous Integration # .github/workflows/test.yml name: Test Suite on: [push, pull_request] jobs: unit-tests: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - uses: actions/setup-go@v3 with: go-version: &#39;1.21&#39; - name: Run unit tests run: go test -v -race -coverprofile=coverage.out ./... - name: Upload coverage uses: codecov/codecov-action@v3 integration-tests: runs-on: ubuntu-latest services: postgres: image: pgvector/pgvector:pg15 env: POSTGRES_PASSWORD: test POSTGRES_DB: agentflow_test options: &gt;- --health-cmd pg_isready --health-interval 10s --health-timeout 5s --health-retries 5 redis: image: redis:7-alpine options: &gt;- --health-cmd &#34;redis-cli ping&#34; --health-interval 10s --health-timeout 5s --health-retries 5 steps: - uses: actions/checkout@v3 - uses: actions/setup-go@v3 with: go-version: &#39;1.21&#39; - name: Run integration tests run: go test -v -tags=integration ./... env: TEST_DATABASE_URL: postgres://postgres:test@localhost:5432/agentflow_test TEST_REDIS_URL: redis://localhost:6379/1 e2e-tests: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - uses: actions/setup-go@v3 with: go-version: &#39;1.21&#39; - name: Start test environment run: docker-compose -f docker-compose.test.yml up -d - name: Wait for services run: ./scripts/wait-for-services.sh - name: Run E2E tests run: go test -v -tags=e2e ./... - name: Cleanup run: docker-compose -f docker-compose.test.yml downTesting multi-agent systems requires a comprehensive approach that covers unit, integration, and end-to-end scenarios. By following these strategies and patterns, you can build reliable and maintainable agent systems with confidence.">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="testing-strategies :: AgenticGoKit Docs">
    <meta name="twitter:description" content="Testing Strategies for Multi-Agent Systems Comprehensive testing approaches for building reliable and maintainable agent systems
Testing multi-agent systems presents unique challenges due to their distributed nature, asynchronous communication, and external dependencies. This guide covers testing strategies, patterns, and tools specifically designed for AgenticGoKit applications.
🧪 Testing Pyramid for Agent Systems flowchart TDsubgraph &#34;End-to-End Tests (10%)&#34;E2E1[Full System Tests]E2E2[User Journey Tests]E2E3[Performance Tests]endsubgraph &#34;Integration Tests (30%)&#34;INT1[Agent Interaction Tests]INT2[External Service Tests]INT3[Orchestration Tests]INT4[Memory System Tests]INT5[MCP Tool Tests]endsubgraph &#34;Unit Tests (60%)&#34;UNIT1[Individual Agent Tests]UNIT2[Business Logic Tests]UNIT3[Utility Function Tests]UNIT4[Error Handling Tests]UNIT5[State Management Tests]endE2E1 --&gt; INT1E2E2 --&gt; INT2E2E3 --&gt; INT3INT1 --&gt; UNIT1INT2 --&gt; UNIT2INT3 --&gt; UNIT3INT4 --&gt; UNIT4INT5 --&gt; UNIT5classDef e2e fill:#ffebee,stroke:#c62828,stroke-width:2pxclassDef integration fill:#e8f5e8,stroke:#2e7d32,stroke-width:2pxclassDef unit fill:#e3f2fd,stroke:#1565c0,stroke-width:2pxclass E2E1,E2E2,E2E3 e2eclass INT1,INT2,INT3,INT4,INT5 integrationclass UNIT1,UNIT2,UNIT3,UNIT4,UNIT5 unit🔧 Unit Testing Strategies 1. Testing Individual Agents package agents import ( &#34;context&#34; &#34;testing&#34; &#34;time&#34; &#34;github.com/stretchr/testify/assert&#34; &#34;github.com/stretchr/testify/mock&#34; &#34;github.com/kunalkushwaha/agenticgokit/core&#34; ) // Mock LLM Provider for testing type MockLLMProvider struct { mock.Mock } func (m *MockLLMProvider) GenerateResponse(ctx context.Context, prompt string, options map[string]interface{}) (string, error) { args := m.Called(ctx, prompt, options) return args.String(0), args.Error(1) } func TestAnalyzerAgent_Execute(t *testing.T) { tests := []struct { name string event core.Event state *core.State mockResponse string mockError error expectedResult map[string]interface{} expectedError string }{ { name: &#34;successful analysis&#34;, event: core.NewEvent(&#34;analyze&#34;, map[string]interface{}{ &#34;data&#34;: &#34;Sample data to analyze&#34;, }), state: &amp;core.State{ SessionID: &#34;test-session&#34;, Data: map[string]interface{}{ &#34;context&#34;: &#34;test context&#34;, }, }, mockResponse: &#34;Analysis complete: The data shows positive trends&#34;, expectedResult: map[string]interface{}{ &#34;analysis&#34;: &#34;Analysis complete: The data shows positive trends&#34;, &#34;agent&#34;: &#34;analyzer&#34;, &#34;status&#34;: &#34;completed&#34;, }, }, { name: &#34;empty data handling&#34;, event: core.NewEvent(&#34;analyze&#34;, map[string]interface{}{ &#34;data&#34;: &#34;&#34;, }), state: &amp;core.State{SessionID: &#34;test-session&#34;}, expectedError: &#34;no data provided for analysis&#34;, }, { name: &#34;LLM provider error&#34;, event: core.NewEvent(&#34;analyze&#34;, map[string]interface{}{ &#34;data&#34;: &#34;Sample data&#34;, }), state: &amp;core.State{SessionID: &#34;test-session&#34;}, mockError: errors.New(&#34;LLM service unavailable&#34;), expectedError: &#34;LLM request failed: LLM service unavailable&#34;, }, } for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { // Setup mock mockProvider := new(MockLLMProvider) if tt.mockResponse != &#34;&#34; || tt.mockError != nil { mockProvider.On(&#34;GenerateResponse&#34;, mock.Anything, mock.AnythingOfType(&#34;string&#34;), mock.Anything). Return(tt.mockResponse, tt.mockError) } // Create agent with mock agent := NewAnalyzerAgent(&#34;analyzer&#34;, mockProvider) // Execute test result, err := agent.Execute(context.Background(), tt.event, tt.state) // Assertions if tt.expectedError != &#34;&#34; { assert.Error(t, err) assert.Contains(t, err.Error(), tt.expectedError) assert.Nil(t, result) } else { assert.NoError(t, err) assert.NotNil(t, result) for key, expectedValue := range tt.expectedResult { assert.Equal(t, expectedValue, result.Data[key]) } } // Verify mock expectations mockProvider.AssertExpectations(t) }) } }2. Testing State Management func TestStateTransformations(t *testing.T) { tests := []struct { name string initialState *core.State transformation func(*core.State) *core.State expectedData map[string]interface{} }{ { name: &#34;add analysis result&#34;, initialState: &amp;core.State{ SessionID: &#34;test&#34;, Data: map[string]interface{}{ &#34;input&#34;: &#34;test data&#34;, }, }, transformation: func(state *core.State) *core.State { newState := state.Clone() newState.Data[&#34;analysis&#34;] = &#34;completed&#34; newState.Data[&#34;confidence&#34;] = 0.95 return newState }, expectedData: map[string]interface{}{ &#34;input&#34;: &#34;test data&#34;, &#34;analysis&#34;: &#34;completed&#34;, &#34;confidence&#34;: 0.95, }, }, { name: &#34;merge states&#34;, initialState: &amp;core.State{ SessionID: &#34;test&#34;, Data: map[string]interface{}{ &#34;step1&#34;: &#34;completed&#34;, }, }, transformation: func(state *core.State) *core.State { additionalData := map[string]interface{}{ &#34;step2&#34;: &#34;completed&#34;, &#34;final&#34;: true, } return state.Merge(additionalData) }, expectedData: map[string]interface{}{ &#34;step1&#34;: &#34;completed&#34;, &#34;step2&#34;: &#34;completed&#34;, &#34;final&#34;: true, }, }, } for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { result := tt.transformation(tt.initialState) for key, expected := range tt.expectedData { assert.Equal(t, expected, result.Data[key]) } }) } }3. Testing Error Handling func TestErrorHandling(t *testing.T) { tests := []struct { name string setupMock func(*MockLLMProvider) expectedError string shouldRetry bool }{ { name: &#34;timeout error&#34;, setupMock: func(m *MockLLMProvider) { m.On(&#34;GenerateResponse&#34;, mock.Anything, mock.Anything, mock.Anything). Return(&#34;&#34;, context.DeadlineExceeded) }, expectedError: &#34;context deadline exceeded&#34;, shouldRetry: true, }, { name: &#34;rate limit error&#34;, setupMock: func(m *MockLLMProvider) { m.On(&#34;GenerateResponse&#34;, mock.Anything, mock.Anything, mock.Anything). Return(&#34;&#34;, errors.New(&#34;rate limit exceeded&#34;)) }, expectedError: &#34;rate limit exceeded&#34;, shouldRetry: true, }, { name: &#34;authentication error&#34;, setupMock: func(m *MockLLMProvider) { m.On(&#34;GenerateResponse&#34;, mock.Anything, mock.Anything, mock.Anything). Return(&#34;&#34;, errors.New(&#34;invalid API key&#34;)) }, expectedError: &#34;invalid API key&#34;, shouldRetry: false, }, } for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { mockProvider := new(MockLLMProvider) tt.setupMock(mockProvider) agent := NewResilientAgent(&#34;test&#34;, mockProvider) event := core.NewEvent(&#34;test&#34;, &#34;data&#34;) state := &amp;core.State{SessionID: &#34;test&#34;} _, err := agent.Execute(context.Background(), event, state) assert.Error(t, err) assert.Contains(t, err.Error(), tt.expectedError) // Test retry behavior if tt.shouldRetry { // Verify that retries were attempted assert.True(t, mockProvider.AssertNumberOfCalls(t, &#34;GenerateResponse&#34;, 3)) } else { // Verify that no retries were attempted assert.True(t, mockProvider.AssertNumberOfCalls(t, &#34;GenerateResponse&#34;, 1)) } }) } }🔗 Integration Testing 1. Testing Agent Interactions func TestAgentOrchestration(t *testing.T) { // Setup test agents mockProvider := new(MockLLMProvider) mockProvider.On(&#34;GenerateResponse&#34;, mock.Anything, mock.MatchedBy(func(prompt string) bool { return strings.Contains(prompt, &#34;analyze&#34;) }), mock.Anything).Return(&#34;Analysis: Data processed&#34;, nil) mockProvider.On(&#34;GenerateResponse&#34;, mock.Anything, mock.MatchedBy(func(prompt string) bool { return strings.Contains(prompt, &#34;validate&#34;) }), mock.Anything).Return(&#34;Validation: Data is valid&#34;, nil) analyzer := NewAnalyzerAgent(&#34;analyzer&#34;, mockProvider) validator := NewValidatorAgent(&#34;validator&#34;, mockProvider) // Create sequential runner agents := map[string]core.AgentHandler{ &#34;analyzer&#34;: analyzer, &#34;validator&#34;: validator, } config := core.RunnerConfig{ OrchestrationMode: core.OrchestrationSequential, SequentialAgents: []string{&#34;analyzer&#34;, &#34;validator&#34;}, Timeout: 30 * time.Second, } runner := core.NewRunnerWithConfig(config) for name, agent := range agents { runner.RegisterAgent(name, agent) } // Test sequential execution event := core.NewEvent(&#34;process&#34;, map[string]interface{}{ &#34;data&#34;: &#34;test data for processing&#34;, }) results, err := runner.ProcessEvent(context.Background(), event) assert.NoError(t, err) assert.Len(t, results, 2) // Verify execution order and data flow analyzerResult := results[0] validatorResult := results[1] assert.Equal(t, &#34;analyzer&#34;, analyzerResult.Agent) assert.Contains(t, analyzerResult.Data[&#34;analysis&#34;], &#34;Data processed&#34;) assert.Equal(t, &#34;validator&#34;, validatorResult.Agent) assert.Contains(t, validatorResult.Data[&#34;validation&#34;], &#34;Data is valid&#34;) }2. Testing Memory System Integration func TestMemorySystemIntegration(t *testing.T) { // Setup in-memory test database memoryProvider := memory.NewInMemoryProvider() // Create agent with memory agent := NewMemoryEnabledAgent(&#34;test-agent&#34;, mockLLMProvider, memoryProvider) // Test storing and retrieving memories t.Run(&#34;store and retrieve memory&#34;, func(t *testing.T) { event := core.NewEvent(&#34;remember&#34;, map[string]interface{}{ &#34;fact&#34;: &#34;The sky is blue&#34;, &#34;category&#34;: &#34;general_knowledge&#34;, }) state := &amp;core.State{ SessionID: &#34;test-session&#34;, UserID: &#34;test-user&#34;, } result, err := agent.Execute(context.Background(), event, state) assert.NoError(t, err) assert.Equal(t, &#34;stored&#34;, result.Data[&#34;status&#34;]) // Verify memory was stored memories, err := memoryProvider.Search(context.Background(), &#34;sky blue&#34;, 5) assert.NoError(t, err) assert.Len(t, memories, 1) assert.Contains(t, memories[0].Content, &#34;sky is blue&#34;) }) t.Run(&#34;RAG retrieval&#34;, func(t *testing.T) { // Setup mock to expect context from memory mockProvider.On(&#34;GenerateResponse&#34;, mock.Anything, mock.MatchedBy(func(prompt string) bool { return strings.Contains(prompt, &#34;sky is blue&#34;) }), mock.Anything).Return(&#34;Based on the stored knowledge, the sky appears blue due to light scattering&#34;, nil) event := core.NewEvent(&#34;query&#34;, map[string]interface{}{ &#34;question&#34;: &#34;What color is the sky?&#34;, }) state := &amp;core.State{SessionID: &#34;test-session&#34;} result, err := agent.Execute(context.Background(), event, state) assert.NoError(t, err) assert.Contains(t, result.Data[&#34;response&#34;], &#34;blue due to light scattering&#34;) }) }3. Testing MCP Tool Integration func TestMCPToolIntegration(t *testing.T) { // Setup mock MCP server mockServer := &amp;MockMCPServer{} mockServer.On(&#34;ExecuteTool&#34;, &#34;web_search&#34;, map[string]interface{}{ &#34;query&#34;: &#34;AgenticGoKit testing&#34;, }).Return(map[string]interface{}{ &#34;results&#34;: []string{&#34;AgenticGoKit is a Go framework for building multi-agent systems&#34;}, }, nil) // Create agent with MCP tools toolManager := mcp.NewToolManager() toolManager.RegisterServer(&#34;test-server&#34;, mockServer) agent := NewToolEnabledAgent(&#34;test-agent&#34;, mockLLMProvider, toolManager) event := core.NewEvent(&#34;search&#34;, map[string]interface{}{ &#34;query&#34;: &#34;AgenticGoKit testing&#34;, &#34;tool&#34;: &#34;web_search&#34;, }) state := &amp;core.State{SessionID: &#34;test-session&#34;} result, err := agent.Execute(context.Background(), event, state) assert.NoError(t, err) assert.Contains(t, result.Data[&#34;search_results&#34;], &#34;Go framework&#34;) mockServer.AssertExpectations(t) }🌐 End-to-End Testing 1. Full System Tests func TestFullSystemWorkflow(t *testing.T) { // Setup complete system system := setupTestSystem(t) defer system.Cleanup() // Test complete user workflow t.Run(&#34;research assistant workflow&#34;, func(t *testing.T) { // Step 1: User asks a question request := &amp;api.Request{ Type: &#34;research_query&#34;, Data: map[string]interface{}{ &#34;question&#34;: &#34;What are the latest developments in AI agent frameworks?&#34;, &#34;depth&#34;: &#34;comprehensive&#34;, }, UserID: &#34;test-user&#34;, SessionID: &#34;test-session&#34;, } response, err := system.ProcessRequest(context.Background(), request) assert.NoError(t, err) // Verify response structure assert.NotNil(t, response) assert.Equal(t, &#34;success&#34;, response.Status) assert.Contains(t, response.Data, &#34;research_results&#34;) assert.Contains(t, response.Data, &#34;sources&#34;) assert.Contains(t, response.Data, &#34;summary&#34;) // Verify agent execution trace trace := response.Trace assert.NotEmpty(t, trace) // Should have executed: researcher -&gt; analyzer -&gt; validator -&gt; formatter expectedAgents := []string{&#34;researcher&#34;, &#34;analyzer&#34;, &#34;validator&#34;, &#34;formatter&#34;} assert.Len(t, trace, len(expectedAgents)) for i, expectedAgent := range expectedAgents { assert.Equal(t, expectedAgent, trace[i].Agent) assert.Equal(t, &#34;completed&#34;, trace[i].Status) } }) t.Run(&#34;error handling workflow&#34;, func(t *testing.T) { // Simulate external service failure system.SimulateServiceFailure(&#34;web_search&#34;) request := &amp;api.Request{ Type: &#34;research_query&#34;, Data: map[string]interface{}{ &#34;question&#34;: &#34;Test question&#34;, }, UserID: &#34;test-user&#34;, SessionID: &#34;test-session-2&#34;, } response, err := system.ProcessRequest(context.Background(), request) // Should handle gracefully with fallback assert.NoError(t, err) assert.Equal(t, &#34;partial_success&#34;, response.Status) assert.Contains(t, response.Data, &#34;fallback_response&#34;) assert.Contains(t, response.Warnings, &#34;web search unavailable&#34;) }) }2. Performance Testing func TestSystemPerformance(t *testing.T) { system := setupTestSystem(t) defer system.Cleanup() t.Run(&#34;concurrent request handling&#34;, func(t *testing.T) { concurrency := 10 requestsPerWorker := 5 var wg sync.WaitGroup results := make(chan time.Duration, concurrency*requestsPerWorker) errors := make(chan error, concurrency*requestsPerWorker) for i := 0; i &lt; concurrency; i&#43;&#43; { wg.Add(1) go func(workerID int) { defer wg.Done() for j := 0; j &lt; requestsPerWorker; j&#43;&#43; { start := time.Now() request := &amp;api.Request{ Type: &#34;simple_query&#34;, Data: map[string]interface{}{ &#34;question&#34;: fmt.Sprintf(&#34;Test question %d-%d&#34;, workerID, j), }, UserID: fmt.Sprintf(&#34;user-%d&#34;, workerID), SessionID: fmt.Sprintf(&#34;session-%d-%d&#34;, workerID, j), } _, err := system.ProcessRequest(context.Background(), request) duration := time.Since(start) if err != nil { errors &lt;- err } else { results &lt;- duration } } }(i) } wg.Wait() close(results) close(errors) // Collect results var durations []time.Duration for duration := range results { durations = append(durations, duration) } var errorList []error for err := range errors { errorList = append(errorList, err) } // Assertions assert.Empty(t, errorList, &#34;No errors should occur during concurrent processing&#34;) assert.Len(t, durations, concurrency*requestsPerWorker) // Performance assertions avgDuration := calculateAverage(durations) maxDuration := calculateMax(durations) assert.Less(t, avgDuration, 5*time.Second, &#34;Average response time should be under 5 seconds&#34;) assert.Less(t, maxDuration, 10*time.Second, &#34;Max response time should be under 10 seconds&#34;) t.Logf(&#34;Performance results: avg=%v, max=%v, total_requests=%d&#34;, avgDuration, maxDuration, len(durations)) }) }🎭 Test Doubles and Mocking 1. Mock External Services type MockExternalService struct { mock.Mock responses map[string]interface{} delays map[string]time.Duration failures map[string]error } func NewMockExternalService() *MockExternalService { return &amp;MockExternalService{ responses: make(map[string]interface{}), delays: make(map[string]time.Duration), failures: make(map[string]error), } } func (m *MockExternalService) SetResponse(endpoint string, response interface{}) { m.responses[endpoint] = response } func (m *MockExternalService) SetDelay(endpoint string, delay time.Duration) { m.delays[endpoint] = delay } func (m *MockExternalService) SetFailure(endpoint string, err error) { m.failures[endpoint] = err } func (m *MockExternalService) Call(ctx context.Context, endpoint string, params map[string]interface{}) (interface{}, error) { // Simulate delay if delay, exists := m.delays[endpoint]; exists { select { case &lt;-time.After(delay): case &lt;-ctx.Done(): return nil, ctx.Err() } } // Simulate failure if err, exists := m.failures[endpoint]; exists { return nil, err } // Return mock response if response, exists := m.responses[endpoint]; exists { return response, nil } return nil, errors.New(&#34;endpoint not mocked&#34;) }2. Test Fixtures and Builders type TestSystemBuilder struct { agents map[string]core.AgentHandler mockServices map[string]*MockExternalService config core.RunnerConfig } func NewTestSystemBuilder() *TestSystemBuilder { return &amp;TestSystemBuilder{ agents: make(map[string]core.AgentHandler), mockServices: make(map[string]*MockExternalService), config: core.RunnerConfig{ OrchestrationMode: core.OrchestrationSequential, Timeout: 30 * time.Second, }, } } func (b *TestSystemBuilder) WithAgent(name string, agent core.AgentHandler) *TestSystemBuilder { b.agents[name] = agent return b } func (b *TestSystemBuilder) WithMockService(name string, service *MockExternalService) *TestSystemBuilder { b.mockServices[name] = service return b } func (b *TestSystemBuilder) WithOrchestration(mode core.OrchestrationMode, agents []string) *TestSystemBuilder { b.config.OrchestrationMode = mode switch mode { case core.OrchestrationSequential: b.config.SequentialAgents = agents case core.OrchestrationCollaborative: b.config.CollaborativeAgents = agents } return b } func (b *TestSystemBuilder) Build() *TestSystem { runner := core.NewRunnerWithConfig(b.config) for name, agent := range b.agents { runner.RegisterAgent(name, agent) } return &amp;TestSystem{ runner: runner, mockServices: b.mockServices, } } type TestSystem struct { runner core.Runner mockServices map[string]*MockExternalService } func (ts *TestSystem) ProcessRequest(ctx context.Context, request *api.Request) (*api.Response, error) { event := core.NewEvent(request.Type, request.Data) state := &amp;core.State{ SessionID: request.SessionID, UserID: request.UserID, } results, err := ts.runner.ProcessEvent(ctx, event) if err != nil { return nil, err } return &amp;api.Response{ Status: &#34;success&#34;, Data: results[len(results)-1].Data, Trace: convertToTrace(results), }, nil } func (ts *TestSystem) SimulateServiceFailure(serviceName string) { if service, exists := ts.mockServices[serviceName]; exists { service.SetFailure(&#34;*&#34;, errors.New(&#34;simulated service failure&#34;)) } } func (ts *TestSystem) Cleanup() { // Cleanup resources for _, service := range ts.mockServices { service.AssertExpectations(&amp;testing.T{}) } }📊 Test Data Management 1. Test Data Builders type EventBuilder struct { eventType string data map[string]interface{} metadata map[string]interface{} } func NewEventBuilder(eventType string) *EventBuilder { return &amp;EventBuilder{ eventType: eventType, data: make(map[string]interface{}), metadata: make(map[string]interface{}), } } func (b *EventBuilder) WithData(key string, value interface{}) *EventBuilder { b.data[key] = value return b } func (b *EventBuilder) WithMetadata(key string, value interface{}) *EventBuilder { b.metadata[key] = value return b } func (b *EventBuilder) Build() core.Event { event := core.NewEvent(b.eventType, b.data) for key, value := range b.metadata { event.Metadata[key] = value } return event } type StateBuilder struct { sessionID string userID string data map[string]interface{} } func NewStateBuilder() *StateBuilder { return &amp;StateBuilder{ data: make(map[string]interface{}), } } func (b *StateBuilder) WithSession(sessionID string) *StateBuilder { b.sessionID = sessionID return b } func (b *StateBuilder) WithUser(userID string) *StateBuilder { b.userID = userID return b } func (b *StateBuilder) WithData(key string, value interface{}) *StateBuilder { b.data[key] = value return b } func (b *StateBuilder) Build() *core.State { return &amp;core.State{ SessionID: b.sessionID, UserID: b.userID, Data: b.data, } }2. Test Scenarios func TestCommonScenarios(t *testing.T) { scenarios := []struct { name string setup func() (*TestSystem, core.Event, *core.State) validate func(*testing.T, *core.AgentResult, error) }{ { name: &#34;successful_analysis&#34;, setup: func() (*TestSystem, core.Event, *core.State) { system := NewTestSystemBuilder(). WithAgent(&#34;analyzer&#34;, NewMockAnalyzer(&#34;success&#34;)). Build() event := NewEventBuilder(&#34;analyze&#34;). WithData(&#34;content&#34;, &#34;test data&#34;). Build() state := NewStateBuilder(). WithSession(&#34;test-session&#34;). Build() return system, event, state }, validate: func(t *testing.T, result *core.AgentResult, err error) { assert.NoError(t, err) assert.Equal(t, &#34;completed&#34;, result.Data[&#34;status&#34;]) }, }, { name: &#34;timeout_handling&#34;, setup: func() (*TestSystem, core.Event, *core.State) { system := NewTestSystemBuilder(). WithAgent(&#34;slow_agent&#34;, NewSlowMockAgent(10*time.Second)). Build() event := NewEventBuilder(&#34;process&#34;). WithData(&#34;timeout&#34;, &#34;5s&#34;). Build() state := NewStateBuilder(). WithSession(&#34;timeout-test&#34;). Build() return system, event, state }, validate: func(t *testing.T, result *core.AgentResult, err error) { assert.Error(t, err) assert.Contains(t, err.Error(), &#34;timeout&#34;) }, }, } for _, scenario := range scenarios { t.Run(scenario.name, func(t *testing.T) { system, event, state := scenario.setup() defer system.Cleanup() result, err := system.ProcessSingleEvent(context.Background(), event, state) scenario.validate(t, result, err) }) } }🎯 Best Practices 1. Test Organization // Package structure for tests // agents/ // analyzer_test.go - Unit tests for analyzer agent // validator_test.go - Unit tests for validator agent // integration_test.go - Integration tests between agents // orchestration/ // sequential_test.go - Sequential orchestration tests // collaborative_test.go - Collaborative orchestration tests // system/ // e2e_test.go - End-to-end system tests // performance_test.go - Performance and load tests // testutils/ // builders.go - Test data builders // mocks.go - Mock implementations // fixtures.go - Test fixtures and helpers2. Test Configuration // Test configuration management type TestConfig struct { DatabaseURL string RedisURL string MockServices bool LogLevel string TestTimeout time.Duration } func LoadTestConfig() *TestConfig { return &amp;TestConfig{ DatabaseURL: getEnvOrDefault(&#34;TEST_DATABASE_URL&#34;, &#34;postgres://localhost/agentflow_test&#34;), RedisURL: getEnvOrDefault(&#34;TEST_REDIS_URL&#34;, &#34;redis://localhost:6379/1&#34;), MockServices: getEnvOrDefault(&#34;MOCK_SERVICES&#34;, &#34;true&#34;) == &#34;true&#34;, LogLevel: getEnvOrDefault(&#34;TEST_LOG_LEVEL&#34;, &#34;error&#34;), TestTimeout: 30 * time.Second, } }3. Continuous Integration # .github/workflows/test.yml name: Test Suite on: [push, pull_request] jobs: unit-tests: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - uses: actions/setup-go@v3 with: go-version: &#39;1.21&#39; - name: Run unit tests run: go test -v -race -coverprofile=coverage.out ./... - name: Upload coverage uses: codecov/codecov-action@v3 integration-tests: runs-on: ubuntu-latest services: postgres: image: pgvector/pgvector:pg15 env: POSTGRES_PASSWORD: test POSTGRES_DB: agentflow_test options: &gt;- --health-cmd pg_isready --health-interval 10s --health-timeout 5s --health-retries 5 redis: image: redis:7-alpine options: &gt;- --health-cmd &#34;redis-cli ping&#34; --health-interval 10s --health-timeout 5s --health-retries 5 steps: - uses: actions/checkout@v3 - uses: actions/setup-go@v3 with: go-version: &#39;1.21&#39; - name: Run integration tests run: go test -v -tags=integration ./... env: TEST_DATABASE_URL: postgres://postgres:test@localhost:5432/agentflow_test TEST_REDIS_URL: redis://localhost:6379/1 e2e-tests: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - uses: actions/setup-go@v3 with: go-version: &#39;1.21&#39; - name: Start test environment run: docker-compose -f docker-compose.test.yml up -d - name: Wait for services run: ./scripts/wait-for-services.sh - name: Run E2E tests run: go test -v -tags=e2e ./... - name: Cleanup run: docker-compose -f docker-compose.test.yml downTesting multi-agent systems requires a comprehensive approach that covers unit, integration, and end-to-end scenarios. By following these strategies and patterns, you can build reliable and maintainable agent systems with confidence.">
    <meta property="og:url" content="http://localhost:1313/AgenticGoKitDocs/tutorials/advanced/testing-strategies/index.html">
    <meta property="og:site_name" content="AgenticGoKit Docs">
    <meta property="og:title" content="testing-strategies :: AgenticGoKit Docs">
    <meta property="og:description" content="Testing Strategies for Multi-Agent Systems Comprehensive testing approaches for building reliable and maintainable agent systems
Testing multi-agent systems presents unique challenges due to their distributed nature, asynchronous communication, and external dependencies. This guide covers testing strategies, patterns, and tools specifically designed for AgenticGoKit applications.
🧪 Testing Pyramid for Agent Systems flowchart TDsubgraph &#34;End-to-End Tests (10%)&#34;E2E1[Full System Tests]E2E2[User Journey Tests]E2E3[Performance Tests]endsubgraph &#34;Integration Tests (30%)&#34;INT1[Agent Interaction Tests]INT2[External Service Tests]INT3[Orchestration Tests]INT4[Memory System Tests]INT5[MCP Tool Tests]endsubgraph &#34;Unit Tests (60%)&#34;UNIT1[Individual Agent Tests]UNIT2[Business Logic Tests]UNIT3[Utility Function Tests]UNIT4[Error Handling Tests]UNIT5[State Management Tests]endE2E1 --&gt; INT1E2E2 --&gt; INT2E2E3 --&gt; INT3INT1 --&gt; UNIT1INT2 --&gt; UNIT2INT3 --&gt; UNIT3INT4 --&gt; UNIT4INT5 --&gt; UNIT5classDef e2e fill:#ffebee,stroke:#c62828,stroke-width:2pxclassDef integration fill:#e8f5e8,stroke:#2e7d32,stroke-width:2pxclassDef unit fill:#e3f2fd,stroke:#1565c0,stroke-width:2pxclass E2E1,E2E2,E2E3 e2eclass INT1,INT2,INT3,INT4,INT5 integrationclass UNIT1,UNIT2,UNIT3,UNIT4,UNIT5 unit🔧 Unit Testing Strategies 1. Testing Individual Agents package agents import ( &#34;context&#34; &#34;testing&#34; &#34;time&#34; &#34;github.com/stretchr/testify/assert&#34; &#34;github.com/stretchr/testify/mock&#34; &#34;github.com/kunalkushwaha/agenticgokit/core&#34; ) // Mock LLM Provider for testing type MockLLMProvider struct { mock.Mock } func (m *MockLLMProvider) GenerateResponse(ctx context.Context, prompt string, options map[string]interface{}) (string, error) { args := m.Called(ctx, prompt, options) return args.String(0), args.Error(1) } func TestAnalyzerAgent_Execute(t *testing.T) { tests := []struct { name string event core.Event state *core.State mockResponse string mockError error expectedResult map[string]interface{} expectedError string }{ { name: &#34;successful analysis&#34;, event: core.NewEvent(&#34;analyze&#34;, map[string]interface{}{ &#34;data&#34;: &#34;Sample data to analyze&#34;, }), state: &amp;core.State{ SessionID: &#34;test-session&#34;, Data: map[string]interface{}{ &#34;context&#34;: &#34;test context&#34;, }, }, mockResponse: &#34;Analysis complete: The data shows positive trends&#34;, expectedResult: map[string]interface{}{ &#34;analysis&#34;: &#34;Analysis complete: The data shows positive trends&#34;, &#34;agent&#34;: &#34;analyzer&#34;, &#34;status&#34;: &#34;completed&#34;, }, }, { name: &#34;empty data handling&#34;, event: core.NewEvent(&#34;analyze&#34;, map[string]interface{}{ &#34;data&#34;: &#34;&#34;, }), state: &amp;core.State{SessionID: &#34;test-session&#34;}, expectedError: &#34;no data provided for analysis&#34;, }, { name: &#34;LLM provider error&#34;, event: core.NewEvent(&#34;analyze&#34;, map[string]interface{}{ &#34;data&#34;: &#34;Sample data&#34;, }), state: &amp;core.State{SessionID: &#34;test-session&#34;}, mockError: errors.New(&#34;LLM service unavailable&#34;), expectedError: &#34;LLM request failed: LLM service unavailable&#34;, }, } for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { // Setup mock mockProvider := new(MockLLMProvider) if tt.mockResponse != &#34;&#34; || tt.mockError != nil { mockProvider.On(&#34;GenerateResponse&#34;, mock.Anything, mock.AnythingOfType(&#34;string&#34;), mock.Anything). Return(tt.mockResponse, tt.mockError) } // Create agent with mock agent := NewAnalyzerAgent(&#34;analyzer&#34;, mockProvider) // Execute test result, err := agent.Execute(context.Background(), tt.event, tt.state) // Assertions if tt.expectedError != &#34;&#34; { assert.Error(t, err) assert.Contains(t, err.Error(), tt.expectedError) assert.Nil(t, result) } else { assert.NoError(t, err) assert.NotNil(t, result) for key, expectedValue := range tt.expectedResult { assert.Equal(t, expectedValue, result.Data[key]) } } // Verify mock expectations mockProvider.AssertExpectations(t) }) } }2. Testing State Management func TestStateTransformations(t *testing.T) { tests := []struct { name string initialState *core.State transformation func(*core.State) *core.State expectedData map[string]interface{} }{ { name: &#34;add analysis result&#34;, initialState: &amp;core.State{ SessionID: &#34;test&#34;, Data: map[string]interface{}{ &#34;input&#34;: &#34;test data&#34;, }, }, transformation: func(state *core.State) *core.State { newState := state.Clone() newState.Data[&#34;analysis&#34;] = &#34;completed&#34; newState.Data[&#34;confidence&#34;] = 0.95 return newState }, expectedData: map[string]interface{}{ &#34;input&#34;: &#34;test data&#34;, &#34;analysis&#34;: &#34;completed&#34;, &#34;confidence&#34;: 0.95, }, }, { name: &#34;merge states&#34;, initialState: &amp;core.State{ SessionID: &#34;test&#34;, Data: map[string]interface{}{ &#34;step1&#34;: &#34;completed&#34;, }, }, transformation: func(state *core.State) *core.State { additionalData := map[string]interface{}{ &#34;step2&#34;: &#34;completed&#34;, &#34;final&#34;: true, } return state.Merge(additionalData) }, expectedData: map[string]interface{}{ &#34;step1&#34;: &#34;completed&#34;, &#34;step2&#34;: &#34;completed&#34;, &#34;final&#34;: true, }, }, } for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { result := tt.transformation(tt.initialState) for key, expected := range tt.expectedData { assert.Equal(t, expected, result.Data[key]) } }) } }3. Testing Error Handling func TestErrorHandling(t *testing.T) { tests := []struct { name string setupMock func(*MockLLMProvider) expectedError string shouldRetry bool }{ { name: &#34;timeout error&#34;, setupMock: func(m *MockLLMProvider) { m.On(&#34;GenerateResponse&#34;, mock.Anything, mock.Anything, mock.Anything). Return(&#34;&#34;, context.DeadlineExceeded) }, expectedError: &#34;context deadline exceeded&#34;, shouldRetry: true, }, { name: &#34;rate limit error&#34;, setupMock: func(m *MockLLMProvider) { m.On(&#34;GenerateResponse&#34;, mock.Anything, mock.Anything, mock.Anything). Return(&#34;&#34;, errors.New(&#34;rate limit exceeded&#34;)) }, expectedError: &#34;rate limit exceeded&#34;, shouldRetry: true, }, { name: &#34;authentication error&#34;, setupMock: func(m *MockLLMProvider) { m.On(&#34;GenerateResponse&#34;, mock.Anything, mock.Anything, mock.Anything). Return(&#34;&#34;, errors.New(&#34;invalid API key&#34;)) }, expectedError: &#34;invalid API key&#34;, shouldRetry: false, }, } for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { mockProvider := new(MockLLMProvider) tt.setupMock(mockProvider) agent := NewResilientAgent(&#34;test&#34;, mockProvider) event := core.NewEvent(&#34;test&#34;, &#34;data&#34;) state := &amp;core.State{SessionID: &#34;test&#34;} _, err := agent.Execute(context.Background(), event, state) assert.Error(t, err) assert.Contains(t, err.Error(), tt.expectedError) // Test retry behavior if tt.shouldRetry { // Verify that retries were attempted assert.True(t, mockProvider.AssertNumberOfCalls(t, &#34;GenerateResponse&#34;, 3)) } else { // Verify that no retries were attempted assert.True(t, mockProvider.AssertNumberOfCalls(t, &#34;GenerateResponse&#34;, 1)) } }) } }🔗 Integration Testing 1. Testing Agent Interactions func TestAgentOrchestration(t *testing.T) { // Setup test agents mockProvider := new(MockLLMProvider) mockProvider.On(&#34;GenerateResponse&#34;, mock.Anything, mock.MatchedBy(func(prompt string) bool { return strings.Contains(prompt, &#34;analyze&#34;) }), mock.Anything).Return(&#34;Analysis: Data processed&#34;, nil) mockProvider.On(&#34;GenerateResponse&#34;, mock.Anything, mock.MatchedBy(func(prompt string) bool { return strings.Contains(prompt, &#34;validate&#34;) }), mock.Anything).Return(&#34;Validation: Data is valid&#34;, nil) analyzer := NewAnalyzerAgent(&#34;analyzer&#34;, mockProvider) validator := NewValidatorAgent(&#34;validator&#34;, mockProvider) // Create sequential runner agents := map[string]core.AgentHandler{ &#34;analyzer&#34;: analyzer, &#34;validator&#34;: validator, } config := core.RunnerConfig{ OrchestrationMode: core.OrchestrationSequential, SequentialAgents: []string{&#34;analyzer&#34;, &#34;validator&#34;}, Timeout: 30 * time.Second, } runner := core.NewRunnerWithConfig(config) for name, agent := range agents { runner.RegisterAgent(name, agent) } // Test sequential execution event := core.NewEvent(&#34;process&#34;, map[string]interface{}{ &#34;data&#34;: &#34;test data for processing&#34;, }) results, err := runner.ProcessEvent(context.Background(), event) assert.NoError(t, err) assert.Len(t, results, 2) // Verify execution order and data flow analyzerResult := results[0] validatorResult := results[1] assert.Equal(t, &#34;analyzer&#34;, analyzerResult.Agent) assert.Contains(t, analyzerResult.Data[&#34;analysis&#34;], &#34;Data processed&#34;) assert.Equal(t, &#34;validator&#34;, validatorResult.Agent) assert.Contains(t, validatorResult.Data[&#34;validation&#34;], &#34;Data is valid&#34;) }2. Testing Memory System Integration func TestMemorySystemIntegration(t *testing.T) { // Setup in-memory test database memoryProvider := memory.NewInMemoryProvider() // Create agent with memory agent := NewMemoryEnabledAgent(&#34;test-agent&#34;, mockLLMProvider, memoryProvider) // Test storing and retrieving memories t.Run(&#34;store and retrieve memory&#34;, func(t *testing.T) { event := core.NewEvent(&#34;remember&#34;, map[string]interface{}{ &#34;fact&#34;: &#34;The sky is blue&#34;, &#34;category&#34;: &#34;general_knowledge&#34;, }) state := &amp;core.State{ SessionID: &#34;test-session&#34;, UserID: &#34;test-user&#34;, } result, err := agent.Execute(context.Background(), event, state) assert.NoError(t, err) assert.Equal(t, &#34;stored&#34;, result.Data[&#34;status&#34;]) // Verify memory was stored memories, err := memoryProvider.Search(context.Background(), &#34;sky blue&#34;, 5) assert.NoError(t, err) assert.Len(t, memories, 1) assert.Contains(t, memories[0].Content, &#34;sky is blue&#34;) }) t.Run(&#34;RAG retrieval&#34;, func(t *testing.T) { // Setup mock to expect context from memory mockProvider.On(&#34;GenerateResponse&#34;, mock.Anything, mock.MatchedBy(func(prompt string) bool { return strings.Contains(prompt, &#34;sky is blue&#34;) }), mock.Anything).Return(&#34;Based on the stored knowledge, the sky appears blue due to light scattering&#34;, nil) event := core.NewEvent(&#34;query&#34;, map[string]interface{}{ &#34;question&#34;: &#34;What color is the sky?&#34;, }) state := &amp;core.State{SessionID: &#34;test-session&#34;} result, err := agent.Execute(context.Background(), event, state) assert.NoError(t, err) assert.Contains(t, result.Data[&#34;response&#34;], &#34;blue due to light scattering&#34;) }) }3. Testing MCP Tool Integration func TestMCPToolIntegration(t *testing.T) { // Setup mock MCP server mockServer := &amp;MockMCPServer{} mockServer.On(&#34;ExecuteTool&#34;, &#34;web_search&#34;, map[string]interface{}{ &#34;query&#34;: &#34;AgenticGoKit testing&#34;, }).Return(map[string]interface{}{ &#34;results&#34;: []string{&#34;AgenticGoKit is a Go framework for building multi-agent systems&#34;}, }, nil) // Create agent with MCP tools toolManager := mcp.NewToolManager() toolManager.RegisterServer(&#34;test-server&#34;, mockServer) agent := NewToolEnabledAgent(&#34;test-agent&#34;, mockLLMProvider, toolManager) event := core.NewEvent(&#34;search&#34;, map[string]interface{}{ &#34;query&#34;: &#34;AgenticGoKit testing&#34;, &#34;tool&#34;: &#34;web_search&#34;, }) state := &amp;core.State{SessionID: &#34;test-session&#34;} result, err := agent.Execute(context.Background(), event, state) assert.NoError(t, err) assert.Contains(t, result.Data[&#34;search_results&#34;], &#34;Go framework&#34;) mockServer.AssertExpectations(t) }🌐 End-to-End Testing 1. Full System Tests func TestFullSystemWorkflow(t *testing.T) { // Setup complete system system := setupTestSystem(t) defer system.Cleanup() // Test complete user workflow t.Run(&#34;research assistant workflow&#34;, func(t *testing.T) { // Step 1: User asks a question request := &amp;api.Request{ Type: &#34;research_query&#34;, Data: map[string]interface{}{ &#34;question&#34;: &#34;What are the latest developments in AI agent frameworks?&#34;, &#34;depth&#34;: &#34;comprehensive&#34;, }, UserID: &#34;test-user&#34;, SessionID: &#34;test-session&#34;, } response, err := system.ProcessRequest(context.Background(), request) assert.NoError(t, err) // Verify response structure assert.NotNil(t, response) assert.Equal(t, &#34;success&#34;, response.Status) assert.Contains(t, response.Data, &#34;research_results&#34;) assert.Contains(t, response.Data, &#34;sources&#34;) assert.Contains(t, response.Data, &#34;summary&#34;) // Verify agent execution trace trace := response.Trace assert.NotEmpty(t, trace) // Should have executed: researcher -&gt; analyzer -&gt; validator -&gt; formatter expectedAgents := []string{&#34;researcher&#34;, &#34;analyzer&#34;, &#34;validator&#34;, &#34;formatter&#34;} assert.Len(t, trace, len(expectedAgents)) for i, expectedAgent := range expectedAgents { assert.Equal(t, expectedAgent, trace[i].Agent) assert.Equal(t, &#34;completed&#34;, trace[i].Status) } }) t.Run(&#34;error handling workflow&#34;, func(t *testing.T) { // Simulate external service failure system.SimulateServiceFailure(&#34;web_search&#34;) request := &amp;api.Request{ Type: &#34;research_query&#34;, Data: map[string]interface{}{ &#34;question&#34;: &#34;Test question&#34;, }, UserID: &#34;test-user&#34;, SessionID: &#34;test-session-2&#34;, } response, err := system.ProcessRequest(context.Background(), request) // Should handle gracefully with fallback assert.NoError(t, err) assert.Equal(t, &#34;partial_success&#34;, response.Status) assert.Contains(t, response.Data, &#34;fallback_response&#34;) assert.Contains(t, response.Warnings, &#34;web search unavailable&#34;) }) }2. Performance Testing func TestSystemPerformance(t *testing.T) { system := setupTestSystem(t) defer system.Cleanup() t.Run(&#34;concurrent request handling&#34;, func(t *testing.T) { concurrency := 10 requestsPerWorker := 5 var wg sync.WaitGroup results := make(chan time.Duration, concurrency*requestsPerWorker) errors := make(chan error, concurrency*requestsPerWorker) for i := 0; i &lt; concurrency; i&#43;&#43; { wg.Add(1) go func(workerID int) { defer wg.Done() for j := 0; j &lt; requestsPerWorker; j&#43;&#43; { start := time.Now() request := &amp;api.Request{ Type: &#34;simple_query&#34;, Data: map[string]interface{}{ &#34;question&#34;: fmt.Sprintf(&#34;Test question %d-%d&#34;, workerID, j), }, UserID: fmt.Sprintf(&#34;user-%d&#34;, workerID), SessionID: fmt.Sprintf(&#34;session-%d-%d&#34;, workerID, j), } _, err := system.ProcessRequest(context.Background(), request) duration := time.Since(start) if err != nil { errors &lt;- err } else { results &lt;- duration } } }(i) } wg.Wait() close(results) close(errors) // Collect results var durations []time.Duration for duration := range results { durations = append(durations, duration) } var errorList []error for err := range errors { errorList = append(errorList, err) } // Assertions assert.Empty(t, errorList, &#34;No errors should occur during concurrent processing&#34;) assert.Len(t, durations, concurrency*requestsPerWorker) // Performance assertions avgDuration := calculateAverage(durations) maxDuration := calculateMax(durations) assert.Less(t, avgDuration, 5*time.Second, &#34;Average response time should be under 5 seconds&#34;) assert.Less(t, maxDuration, 10*time.Second, &#34;Max response time should be under 10 seconds&#34;) t.Logf(&#34;Performance results: avg=%v, max=%v, total_requests=%d&#34;, avgDuration, maxDuration, len(durations)) }) }🎭 Test Doubles and Mocking 1. Mock External Services type MockExternalService struct { mock.Mock responses map[string]interface{} delays map[string]time.Duration failures map[string]error } func NewMockExternalService() *MockExternalService { return &amp;MockExternalService{ responses: make(map[string]interface{}), delays: make(map[string]time.Duration), failures: make(map[string]error), } } func (m *MockExternalService) SetResponse(endpoint string, response interface{}) { m.responses[endpoint] = response } func (m *MockExternalService) SetDelay(endpoint string, delay time.Duration) { m.delays[endpoint] = delay } func (m *MockExternalService) SetFailure(endpoint string, err error) { m.failures[endpoint] = err } func (m *MockExternalService) Call(ctx context.Context, endpoint string, params map[string]interface{}) (interface{}, error) { // Simulate delay if delay, exists := m.delays[endpoint]; exists { select { case &lt;-time.After(delay): case &lt;-ctx.Done(): return nil, ctx.Err() } } // Simulate failure if err, exists := m.failures[endpoint]; exists { return nil, err } // Return mock response if response, exists := m.responses[endpoint]; exists { return response, nil } return nil, errors.New(&#34;endpoint not mocked&#34;) }2. Test Fixtures and Builders type TestSystemBuilder struct { agents map[string]core.AgentHandler mockServices map[string]*MockExternalService config core.RunnerConfig } func NewTestSystemBuilder() *TestSystemBuilder { return &amp;TestSystemBuilder{ agents: make(map[string]core.AgentHandler), mockServices: make(map[string]*MockExternalService), config: core.RunnerConfig{ OrchestrationMode: core.OrchestrationSequential, Timeout: 30 * time.Second, }, } } func (b *TestSystemBuilder) WithAgent(name string, agent core.AgentHandler) *TestSystemBuilder { b.agents[name] = agent return b } func (b *TestSystemBuilder) WithMockService(name string, service *MockExternalService) *TestSystemBuilder { b.mockServices[name] = service return b } func (b *TestSystemBuilder) WithOrchestration(mode core.OrchestrationMode, agents []string) *TestSystemBuilder { b.config.OrchestrationMode = mode switch mode { case core.OrchestrationSequential: b.config.SequentialAgents = agents case core.OrchestrationCollaborative: b.config.CollaborativeAgents = agents } return b } func (b *TestSystemBuilder) Build() *TestSystem { runner := core.NewRunnerWithConfig(b.config) for name, agent := range b.agents { runner.RegisterAgent(name, agent) } return &amp;TestSystem{ runner: runner, mockServices: b.mockServices, } } type TestSystem struct { runner core.Runner mockServices map[string]*MockExternalService } func (ts *TestSystem) ProcessRequest(ctx context.Context, request *api.Request) (*api.Response, error) { event := core.NewEvent(request.Type, request.Data) state := &amp;core.State{ SessionID: request.SessionID, UserID: request.UserID, } results, err := ts.runner.ProcessEvent(ctx, event) if err != nil { return nil, err } return &amp;api.Response{ Status: &#34;success&#34;, Data: results[len(results)-1].Data, Trace: convertToTrace(results), }, nil } func (ts *TestSystem) SimulateServiceFailure(serviceName string) { if service, exists := ts.mockServices[serviceName]; exists { service.SetFailure(&#34;*&#34;, errors.New(&#34;simulated service failure&#34;)) } } func (ts *TestSystem) Cleanup() { // Cleanup resources for _, service := range ts.mockServices { service.AssertExpectations(&amp;testing.T{}) } }📊 Test Data Management 1. Test Data Builders type EventBuilder struct { eventType string data map[string]interface{} metadata map[string]interface{} } func NewEventBuilder(eventType string) *EventBuilder { return &amp;EventBuilder{ eventType: eventType, data: make(map[string]interface{}), metadata: make(map[string]interface{}), } } func (b *EventBuilder) WithData(key string, value interface{}) *EventBuilder { b.data[key] = value return b } func (b *EventBuilder) WithMetadata(key string, value interface{}) *EventBuilder { b.metadata[key] = value return b } func (b *EventBuilder) Build() core.Event { event := core.NewEvent(b.eventType, b.data) for key, value := range b.metadata { event.Metadata[key] = value } return event } type StateBuilder struct { sessionID string userID string data map[string]interface{} } func NewStateBuilder() *StateBuilder { return &amp;StateBuilder{ data: make(map[string]interface{}), } } func (b *StateBuilder) WithSession(sessionID string) *StateBuilder { b.sessionID = sessionID return b } func (b *StateBuilder) WithUser(userID string) *StateBuilder { b.userID = userID return b } func (b *StateBuilder) WithData(key string, value interface{}) *StateBuilder { b.data[key] = value return b } func (b *StateBuilder) Build() *core.State { return &amp;core.State{ SessionID: b.sessionID, UserID: b.userID, Data: b.data, } }2. Test Scenarios func TestCommonScenarios(t *testing.T) { scenarios := []struct { name string setup func() (*TestSystem, core.Event, *core.State) validate func(*testing.T, *core.AgentResult, error) }{ { name: &#34;successful_analysis&#34;, setup: func() (*TestSystem, core.Event, *core.State) { system := NewTestSystemBuilder(). WithAgent(&#34;analyzer&#34;, NewMockAnalyzer(&#34;success&#34;)). Build() event := NewEventBuilder(&#34;analyze&#34;). WithData(&#34;content&#34;, &#34;test data&#34;). Build() state := NewStateBuilder(). WithSession(&#34;test-session&#34;). Build() return system, event, state }, validate: func(t *testing.T, result *core.AgentResult, err error) { assert.NoError(t, err) assert.Equal(t, &#34;completed&#34;, result.Data[&#34;status&#34;]) }, }, { name: &#34;timeout_handling&#34;, setup: func() (*TestSystem, core.Event, *core.State) { system := NewTestSystemBuilder(). WithAgent(&#34;slow_agent&#34;, NewSlowMockAgent(10*time.Second)). Build() event := NewEventBuilder(&#34;process&#34;). WithData(&#34;timeout&#34;, &#34;5s&#34;). Build() state := NewStateBuilder(). WithSession(&#34;timeout-test&#34;). Build() return system, event, state }, validate: func(t *testing.T, result *core.AgentResult, err error) { assert.Error(t, err) assert.Contains(t, err.Error(), &#34;timeout&#34;) }, }, } for _, scenario := range scenarios { t.Run(scenario.name, func(t *testing.T) { system, event, state := scenario.setup() defer system.Cleanup() result, err := system.ProcessSingleEvent(context.Background(), event, state) scenario.validate(t, result, err) }) } }🎯 Best Practices 1. Test Organization // Package structure for tests // agents/ // analyzer_test.go - Unit tests for analyzer agent // validator_test.go - Unit tests for validator agent // integration_test.go - Integration tests between agents // orchestration/ // sequential_test.go - Sequential orchestration tests // collaborative_test.go - Collaborative orchestration tests // system/ // e2e_test.go - End-to-end system tests // performance_test.go - Performance and load tests // testutils/ // builders.go - Test data builders // mocks.go - Mock implementations // fixtures.go - Test fixtures and helpers2. Test Configuration // Test configuration management type TestConfig struct { DatabaseURL string RedisURL string MockServices bool LogLevel string TestTimeout time.Duration } func LoadTestConfig() *TestConfig { return &amp;TestConfig{ DatabaseURL: getEnvOrDefault(&#34;TEST_DATABASE_URL&#34;, &#34;postgres://localhost/agentflow_test&#34;), RedisURL: getEnvOrDefault(&#34;TEST_REDIS_URL&#34;, &#34;redis://localhost:6379/1&#34;), MockServices: getEnvOrDefault(&#34;MOCK_SERVICES&#34;, &#34;true&#34;) == &#34;true&#34;, LogLevel: getEnvOrDefault(&#34;TEST_LOG_LEVEL&#34;, &#34;error&#34;), TestTimeout: 30 * time.Second, } }3. Continuous Integration # .github/workflows/test.yml name: Test Suite on: [push, pull_request] jobs: unit-tests: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - uses: actions/setup-go@v3 with: go-version: &#39;1.21&#39; - name: Run unit tests run: go test -v -race -coverprofile=coverage.out ./... - name: Upload coverage uses: codecov/codecov-action@v3 integration-tests: runs-on: ubuntu-latest services: postgres: image: pgvector/pgvector:pg15 env: POSTGRES_PASSWORD: test POSTGRES_DB: agentflow_test options: &gt;- --health-cmd pg_isready --health-interval 10s --health-timeout 5s --health-retries 5 redis: image: redis:7-alpine options: &gt;- --health-cmd &#34;redis-cli ping&#34; --health-interval 10s --health-timeout 5s --health-retries 5 steps: - uses: actions/checkout@v3 - uses: actions/setup-go@v3 with: go-version: &#39;1.21&#39; - name: Run integration tests run: go test -v -tags=integration ./... env: TEST_DATABASE_URL: postgres://postgres:test@localhost:5432/agentflow_test TEST_REDIS_URL: redis://localhost:6379/1 e2e-tests: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - uses: actions/setup-go@v3 with: go-version: &#39;1.21&#39; - name: Start test environment run: docker-compose -f docker-compose.test.yml up -d - name: Wait for services run: ./scripts/wait-for-services.sh - name: Run E2E tests run: go test -v -tags=e2e ./... - name: Cleanup run: docker-compose -f docker-compose.test.yml downTesting multi-agent systems requires a comprehensive approach that covers unit, integration, and end-to-end scenarios. By following these strategies and patterns, you can build reliable and maintainable agent systems with confidence.">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="tutorials">
    <meta property="article:published_time" content="2025-07-25T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-07-25T00:00:00+00:00">
    <meta itemprop="name" content="testing-strategies :: AgenticGoKit Docs">
    <meta itemprop="description" content="Testing Strategies for Multi-Agent Systems Comprehensive testing approaches for building reliable and maintainable agent systems
Testing multi-agent systems presents unique challenges due to their distributed nature, asynchronous communication, and external dependencies. This guide covers testing strategies, patterns, and tools specifically designed for AgenticGoKit applications.
🧪 Testing Pyramid for Agent Systems flowchart TDsubgraph &#34;End-to-End Tests (10%)&#34;E2E1[Full System Tests]E2E2[User Journey Tests]E2E3[Performance Tests]endsubgraph &#34;Integration Tests (30%)&#34;INT1[Agent Interaction Tests]INT2[External Service Tests]INT3[Orchestration Tests]INT4[Memory System Tests]INT5[MCP Tool Tests]endsubgraph &#34;Unit Tests (60%)&#34;UNIT1[Individual Agent Tests]UNIT2[Business Logic Tests]UNIT3[Utility Function Tests]UNIT4[Error Handling Tests]UNIT5[State Management Tests]endE2E1 --&gt; INT1E2E2 --&gt; INT2E2E3 --&gt; INT3INT1 --&gt; UNIT1INT2 --&gt; UNIT2INT3 --&gt; UNIT3INT4 --&gt; UNIT4INT5 --&gt; UNIT5classDef e2e fill:#ffebee,stroke:#c62828,stroke-width:2pxclassDef integration fill:#e8f5e8,stroke:#2e7d32,stroke-width:2pxclassDef unit fill:#e3f2fd,stroke:#1565c0,stroke-width:2pxclass E2E1,E2E2,E2E3 e2eclass INT1,INT2,INT3,INT4,INT5 integrationclass UNIT1,UNIT2,UNIT3,UNIT4,UNIT5 unit🔧 Unit Testing Strategies 1. Testing Individual Agents package agents import ( &#34;context&#34; &#34;testing&#34; &#34;time&#34; &#34;github.com/stretchr/testify/assert&#34; &#34;github.com/stretchr/testify/mock&#34; &#34;github.com/kunalkushwaha/agenticgokit/core&#34; ) // Mock LLM Provider for testing type MockLLMProvider struct { mock.Mock } func (m *MockLLMProvider) GenerateResponse(ctx context.Context, prompt string, options map[string]interface{}) (string, error) { args := m.Called(ctx, prompt, options) return args.String(0), args.Error(1) } func TestAnalyzerAgent_Execute(t *testing.T) { tests := []struct { name string event core.Event state *core.State mockResponse string mockError error expectedResult map[string]interface{} expectedError string }{ { name: &#34;successful analysis&#34;, event: core.NewEvent(&#34;analyze&#34;, map[string]interface{}{ &#34;data&#34;: &#34;Sample data to analyze&#34;, }), state: &amp;core.State{ SessionID: &#34;test-session&#34;, Data: map[string]interface{}{ &#34;context&#34;: &#34;test context&#34;, }, }, mockResponse: &#34;Analysis complete: The data shows positive trends&#34;, expectedResult: map[string]interface{}{ &#34;analysis&#34;: &#34;Analysis complete: The data shows positive trends&#34;, &#34;agent&#34;: &#34;analyzer&#34;, &#34;status&#34;: &#34;completed&#34;, }, }, { name: &#34;empty data handling&#34;, event: core.NewEvent(&#34;analyze&#34;, map[string]interface{}{ &#34;data&#34;: &#34;&#34;, }), state: &amp;core.State{SessionID: &#34;test-session&#34;}, expectedError: &#34;no data provided for analysis&#34;, }, { name: &#34;LLM provider error&#34;, event: core.NewEvent(&#34;analyze&#34;, map[string]interface{}{ &#34;data&#34;: &#34;Sample data&#34;, }), state: &amp;core.State{SessionID: &#34;test-session&#34;}, mockError: errors.New(&#34;LLM service unavailable&#34;), expectedError: &#34;LLM request failed: LLM service unavailable&#34;, }, } for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { // Setup mock mockProvider := new(MockLLMProvider) if tt.mockResponse != &#34;&#34; || tt.mockError != nil { mockProvider.On(&#34;GenerateResponse&#34;, mock.Anything, mock.AnythingOfType(&#34;string&#34;), mock.Anything). Return(tt.mockResponse, tt.mockError) } // Create agent with mock agent := NewAnalyzerAgent(&#34;analyzer&#34;, mockProvider) // Execute test result, err := agent.Execute(context.Background(), tt.event, tt.state) // Assertions if tt.expectedError != &#34;&#34; { assert.Error(t, err) assert.Contains(t, err.Error(), tt.expectedError) assert.Nil(t, result) } else { assert.NoError(t, err) assert.NotNil(t, result) for key, expectedValue := range tt.expectedResult { assert.Equal(t, expectedValue, result.Data[key]) } } // Verify mock expectations mockProvider.AssertExpectations(t) }) } }2. Testing State Management func TestStateTransformations(t *testing.T) { tests := []struct { name string initialState *core.State transformation func(*core.State) *core.State expectedData map[string]interface{} }{ { name: &#34;add analysis result&#34;, initialState: &amp;core.State{ SessionID: &#34;test&#34;, Data: map[string]interface{}{ &#34;input&#34;: &#34;test data&#34;, }, }, transformation: func(state *core.State) *core.State { newState := state.Clone() newState.Data[&#34;analysis&#34;] = &#34;completed&#34; newState.Data[&#34;confidence&#34;] = 0.95 return newState }, expectedData: map[string]interface{}{ &#34;input&#34;: &#34;test data&#34;, &#34;analysis&#34;: &#34;completed&#34;, &#34;confidence&#34;: 0.95, }, }, { name: &#34;merge states&#34;, initialState: &amp;core.State{ SessionID: &#34;test&#34;, Data: map[string]interface{}{ &#34;step1&#34;: &#34;completed&#34;, }, }, transformation: func(state *core.State) *core.State { additionalData := map[string]interface{}{ &#34;step2&#34;: &#34;completed&#34;, &#34;final&#34;: true, } return state.Merge(additionalData) }, expectedData: map[string]interface{}{ &#34;step1&#34;: &#34;completed&#34;, &#34;step2&#34;: &#34;completed&#34;, &#34;final&#34;: true, }, }, } for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { result := tt.transformation(tt.initialState) for key, expected := range tt.expectedData { assert.Equal(t, expected, result.Data[key]) } }) } }3. Testing Error Handling func TestErrorHandling(t *testing.T) { tests := []struct { name string setupMock func(*MockLLMProvider) expectedError string shouldRetry bool }{ { name: &#34;timeout error&#34;, setupMock: func(m *MockLLMProvider) { m.On(&#34;GenerateResponse&#34;, mock.Anything, mock.Anything, mock.Anything). Return(&#34;&#34;, context.DeadlineExceeded) }, expectedError: &#34;context deadline exceeded&#34;, shouldRetry: true, }, { name: &#34;rate limit error&#34;, setupMock: func(m *MockLLMProvider) { m.On(&#34;GenerateResponse&#34;, mock.Anything, mock.Anything, mock.Anything). Return(&#34;&#34;, errors.New(&#34;rate limit exceeded&#34;)) }, expectedError: &#34;rate limit exceeded&#34;, shouldRetry: true, }, { name: &#34;authentication error&#34;, setupMock: func(m *MockLLMProvider) { m.On(&#34;GenerateResponse&#34;, mock.Anything, mock.Anything, mock.Anything). Return(&#34;&#34;, errors.New(&#34;invalid API key&#34;)) }, expectedError: &#34;invalid API key&#34;, shouldRetry: false, }, } for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { mockProvider := new(MockLLMProvider) tt.setupMock(mockProvider) agent := NewResilientAgent(&#34;test&#34;, mockProvider) event := core.NewEvent(&#34;test&#34;, &#34;data&#34;) state := &amp;core.State{SessionID: &#34;test&#34;} _, err := agent.Execute(context.Background(), event, state) assert.Error(t, err) assert.Contains(t, err.Error(), tt.expectedError) // Test retry behavior if tt.shouldRetry { // Verify that retries were attempted assert.True(t, mockProvider.AssertNumberOfCalls(t, &#34;GenerateResponse&#34;, 3)) } else { // Verify that no retries were attempted assert.True(t, mockProvider.AssertNumberOfCalls(t, &#34;GenerateResponse&#34;, 1)) } }) } }🔗 Integration Testing 1. Testing Agent Interactions func TestAgentOrchestration(t *testing.T) { // Setup test agents mockProvider := new(MockLLMProvider) mockProvider.On(&#34;GenerateResponse&#34;, mock.Anything, mock.MatchedBy(func(prompt string) bool { return strings.Contains(prompt, &#34;analyze&#34;) }), mock.Anything).Return(&#34;Analysis: Data processed&#34;, nil) mockProvider.On(&#34;GenerateResponse&#34;, mock.Anything, mock.MatchedBy(func(prompt string) bool { return strings.Contains(prompt, &#34;validate&#34;) }), mock.Anything).Return(&#34;Validation: Data is valid&#34;, nil) analyzer := NewAnalyzerAgent(&#34;analyzer&#34;, mockProvider) validator := NewValidatorAgent(&#34;validator&#34;, mockProvider) // Create sequential runner agents := map[string]core.AgentHandler{ &#34;analyzer&#34;: analyzer, &#34;validator&#34;: validator, } config := core.RunnerConfig{ OrchestrationMode: core.OrchestrationSequential, SequentialAgents: []string{&#34;analyzer&#34;, &#34;validator&#34;}, Timeout: 30 * time.Second, } runner := core.NewRunnerWithConfig(config) for name, agent := range agents { runner.RegisterAgent(name, agent) } // Test sequential execution event := core.NewEvent(&#34;process&#34;, map[string]interface{}{ &#34;data&#34;: &#34;test data for processing&#34;, }) results, err := runner.ProcessEvent(context.Background(), event) assert.NoError(t, err) assert.Len(t, results, 2) // Verify execution order and data flow analyzerResult := results[0] validatorResult := results[1] assert.Equal(t, &#34;analyzer&#34;, analyzerResult.Agent) assert.Contains(t, analyzerResult.Data[&#34;analysis&#34;], &#34;Data processed&#34;) assert.Equal(t, &#34;validator&#34;, validatorResult.Agent) assert.Contains(t, validatorResult.Data[&#34;validation&#34;], &#34;Data is valid&#34;) }2. Testing Memory System Integration func TestMemorySystemIntegration(t *testing.T) { // Setup in-memory test database memoryProvider := memory.NewInMemoryProvider() // Create agent with memory agent := NewMemoryEnabledAgent(&#34;test-agent&#34;, mockLLMProvider, memoryProvider) // Test storing and retrieving memories t.Run(&#34;store and retrieve memory&#34;, func(t *testing.T) { event := core.NewEvent(&#34;remember&#34;, map[string]interface{}{ &#34;fact&#34;: &#34;The sky is blue&#34;, &#34;category&#34;: &#34;general_knowledge&#34;, }) state := &amp;core.State{ SessionID: &#34;test-session&#34;, UserID: &#34;test-user&#34;, } result, err := agent.Execute(context.Background(), event, state) assert.NoError(t, err) assert.Equal(t, &#34;stored&#34;, result.Data[&#34;status&#34;]) // Verify memory was stored memories, err := memoryProvider.Search(context.Background(), &#34;sky blue&#34;, 5) assert.NoError(t, err) assert.Len(t, memories, 1) assert.Contains(t, memories[0].Content, &#34;sky is blue&#34;) }) t.Run(&#34;RAG retrieval&#34;, func(t *testing.T) { // Setup mock to expect context from memory mockProvider.On(&#34;GenerateResponse&#34;, mock.Anything, mock.MatchedBy(func(prompt string) bool { return strings.Contains(prompt, &#34;sky is blue&#34;) }), mock.Anything).Return(&#34;Based on the stored knowledge, the sky appears blue due to light scattering&#34;, nil) event := core.NewEvent(&#34;query&#34;, map[string]interface{}{ &#34;question&#34;: &#34;What color is the sky?&#34;, }) state := &amp;core.State{SessionID: &#34;test-session&#34;} result, err := agent.Execute(context.Background(), event, state) assert.NoError(t, err) assert.Contains(t, result.Data[&#34;response&#34;], &#34;blue due to light scattering&#34;) }) }3. Testing MCP Tool Integration func TestMCPToolIntegration(t *testing.T) { // Setup mock MCP server mockServer := &amp;MockMCPServer{} mockServer.On(&#34;ExecuteTool&#34;, &#34;web_search&#34;, map[string]interface{}{ &#34;query&#34;: &#34;AgenticGoKit testing&#34;, }).Return(map[string]interface{}{ &#34;results&#34;: []string{&#34;AgenticGoKit is a Go framework for building multi-agent systems&#34;}, }, nil) // Create agent with MCP tools toolManager := mcp.NewToolManager() toolManager.RegisterServer(&#34;test-server&#34;, mockServer) agent := NewToolEnabledAgent(&#34;test-agent&#34;, mockLLMProvider, toolManager) event := core.NewEvent(&#34;search&#34;, map[string]interface{}{ &#34;query&#34;: &#34;AgenticGoKit testing&#34;, &#34;tool&#34;: &#34;web_search&#34;, }) state := &amp;core.State{SessionID: &#34;test-session&#34;} result, err := agent.Execute(context.Background(), event, state) assert.NoError(t, err) assert.Contains(t, result.Data[&#34;search_results&#34;], &#34;Go framework&#34;) mockServer.AssertExpectations(t) }🌐 End-to-End Testing 1. Full System Tests func TestFullSystemWorkflow(t *testing.T) { // Setup complete system system := setupTestSystem(t) defer system.Cleanup() // Test complete user workflow t.Run(&#34;research assistant workflow&#34;, func(t *testing.T) { // Step 1: User asks a question request := &amp;api.Request{ Type: &#34;research_query&#34;, Data: map[string]interface{}{ &#34;question&#34;: &#34;What are the latest developments in AI agent frameworks?&#34;, &#34;depth&#34;: &#34;comprehensive&#34;, }, UserID: &#34;test-user&#34;, SessionID: &#34;test-session&#34;, } response, err := system.ProcessRequest(context.Background(), request) assert.NoError(t, err) // Verify response structure assert.NotNil(t, response) assert.Equal(t, &#34;success&#34;, response.Status) assert.Contains(t, response.Data, &#34;research_results&#34;) assert.Contains(t, response.Data, &#34;sources&#34;) assert.Contains(t, response.Data, &#34;summary&#34;) // Verify agent execution trace trace := response.Trace assert.NotEmpty(t, trace) // Should have executed: researcher -&gt; analyzer -&gt; validator -&gt; formatter expectedAgents := []string{&#34;researcher&#34;, &#34;analyzer&#34;, &#34;validator&#34;, &#34;formatter&#34;} assert.Len(t, trace, len(expectedAgents)) for i, expectedAgent := range expectedAgents { assert.Equal(t, expectedAgent, trace[i].Agent) assert.Equal(t, &#34;completed&#34;, trace[i].Status) } }) t.Run(&#34;error handling workflow&#34;, func(t *testing.T) { // Simulate external service failure system.SimulateServiceFailure(&#34;web_search&#34;) request := &amp;api.Request{ Type: &#34;research_query&#34;, Data: map[string]interface{}{ &#34;question&#34;: &#34;Test question&#34;, }, UserID: &#34;test-user&#34;, SessionID: &#34;test-session-2&#34;, } response, err := system.ProcessRequest(context.Background(), request) // Should handle gracefully with fallback assert.NoError(t, err) assert.Equal(t, &#34;partial_success&#34;, response.Status) assert.Contains(t, response.Data, &#34;fallback_response&#34;) assert.Contains(t, response.Warnings, &#34;web search unavailable&#34;) }) }2. Performance Testing func TestSystemPerformance(t *testing.T) { system := setupTestSystem(t) defer system.Cleanup() t.Run(&#34;concurrent request handling&#34;, func(t *testing.T) { concurrency := 10 requestsPerWorker := 5 var wg sync.WaitGroup results := make(chan time.Duration, concurrency*requestsPerWorker) errors := make(chan error, concurrency*requestsPerWorker) for i := 0; i &lt; concurrency; i&#43;&#43; { wg.Add(1) go func(workerID int) { defer wg.Done() for j := 0; j &lt; requestsPerWorker; j&#43;&#43; { start := time.Now() request := &amp;api.Request{ Type: &#34;simple_query&#34;, Data: map[string]interface{}{ &#34;question&#34;: fmt.Sprintf(&#34;Test question %d-%d&#34;, workerID, j), }, UserID: fmt.Sprintf(&#34;user-%d&#34;, workerID), SessionID: fmt.Sprintf(&#34;session-%d-%d&#34;, workerID, j), } _, err := system.ProcessRequest(context.Background(), request) duration := time.Since(start) if err != nil { errors &lt;- err } else { results &lt;- duration } } }(i) } wg.Wait() close(results) close(errors) // Collect results var durations []time.Duration for duration := range results { durations = append(durations, duration) } var errorList []error for err := range errors { errorList = append(errorList, err) } // Assertions assert.Empty(t, errorList, &#34;No errors should occur during concurrent processing&#34;) assert.Len(t, durations, concurrency*requestsPerWorker) // Performance assertions avgDuration := calculateAverage(durations) maxDuration := calculateMax(durations) assert.Less(t, avgDuration, 5*time.Second, &#34;Average response time should be under 5 seconds&#34;) assert.Less(t, maxDuration, 10*time.Second, &#34;Max response time should be under 10 seconds&#34;) t.Logf(&#34;Performance results: avg=%v, max=%v, total_requests=%d&#34;, avgDuration, maxDuration, len(durations)) }) }🎭 Test Doubles and Mocking 1. Mock External Services type MockExternalService struct { mock.Mock responses map[string]interface{} delays map[string]time.Duration failures map[string]error } func NewMockExternalService() *MockExternalService { return &amp;MockExternalService{ responses: make(map[string]interface{}), delays: make(map[string]time.Duration), failures: make(map[string]error), } } func (m *MockExternalService) SetResponse(endpoint string, response interface{}) { m.responses[endpoint] = response } func (m *MockExternalService) SetDelay(endpoint string, delay time.Duration) { m.delays[endpoint] = delay } func (m *MockExternalService) SetFailure(endpoint string, err error) { m.failures[endpoint] = err } func (m *MockExternalService) Call(ctx context.Context, endpoint string, params map[string]interface{}) (interface{}, error) { // Simulate delay if delay, exists := m.delays[endpoint]; exists { select { case &lt;-time.After(delay): case &lt;-ctx.Done(): return nil, ctx.Err() } } // Simulate failure if err, exists := m.failures[endpoint]; exists { return nil, err } // Return mock response if response, exists := m.responses[endpoint]; exists { return response, nil } return nil, errors.New(&#34;endpoint not mocked&#34;) }2. Test Fixtures and Builders type TestSystemBuilder struct { agents map[string]core.AgentHandler mockServices map[string]*MockExternalService config core.RunnerConfig } func NewTestSystemBuilder() *TestSystemBuilder { return &amp;TestSystemBuilder{ agents: make(map[string]core.AgentHandler), mockServices: make(map[string]*MockExternalService), config: core.RunnerConfig{ OrchestrationMode: core.OrchestrationSequential, Timeout: 30 * time.Second, }, } } func (b *TestSystemBuilder) WithAgent(name string, agent core.AgentHandler) *TestSystemBuilder { b.agents[name] = agent return b } func (b *TestSystemBuilder) WithMockService(name string, service *MockExternalService) *TestSystemBuilder { b.mockServices[name] = service return b } func (b *TestSystemBuilder) WithOrchestration(mode core.OrchestrationMode, agents []string) *TestSystemBuilder { b.config.OrchestrationMode = mode switch mode { case core.OrchestrationSequential: b.config.SequentialAgents = agents case core.OrchestrationCollaborative: b.config.CollaborativeAgents = agents } return b } func (b *TestSystemBuilder) Build() *TestSystem { runner := core.NewRunnerWithConfig(b.config) for name, agent := range b.agents { runner.RegisterAgent(name, agent) } return &amp;TestSystem{ runner: runner, mockServices: b.mockServices, } } type TestSystem struct { runner core.Runner mockServices map[string]*MockExternalService } func (ts *TestSystem) ProcessRequest(ctx context.Context, request *api.Request) (*api.Response, error) { event := core.NewEvent(request.Type, request.Data) state := &amp;core.State{ SessionID: request.SessionID, UserID: request.UserID, } results, err := ts.runner.ProcessEvent(ctx, event) if err != nil { return nil, err } return &amp;api.Response{ Status: &#34;success&#34;, Data: results[len(results)-1].Data, Trace: convertToTrace(results), }, nil } func (ts *TestSystem) SimulateServiceFailure(serviceName string) { if service, exists := ts.mockServices[serviceName]; exists { service.SetFailure(&#34;*&#34;, errors.New(&#34;simulated service failure&#34;)) } } func (ts *TestSystem) Cleanup() { // Cleanup resources for _, service := range ts.mockServices { service.AssertExpectations(&amp;testing.T{}) } }📊 Test Data Management 1. Test Data Builders type EventBuilder struct { eventType string data map[string]interface{} metadata map[string]interface{} } func NewEventBuilder(eventType string) *EventBuilder { return &amp;EventBuilder{ eventType: eventType, data: make(map[string]interface{}), metadata: make(map[string]interface{}), } } func (b *EventBuilder) WithData(key string, value interface{}) *EventBuilder { b.data[key] = value return b } func (b *EventBuilder) WithMetadata(key string, value interface{}) *EventBuilder { b.metadata[key] = value return b } func (b *EventBuilder) Build() core.Event { event := core.NewEvent(b.eventType, b.data) for key, value := range b.metadata { event.Metadata[key] = value } return event } type StateBuilder struct { sessionID string userID string data map[string]interface{} } func NewStateBuilder() *StateBuilder { return &amp;StateBuilder{ data: make(map[string]interface{}), } } func (b *StateBuilder) WithSession(sessionID string) *StateBuilder { b.sessionID = sessionID return b } func (b *StateBuilder) WithUser(userID string) *StateBuilder { b.userID = userID return b } func (b *StateBuilder) WithData(key string, value interface{}) *StateBuilder { b.data[key] = value return b } func (b *StateBuilder) Build() *core.State { return &amp;core.State{ SessionID: b.sessionID, UserID: b.userID, Data: b.data, } }2. Test Scenarios func TestCommonScenarios(t *testing.T) { scenarios := []struct { name string setup func() (*TestSystem, core.Event, *core.State) validate func(*testing.T, *core.AgentResult, error) }{ { name: &#34;successful_analysis&#34;, setup: func() (*TestSystem, core.Event, *core.State) { system := NewTestSystemBuilder(). WithAgent(&#34;analyzer&#34;, NewMockAnalyzer(&#34;success&#34;)). Build() event := NewEventBuilder(&#34;analyze&#34;). WithData(&#34;content&#34;, &#34;test data&#34;). Build() state := NewStateBuilder(). WithSession(&#34;test-session&#34;). Build() return system, event, state }, validate: func(t *testing.T, result *core.AgentResult, err error) { assert.NoError(t, err) assert.Equal(t, &#34;completed&#34;, result.Data[&#34;status&#34;]) }, }, { name: &#34;timeout_handling&#34;, setup: func() (*TestSystem, core.Event, *core.State) { system := NewTestSystemBuilder(). WithAgent(&#34;slow_agent&#34;, NewSlowMockAgent(10*time.Second)). Build() event := NewEventBuilder(&#34;process&#34;). WithData(&#34;timeout&#34;, &#34;5s&#34;). Build() state := NewStateBuilder(). WithSession(&#34;timeout-test&#34;). Build() return system, event, state }, validate: func(t *testing.T, result *core.AgentResult, err error) { assert.Error(t, err) assert.Contains(t, err.Error(), &#34;timeout&#34;) }, }, } for _, scenario := range scenarios { t.Run(scenario.name, func(t *testing.T) { system, event, state := scenario.setup() defer system.Cleanup() result, err := system.ProcessSingleEvent(context.Background(), event, state) scenario.validate(t, result, err) }) } }🎯 Best Practices 1. Test Organization // Package structure for tests // agents/ // analyzer_test.go - Unit tests for analyzer agent // validator_test.go - Unit tests for validator agent // integration_test.go - Integration tests between agents // orchestration/ // sequential_test.go - Sequential orchestration tests // collaborative_test.go - Collaborative orchestration tests // system/ // e2e_test.go - End-to-end system tests // performance_test.go - Performance and load tests // testutils/ // builders.go - Test data builders // mocks.go - Mock implementations // fixtures.go - Test fixtures and helpers2. Test Configuration // Test configuration management type TestConfig struct { DatabaseURL string RedisURL string MockServices bool LogLevel string TestTimeout time.Duration } func LoadTestConfig() *TestConfig { return &amp;TestConfig{ DatabaseURL: getEnvOrDefault(&#34;TEST_DATABASE_URL&#34;, &#34;postgres://localhost/agentflow_test&#34;), RedisURL: getEnvOrDefault(&#34;TEST_REDIS_URL&#34;, &#34;redis://localhost:6379/1&#34;), MockServices: getEnvOrDefault(&#34;MOCK_SERVICES&#34;, &#34;true&#34;) == &#34;true&#34;, LogLevel: getEnvOrDefault(&#34;TEST_LOG_LEVEL&#34;, &#34;error&#34;), TestTimeout: 30 * time.Second, } }3. Continuous Integration # .github/workflows/test.yml name: Test Suite on: [push, pull_request] jobs: unit-tests: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - uses: actions/setup-go@v3 with: go-version: &#39;1.21&#39; - name: Run unit tests run: go test -v -race -coverprofile=coverage.out ./... - name: Upload coverage uses: codecov/codecov-action@v3 integration-tests: runs-on: ubuntu-latest services: postgres: image: pgvector/pgvector:pg15 env: POSTGRES_PASSWORD: test POSTGRES_DB: agentflow_test options: &gt;- --health-cmd pg_isready --health-interval 10s --health-timeout 5s --health-retries 5 redis: image: redis:7-alpine options: &gt;- --health-cmd &#34;redis-cli ping&#34; --health-interval 10s --health-timeout 5s --health-retries 5 steps: - uses: actions/checkout@v3 - uses: actions/setup-go@v3 with: go-version: &#39;1.21&#39; - name: Run integration tests run: go test -v -tags=integration ./... env: TEST_DATABASE_URL: postgres://postgres:test@localhost:5432/agentflow_test TEST_REDIS_URL: redis://localhost:6379/1 e2e-tests: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - uses: actions/setup-go@v3 with: go-version: &#39;1.21&#39; - name: Start test environment run: docker-compose -f docker-compose.test.yml up -d - name: Wait for services run: ./scripts/wait-for-services.sh - name: Run E2E tests run: go test -v -tags=e2e ./... - name: Cleanup run: docker-compose -f docker-compose.test.yml downTesting multi-agent systems requires a comprehensive approach that covers unit, integration, and end-to-end scenarios. By following these strategies and patterns, you can build reliable and maintainable agent systems with confidence.">
    <meta itemprop="datePublished" content="2025-07-25T00:00:00+00:00">
    <meta itemprop="dateModified" content="2025-07-25T00:00:00+00:00">
    <meta itemprop="wordCount" content="2516">
    <title>testing-strategies :: AgenticGoKit Docs</title>
    <link href="/AgenticGoKitDocs/css/auto-complete/auto-complete.min.css?1753430931" rel="stylesheet">
    <script src="/AgenticGoKitDocs/js/auto-complete/auto-complete.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/search-lunr.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/search.js?1753430931" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/AgenticGoKitDocs/searchindex.en.js?1753430931";
    </script>
    <script src="/AgenticGoKitDocs/js/lunr/lunr.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/lunr/lunr.stemmer.support.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/lunr/lunr.multi.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/lunr/lunr.en.min.js?1753430931" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/AgenticGoKitDocs/fonts/fontawesome/css/fontawesome-all.min.css?1753430931" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/AgenticGoKitDocs/fonts/fontawesome/css/fontawesome-all.min.css?1753430931" rel="stylesheet"></noscript>
    <link href="/AgenticGoKitDocs/css/perfect-scrollbar/perfect-scrollbar.min.css?1753430931" rel="stylesheet">
    <link href="/AgenticGoKitDocs/css/theme.css?1753430931" rel="stylesheet">
    <link href="/AgenticGoKitDocs/css/format-html.css?1753430931" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = ``;
      window.relearn.path='\/tutorials\/advanced\/testing-strategies\/index.html';
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..\/..';
      window.relearn.absBaseUri='http:\/\/localhost:1313\/AgenticGoKitDocs';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=false;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'blue' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
  </head>
  <body class="mobile-support html" data-url="/AgenticGoKitDocs/tutorials/advanced/testing-strategies/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li><a href="#-testing-pyramid-for-agent-systems">🧪 Testing Pyramid for Agent Systems</a></li>
    <li><a href="#-unit-testing-strategies">🔧 Unit Testing Strategies</a>
      <ul>
        <li><a href="#1-testing-individual-agents"><strong>1. Testing Individual Agents</strong></a></li>
        <li><a href="#2-testing-state-management"><strong>2. Testing State Management</strong></a></li>
        <li><a href="#3-testing-error-handling"><strong>3. Testing Error Handling</strong></a></li>
      </ul>
    </li>
    <li><a href="#-integration-testing">🔗 Integration Testing</a>
      <ul>
        <li><a href="#1-testing-agent-interactions"><strong>1. Testing Agent Interactions</strong></a></li>
        <li><a href="#2-testing-memory-system-integration"><strong>2. Testing Memory System Integration</strong></a></li>
        <li><a href="#3-testing-mcp-tool-integration"><strong>3. Testing MCP Tool Integration</strong></a></li>
      </ul>
    </li>
    <li><a href="#-end-to-end-testing">🌐 End-to-End Testing</a>
      <ul>
        <li><a href="#1-full-system-tests"><strong>1. Full System Tests</strong></a></li>
        <li><a href="#2-performance-testing"><strong>2. Performance Testing</strong></a></li>
      </ul>
    </li>
    <li><a href="#-test-doubles-and-mocking">🎭 Test Doubles and Mocking</a>
      <ul>
        <li><a href="#1-mock-external-services"><strong>1. Mock External Services</strong></a></li>
        <li><a href="#2-test-fixtures-and-builders"><strong>2. Test Fixtures and Builders</strong></a></li>
      </ul>
    </li>
    <li><a href="#-test-data-management">📊 Test Data Management</a>
      <ul>
        <li><a href="#1-test-data-builders"><strong>1. Test Data Builders</strong></a></li>
        <li><a href="#2-test-scenarios"><strong>2. Test Scenarios</strong></a></li>
      </ul>
    </li>
    <li><a href="#-best-practices">🎯 Best Practices</a>
      <ul>
        <li><a href="#1-test-organization"><strong>1. Test Organization</strong></a></li>
        <li><a href="#2-test-configuration"><strong>2. Test Configuration</strong></a></li>
        <li><a href="#3-continuous-integration"><strong>3. Continuous Integration</strong></a></li>
      </ul>
    </li>
    <li><a href="#-next-steps">🚀 Next Steps</a></li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/AgenticGoKitDocs/index.html"><span itemprop="name">content</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/AgenticGoKitDocs/tutorials/index.html"><span itemprop="name">tutorials</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/AgenticGoKitDocs/tutorials/advanced/index.html"><span itemprop="name">advanced</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><span itemprop="name">testing-strategies</span><meta itemprop="position" content="4"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/AgenticGoKitDocs/tutorials/advanced/retry-policies/index.html" title="retry-policies (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/AgenticGoKitDocs/tutorials/core-concepts/index.html" title="core-concepts (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable tutorials" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="testing-strategies">testing-strategies</h1>

<h1 id="testing-strategies-for-multi-agent-systems">Testing Strategies for Multi-Agent Systems</h1>
<p><strong>Comprehensive testing approaches for building reliable and maintainable agent systems</strong></p>
<p>Testing multi-agent systems presents unique challenges due to their distributed nature, asynchronous communication, and external dependencies. This guide covers testing strategies, patterns, and tools specifically designed for AgenticGoKit applications.</p>
<h2 id="-testing-pyramid-for-agent-systems">🧪 Testing Pyramid for Agent Systems</h2>
<pre class="mermaid align-center ">flowchart TD
    subgraph &#34;End-to-End Tests (10%)&#34;
        E2E1[Full System Tests]
        E2E2[User Journey Tests]
        E2E3[Performance Tests]
    end
    
    subgraph &#34;Integration Tests (30%)&#34;
        INT1[Agent Interaction Tests]
        INT2[External Service Tests]
        INT3[Orchestration Tests]
        INT4[Memory System Tests]
        INT5[MCP Tool Tests]
    end
    
    subgraph &#34;Unit Tests (60%)&#34;
        UNIT1[Individual Agent Tests]
        UNIT2[Business Logic Tests]
        UNIT3[Utility Function Tests]
        UNIT4[Error Handling Tests]
        UNIT5[State Management Tests]
    end
    
    E2E1 --&gt; INT1
    E2E2 --&gt; INT2
    E2E3 --&gt; INT3
    INT1 --&gt; UNIT1
    INT2 --&gt; UNIT2
    INT3 --&gt; UNIT3
    INT4 --&gt; UNIT4
    INT5 --&gt; UNIT5
    
    classDef e2e fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef integration fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef unit fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    
    class E2E1,E2E2,E2E3 e2e
    class INT1,INT2,INT3,INT4,INT5 integration
    class UNIT1,UNIT2,UNIT3,UNIT4,UNIT5 unit</pre>
<h2 id="-unit-testing-strategies">🔧 Unit Testing Strategies</h2>
<h3 id="1-testing-individual-agents"><strong>1. Testing Individual Agents</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">agents</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;testing&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;github.com/stretchr/testify/assert&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;github.com/stretchr/testify/mock&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;github.com/kunalkushwaha/agenticgokit/core&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Mock LLM Provider for testing</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MockLLMProvider</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Mock</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MockLLMProvider</span>) <span style="color:#a6e22e">GenerateResponse</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">prompt</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">options</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}) (<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">args</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">Called</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">prompt</span>, <span style="color:#a6e22e">options</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">args</span>.<span style="color:#a6e22e">String</span>(<span style="color:#ae81ff">0</span>), <span style="color:#a6e22e">args</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestAnalyzerAgent_Execute</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tests</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span>           <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">event</span>          <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">Event</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">state</span>          <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">mockResponse</span>   <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">mockError</span>      <span style="color:#66d9ef">error</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">expectedResult</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">expectedError</span>  <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    }{
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;successful analysis&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">event</span>: <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">NewEvent</span>(<span style="color:#e6db74">&#34;analyze&#34;</span>, <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;data&#34;</span>: <span style="color:#e6db74">&#34;Sample data to analyze&#34;</span>,
</span></span><span style="display:flex;"><span>            }),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">state</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">SessionID</span>: <span style="color:#e6db74">&#34;test-session&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Data</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;context&#34;</span>: <span style="color:#e6db74">&#34;test context&#34;</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">mockResponse</span>: <span style="color:#e6db74">&#34;Analysis complete: The data shows positive trends&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">expectedResult</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;analysis&#34;</span>: <span style="color:#e6db74">&#34;Analysis complete: The data shows positive trends&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;agent&#34;</span>:    <span style="color:#e6db74">&#34;analyzer&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;status&#34;</span>:   <span style="color:#e6db74">&#34;completed&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;empty data handling&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">event</span>: <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">NewEvent</span>(<span style="color:#e6db74">&#34;analyze&#34;</span>, <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;data&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>            }),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">state</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>{<span style="color:#a6e22e">SessionID</span>: <span style="color:#e6db74">&#34;test-session&#34;</span>},
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">expectedError</span>: <span style="color:#e6db74">&#34;no data provided for analysis&#34;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;LLM provider error&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">event</span>: <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">NewEvent</span>(<span style="color:#e6db74">&#34;analyze&#34;</span>, <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;data&#34;</span>: <span style="color:#e6db74">&#34;Sample data&#34;</span>,
</span></span><span style="display:flex;"><span>            }),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">state</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>{<span style="color:#a6e22e">SessionID</span>: <span style="color:#e6db74">&#34;test-session&#34;</span>},
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">mockError</span>: <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;LLM service unavailable&#34;</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">expectedError</span>: <span style="color:#e6db74">&#34;LLM request failed: LLM service unavailable&#34;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">tt</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">tests</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">name</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Setup mock</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">mockProvider</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">MockLLMProvider</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">mockResponse</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">mockError</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">mockProvider</span>.<span style="color:#a6e22e">On</span>(<span style="color:#e6db74">&#34;GenerateResponse&#34;</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">AnythingOfType</span>(<span style="color:#e6db74">&#34;string&#34;</span>), <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>).
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">Return</span>(<span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">mockResponse</span>, <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">mockError</span>)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Create agent with mock</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">agent</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewAnalyzerAgent</span>(<span style="color:#e6db74">&#34;analyzer&#34;</span>, <span style="color:#a6e22e">mockProvider</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Execute test</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">state</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Assertions</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">expectedError</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>(), <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">expectedError</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Nil</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">result</span>)
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">NoError</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">NotNil</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">result</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">expectedValue</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">expectedResult</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Equal</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">expectedValue</span>, <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#a6e22e">key</span>])
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Verify mock expectations</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">mockProvider</span>.<span style="color:#a6e22e">AssertExpectations</span>(<span style="color:#a6e22e">t</span>)
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="2-testing-state-management"><strong>2. Testing State Management</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestStateTransformations</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tests</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span>           <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">initialState</span>   <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">transformation</span> <span style="color:#66d9ef">func</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">expectedData</span>   <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}
</span></span><span style="display:flex;"><span>    }{
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;add analysis result&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">initialState</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">SessionID</span>: <span style="color:#e6db74">&#34;test&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Data</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;input&#34;</span>: <span style="color:#e6db74">&#34;test data&#34;</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">transformation</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">state</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">newState</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">Clone</span>()
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">newState</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#e6db74">&#34;analysis&#34;</span>] = <span style="color:#e6db74">&#34;completed&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">newState</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#e6db74">&#34;confidence&#34;</span>] = <span style="color:#ae81ff">0.95</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">newState</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">expectedData</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;input&#34;</span>:      <span style="color:#e6db74">&#34;test data&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;analysis&#34;</span>:   <span style="color:#e6db74">&#34;completed&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;confidence&#34;</span>: <span style="color:#ae81ff">0.95</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;merge states&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">initialState</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">SessionID</span>: <span style="color:#e6db74">&#34;test&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Data</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;step1&#34;</span>: <span style="color:#e6db74">&#34;completed&#34;</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">transformation</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">state</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">additionalData</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;step2&#34;</span>: <span style="color:#e6db74">&#34;completed&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;final&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">Merge</span>(<span style="color:#a6e22e">additionalData</span>)
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">expectedData</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;step1&#34;</span>: <span style="color:#e6db74">&#34;completed&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;step2&#34;</span>: <span style="color:#e6db74">&#34;completed&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;final&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">tt</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">tests</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">name</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">result</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">transformation</span>(<span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">initialState</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">expected</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">expectedData</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Equal</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">expected</span>, <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#a6e22e">key</span>])
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="3-testing-error-handling"><strong>3. Testing Error Handling</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestErrorHandling</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tests</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span>          <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">setupMock</span>     <span style="color:#66d9ef">func</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">MockLLMProvider</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">expectedError</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">shouldRetry</span>   <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span>    }{
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;timeout error&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">setupMock</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MockLLMProvider</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">On</span>(<span style="color:#e6db74">&#34;GenerateResponse&#34;</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>).
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">Return</span>(<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">DeadlineExceeded</span>)
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">expectedError</span>: <span style="color:#e6db74">&#34;context deadline exceeded&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">shouldRetry</span>:   <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;rate limit error&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">setupMock</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MockLLMProvider</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">On</span>(<span style="color:#e6db74">&#34;GenerateResponse&#34;</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>).
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">Return</span>(<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;rate limit exceeded&#34;</span>))
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">expectedError</span>: <span style="color:#e6db74">&#34;rate limit exceeded&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">shouldRetry</span>:   <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;authentication error&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">setupMock</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MockLLMProvider</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">On</span>(<span style="color:#e6db74">&#34;GenerateResponse&#34;</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>).
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">Return</span>(<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;invalid API key&#34;</span>))
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">expectedError</span>: <span style="color:#e6db74">&#34;invalid API key&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">shouldRetry</span>:   <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">tt</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">tests</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">name</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">mockProvider</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">MockLLMProvider</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">setupMock</span>(<span style="color:#a6e22e">mockProvider</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">agent</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewResilientAgent</span>(<span style="color:#e6db74">&#34;test&#34;</span>, <span style="color:#a6e22e">mockProvider</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">event</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">NewEvent</span>(<span style="color:#e6db74">&#34;test&#34;</span>, <span style="color:#e6db74">&#34;data&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">state</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>{<span style="color:#a6e22e">SessionID</span>: <span style="color:#e6db74">&#34;test&#34;</span>}
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">state</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>(), <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">expectedError</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Test retry behavior</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">shouldRetry</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Verify that retries were attempted</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">True</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">mockProvider</span>.<span style="color:#a6e22e">AssertNumberOfCalls</span>(<span style="color:#a6e22e">t</span>, <span style="color:#e6db74">&#34;GenerateResponse&#34;</span>, <span style="color:#ae81ff">3</span>))
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Verify that no retries were attempted</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">True</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">mockProvider</span>.<span style="color:#a6e22e">AssertNumberOfCalls</span>(<span style="color:#a6e22e">t</span>, <span style="color:#e6db74">&#34;GenerateResponse&#34;</span>, <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="-integration-testing">🔗 Integration Testing</h2>
<h3 id="1-testing-agent-interactions"><strong>1. Testing Agent Interactions</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestAgentOrchestration</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Setup test agents</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mockProvider</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">MockLLMProvider</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mockProvider</span>.<span style="color:#a6e22e">On</span>(<span style="color:#e6db74">&#34;GenerateResponse&#34;</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">MatchedBy</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">prompt</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">bool</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">prompt</span>, <span style="color:#e6db74">&#34;analyze&#34;</span>)
</span></span><span style="display:flex;"><span>    }), <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>).<span style="color:#a6e22e">Return</span>(<span style="color:#e6db74">&#34;Analysis: Data processed&#34;</span>, <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mockProvider</span>.<span style="color:#a6e22e">On</span>(<span style="color:#e6db74">&#34;GenerateResponse&#34;</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">MatchedBy</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">prompt</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">bool</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">prompt</span>, <span style="color:#e6db74">&#34;validate&#34;</span>)
</span></span><span style="display:flex;"><span>    }), <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>).<span style="color:#a6e22e">Return</span>(<span style="color:#e6db74">&#34;Validation: Data is valid&#34;</span>, <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">analyzer</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewAnalyzerAgent</span>(<span style="color:#e6db74">&#34;analyzer&#34;</span>, <span style="color:#a6e22e">mockProvider</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">validator</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewValidatorAgent</span>(<span style="color:#e6db74">&#34;validator&#34;</span>, <span style="color:#a6e22e">mockProvider</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Create sequential runner</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">agents</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;analyzer&#34;</span>:  <span style="color:#a6e22e">analyzer</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;validator&#34;</span>: <span style="color:#a6e22e">validator</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">config</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">RunnerConfig</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">OrchestrationMode</span>: <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">OrchestrationSequential</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SequentialAgents</span>:  []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;analyzer&#34;</span>, <span style="color:#e6db74">&#34;validator&#34;</span>},
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Timeout</span>:          <span style="color:#ae81ff">30</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">runner</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">NewRunnerWithConfig</span>(<span style="color:#a6e22e">config</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">agent</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">agents</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">runner</span>.<span style="color:#a6e22e">RegisterAgent</span>(<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">agent</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Test sequential execution</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">event</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">NewEvent</span>(<span style="color:#e6db74">&#34;process&#34;</span>, <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;data&#34;</span>: <span style="color:#e6db74">&#34;test data for processing&#34;</span>,
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">results</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">runner</span>.<span style="color:#a6e22e">ProcessEvent</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">event</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">NoError</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Len</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">results</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Verify execution order and data flow</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">analyzerResult</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">results</span>[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">validatorResult</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">results</span>[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Equal</span>(<span style="color:#a6e22e">t</span>, <span style="color:#e6db74">&#34;analyzer&#34;</span>, <span style="color:#a6e22e">analyzerResult</span>.<span style="color:#a6e22e">Agent</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">analyzerResult</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#e6db74">&#34;analysis&#34;</span>], <span style="color:#e6db74">&#34;Data processed&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Equal</span>(<span style="color:#a6e22e">t</span>, <span style="color:#e6db74">&#34;validator&#34;</span>, <span style="color:#a6e22e">validatorResult</span>.<span style="color:#a6e22e">Agent</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">validatorResult</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#e6db74">&#34;validation&#34;</span>], <span style="color:#e6db74">&#34;Data is valid&#34;</span>)
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="2-testing-memory-system-integration"><strong>2. Testing Memory System Integration</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestMemorySystemIntegration</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Setup in-memory test database</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">memoryProvider</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">memory</span>.<span style="color:#a6e22e">NewInMemoryProvider</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Create agent with memory</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">agent</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewMemoryEnabledAgent</span>(<span style="color:#e6db74">&#34;test-agent&#34;</span>, <span style="color:#a6e22e">mockLLMProvider</span>, <span style="color:#a6e22e">memoryProvider</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Test storing and retrieving memories</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#e6db74">&#34;store and retrieve memory&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">event</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">NewEvent</span>(<span style="color:#e6db74">&#34;remember&#34;</span>, <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;fact&#34;</span>: <span style="color:#e6db74">&#34;The sky is blue&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;category&#34;</span>: <span style="color:#e6db74">&#34;general_knowledge&#34;</span>,
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">state</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">SessionID</span>: <span style="color:#e6db74">&#34;test-session&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">UserID</span>:    <span style="color:#e6db74">&#34;test-user&#34;</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">state</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">NoError</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Equal</span>(<span style="color:#a6e22e">t</span>, <span style="color:#e6db74">&#34;stored&#34;</span>, <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#e6db74">&#34;status&#34;</span>])
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Verify memory was stored</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">memories</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">memoryProvider</span>.<span style="color:#a6e22e">Search</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#e6db74">&#34;sky blue&#34;</span>, <span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">NoError</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Len</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">memories</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">memories</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">Content</span>, <span style="color:#e6db74">&#34;sky is blue&#34;</span>)
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#e6db74">&#34;RAG retrieval&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Setup mock to expect context from memory</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">mockProvider</span>.<span style="color:#a6e22e">On</span>(<span style="color:#e6db74">&#34;GenerateResponse&#34;</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>, <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">MatchedBy</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">prompt</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">bool</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">prompt</span>, <span style="color:#e6db74">&#34;sky is blue&#34;</span>)
</span></span><span style="display:flex;"><span>        }), <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Anything</span>).<span style="color:#a6e22e">Return</span>(<span style="color:#e6db74">&#34;Based on the stored knowledge, the sky appears blue due to light scattering&#34;</span>, <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">event</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">NewEvent</span>(<span style="color:#e6db74">&#34;query&#34;</span>, <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;question&#34;</span>: <span style="color:#e6db74">&#34;What color is the sky?&#34;</span>,
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">state</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>{<span style="color:#a6e22e">SessionID</span>: <span style="color:#e6db74">&#34;test-session&#34;</span>}
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">state</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">NoError</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#e6db74">&#34;response&#34;</span>], <span style="color:#e6db74">&#34;blue due to light scattering&#34;</span>)
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="3-testing-mcp-tool-integration"><strong>3. Testing MCP Tool Integration</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestMCPToolIntegration</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Setup mock MCP server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mockServer</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">MockMCPServer</span>{}
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mockServer</span>.<span style="color:#a6e22e">On</span>(<span style="color:#e6db74">&#34;ExecuteTool&#34;</span>, <span style="color:#e6db74">&#34;web_search&#34;</span>, <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;query&#34;</span>: <span style="color:#e6db74">&#34;AgenticGoKit testing&#34;</span>,
</span></span><span style="display:flex;"><span>    }).<span style="color:#a6e22e">Return</span>(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;results&#34;</span>: []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;AgenticGoKit is a Go framework for building multi-agent systems&#34;</span>},
</span></span><span style="display:flex;"><span>    }, <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Create agent with MCP tools</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">toolManager</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mcp</span>.<span style="color:#a6e22e">NewToolManager</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">toolManager</span>.<span style="color:#a6e22e">RegisterServer</span>(<span style="color:#e6db74">&#34;test-server&#34;</span>, <span style="color:#a6e22e">mockServer</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">agent</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewToolEnabledAgent</span>(<span style="color:#e6db74">&#34;test-agent&#34;</span>, <span style="color:#a6e22e">mockLLMProvider</span>, <span style="color:#a6e22e">toolManager</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">event</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">NewEvent</span>(<span style="color:#e6db74">&#34;search&#34;</span>, <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;query&#34;</span>: <span style="color:#e6db74">&#34;AgenticGoKit testing&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;tool&#34;</span>:  <span style="color:#e6db74">&#34;web_search&#34;</span>,
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">state</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>{<span style="color:#a6e22e">SessionID</span>: <span style="color:#e6db74">&#34;test-session&#34;</span>}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">state</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">NoError</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#e6db74">&#34;search_results&#34;</span>], <span style="color:#e6db74">&#34;Go framework&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mockServer</span>.<span style="color:#a6e22e">AssertExpectations</span>(<span style="color:#a6e22e">t</span>)
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="-end-to-end-testing">🌐 End-to-End Testing</h2>
<h3 id="1-full-system-tests"><strong>1. Full System Tests</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestFullSystemWorkflow</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Setup complete system</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">system</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">setupTestSystem</span>(<span style="color:#a6e22e">t</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">system</span>.<span style="color:#a6e22e">Cleanup</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Test complete user workflow</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#e6db74">&#34;research assistant workflow&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Step 1: User asks a question</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">request</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">Request</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Type</span>: <span style="color:#e6db74">&#34;research_query&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Data</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;question&#34;</span>: <span style="color:#e6db74">&#34;What are the latest developments in AI agent frameworks?&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;depth&#34;</span>:    <span style="color:#e6db74">&#34;comprehensive&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">UserID</span>:    <span style="color:#e6db74">&#34;test-user&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">SessionID</span>: <span style="color:#e6db74">&#34;test-session&#34;</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">response</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">system</span>.<span style="color:#a6e22e">ProcessRequest</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">request</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">NoError</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Verify response structure</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">NotNil</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">response</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Equal</span>(<span style="color:#a6e22e">t</span>, <span style="color:#e6db74">&#34;success&#34;</span>, <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">Status</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">Data</span>, <span style="color:#e6db74">&#34;research_results&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">Data</span>, <span style="color:#e6db74">&#34;sources&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">Data</span>, <span style="color:#e6db74">&#34;summary&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Verify agent execution trace</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">trace</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">Trace</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">NotEmpty</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">trace</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Should have executed: researcher -&gt; analyzer -&gt; validator -&gt; formatter</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">expectedAgents</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;researcher&#34;</span>, <span style="color:#e6db74">&#34;analyzer&#34;</span>, <span style="color:#e6db74">&#34;validator&#34;</span>, <span style="color:#e6db74">&#34;formatter&#34;</span>}
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Len</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">trace</span>, len(<span style="color:#a6e22e">expectedAgents</span>))
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">expectedAgent</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">expectedAgents</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Equal</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">expectedAgent</span>, <span style="color:#a6e22e">trace</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">Agent</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Equal</span>(<span style="color:#a6e22e">t</span>, <span style="color:#e6db74">&#34;completed&#34;</span>, <span style="color:#a6e22e">trace</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">Status</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#e6db74">&#34;error handling workflow&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Simulate external service failure</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">system</span>.<span style="color:#a6e22e">SimulateServiceFailure</span>(<span style="color:#e6db74">&#34;web_search&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">request</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">Request</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Type</span>: <span style="color:#e6db74">&#34;research_query&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Data</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;question&#34;</span>: <span style="color:#e6db74">&#34;Test question&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">UserID</span>:    <span style="color:#e6db74">&#34;test-user&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">SessionID</span>: <span style="color:#e6db74">&#34;test-session-2&#34;</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">response</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">system</span>.<span style="color:#a6e22e">ProcessRequest</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">request</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Should handle gracefully with fallback</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">NoError</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Equal</span>(<span style="color:#a6e22e">t</span>, <span style="color:#e6db74">&#34;partial_success&#34;</span>, <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">Status</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">Data</span>, <span style="color:#e6db74">&#34;fallback_response&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">Warnings</span>, <span style="color:#e6db74">&#34;web search unavailable&#34;</span>)
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="2-performance-testing"><strong>2. Performance Testing</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestSystemPerformance</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">system</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">setupTestSystem</span>(<span style="color:#a6e22e">t</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">system</span>.<span style="color:#a6e22e">Cleanup</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#e6db74">&#34;concurrent request handling&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">concurrency</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">requestsPerWorker</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">wg</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">results</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>, <span style="color:#a6e22e">concurrency</span><span style="color:#f92672">*</span><span style="color:#a6e22e">requestsPerWorker</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">errors</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">error</span>, <span style="color:#a6e22e">concurrency</span><span style="color:#f92672">*</span><span style="color:#a6e22e">requestsPerWorker</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">concurrency</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">workerID</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">j</span> &lt; <span style="color:#a6e22e">requestsPerWorker</span>; <span style="color:#a6e22e">j</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">start</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">request</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">Request</span>{
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">Type</span>: <span style="color:#e6db74">&#34;simple_query&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">Data</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;question&#34;</span>: <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;Test question %d-%d&#34;</span>, <span style="color:#a6e22e">workerID</span>, <span style="color:#a6e22e">j</span>),
</span></span><span style="display:flex;"><span>                        },
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">UserID</span>:    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;user-%d&#34;</span>, <span style="color:#a6e22e">workerID</span>),
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">SessionID</span>: <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;session-%d-%d&#34;</span>, <span style="color:#a6e22e">workerID</span>, <span style="color:#a6e22e">j</span>),
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">system</span>.<span style="color:#a6e22e">ProcessRequest</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">request</span>)
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">duration</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Since</span>(<span style="color:#a6e22e">start</span>)
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">errors</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>                    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">results</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">duration</span>
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }(<span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Wait</span>()
</span></span><span style="display:flex;"><span>        close(<span style="color:#a6e22e">results</span>)
</span></span><span style="display:flex;"><span>        close(<span style="color:#a6e22e">errors</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Collect results</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">durations</span> []<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">duration</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">results</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">durations</span> = append(<span style="color:#a6e22e">durations</span>, <span style="color:#a6e22e">duration</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">errorList</span> []<span style="color:#66d9ef">error</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">errors</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">errorList</span> = append(<span style="color:#a6e22e">errorList</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Assertions</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Empty</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">errorList</span>, <span style="color:#e6db74">&#34;No errors should occur during concurrent processing&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Len</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">durations</span>, <span style="color:#a6e22e">concurrency</span><span style="color:#f92672">*</span><span style="color:#a6e22e">requestsPerWorker</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Performance assertions</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">avgDuration</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">calculateAverage</span>(<span style="color:#a6e22e">durations</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">maxDuration</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">calculateMax</span>(<span style="color:#a6e22e">durations</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Less</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">avgDuration</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">*</span><span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>, <span style="color:#e6db74">&#34;Average response time should be under 5 seconds&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Less</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">maxDuration</span>, <span style="color:#ae81ff">10</span><span style="color:#f92672">*</span><span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>, <span style="color:#e6db74">&#34;Max response time should be under 10 seconds&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Logf</span>(<span style="color:#e6db74">&#34;Performance results: avg=%v, max=%v, total_requests=%d&#34;</span>, 
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">avgDuration</span>, <span style="color:#a6e22e">maxDuration</span>, len(<span style="color:#a6e22e">durations</span>))
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="-test-doubles-and-mocking">🎭 Test Doubles and Mocking</h2>
<h3 id="1-mock-external-services"><strong>1. Mock External Services</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MockExternalService</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mock</span>.<span style="color:#a6e22e">Mock</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">responses</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">delays</span>    <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">failures</span>  <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">error</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewMockExternalService</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">MockExternalService</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">MockExternalService</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">responses</span>: make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">delays</span>:    make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">failures</span>:  make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">error</span>),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MockExternalService</span>) <span style="color:#a6e22e">SetResponse</span>(<span style="color:#a6e22e">endpoint</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">response</span> <span style="color:#66d9ef">interface</span>{}) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">responses</span>[<span style="color:#a6e22e">endpoint</span>] = <span style="color:#a6e22e">response</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MockExternalService</span>) <span style="color:#a6e22e">SetDelay</span>(<span style="color:#a6e22e">endpoint</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">delay</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">delays</span>[<span style="color:#a6e22e">endpoint</span>] = <span style="color:#a6e22e">delay</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MockExternalService</span>) <span style="color:#a6e22e">SetFailure</span>(<span style="color:#a6e22e">endpoint</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">failures</span>[<span style="color:#a6e22e">endpoint</span>] = <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MockExternalService</span>) <span style="color:#a6e22e">Call</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">endpoint</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">params</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}) (<span style="color:#66d9ef">interface</span>{}, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Simulate delay</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">delay</span>, <span style="color:#a6e22e">exists</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">delays</span>[<span style="color:#a6e22e">endpoint</span>]; <span style="color:#a6e22e">exists</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">select</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">After</span>(<span style="color:#a6e22e">delay</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">Done</span>():
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">Err</span>()
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Simulate failure</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">exists</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">failures</span>[<span style="color:#a6e22e">endpoint</span>]; <span style="color:#a6e22e">exists</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Return mock response</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">response</span>, <span style="color:#a6e22e">exists</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">responses</span>[<span style="color:#a6e22e">endpoint</span>]; <span style="color:#a6e22e">exists</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">response</span>, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;endpoint not mocked&#34;</span>)
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="2-test-fixtures-and-builders"><strong>2. Test Fixtures and Builders</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">TestSystemBuilder</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">agents</span>      <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mockServices</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#f92672">*</span><span style="color:#a6e22e">MockExternalService</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">config</span>      <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">RunnerConfig</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewTestSystemBuilder</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">TestSystemBuilder</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">TestSystemBuilder</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">agents</span>:       make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">mockServices</span>: make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#f92672">*</span><span style="color:#a6e22e">MockExternalService</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">config</span>: <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">RunnerConfig</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">OrchestrationMode</span>: <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">OrchestrationSequential</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Timeout</span>:          <span style="color:#ae81ff">30</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TestSystemBuilder</span>) <span style="color:#a6e22e">WithAgent</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">agent</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">TestSystemBuilder</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">agents</span>[<span style="color:#a6e22e">name</span>] = <span style="color:#a6e22e">agent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">b</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TestSystemBuilder</span>) <span style="color:#a6e22e">WithMockService</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">service</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MockExternalService</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">TestSystemBuilder</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">mockServices</span>[<span style="color:#a6e22e">name</span>] = <span style="color:#a6e22e">service</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">b</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TestSystemBuilder</span>) <span style="color:#a6e22e">WithOrchestration</span>(<span style="color:#a6e22e">mode</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">OrchestrationMode</span>, <span style="color:#a6e22e">agents</span> []<span style="color:#66d9ef">string</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">TestSystemBuilder</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">OrchestrationMode</span> = <span style="color:#a6e22e">mode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">switch</span> <span style="color:#a6e22e">mode</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">OrchestrationSequential</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">SequentialAgents</span> = <span style="color:#a6e22e">agents</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">OrchestrationCollaborative</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">CollaborativeAgents</span> = <span style="color:#a6e22e">agents</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">b</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TestSystemBuilder</span>) <span style="color:#a6e22e">Build</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">TestSystem</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">runner</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">NewRunnerWithConfig</span>(<span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">config</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">agent</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">agents</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">runner</span>.<span style="color:#a6e22e">RegisterAgent</span>(<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">agent</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">TestSystem</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">runner</span>:       <span style="color:#a6e22e">runner</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">mockServices</span>: <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">mockServices</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">TestSystem</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">runner</span>       <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">Runner</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mockServices</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#f92672">*</span><span style="color:#a6e22e">MockExternalService</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">ts</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TestSystem</span>) <span style="color:#a6e22e">ProcessRequest</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">request</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">Request</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">Response</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">event</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">NewEvent</span>(<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">Type</span>, <span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">Data</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">state</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SessionID</span>: <span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">SessionID</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">UserID</span>:    <span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">UserID</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">results</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ts</span>.<span style="color:#a6e22e">runner</span>.<span style="color:#a6e22e">ProcessEvent</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">event</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">Response</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Status</span>: <span style="color:#e6db74">&#34;success&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Data</span>:   <span style="color:#a6e22e">results</span>[len(<span style="color:#a6e22e">results</span>)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>].<span style="color:#a6e22e">Data</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Trace</span>:  <span style="color:#a6e22e">convertToTrace</span>(<span style="color:#a6e22e">results</span>),
</span></span><span style="display:flex;"><span>    }, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">ts</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TestSystem</span>) <span style="color:#a6e22e">SimulateServiceFailure</span>(<span style="color:#a6e22e">serviceName</span> <span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">service</span>, <span style="color:#a6e22e">exists</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ts</span>.<span style="color:#a6e22e">mockServices</span>[<span style="color:#a6e22e">serviceName</span>]; <span style="color:#a6e22e">exists</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">SetFailure</span>(<span style="color:#e6db74">&#34;*&#34;</span>, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;simulated service failure&#34;</span>))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">ts</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TestSystem</span>) <span style="color:#a6e22e">Cleanup</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Cleanup resources</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">service</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">ts</span>.<span style="color:#a6e22e">mockServices</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">AssertExpectations</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>{})
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="-test-data-management">📊 Test Data Management</h2>
<h3 id="1-test-data-builders"><strong>1. Test Data Builders</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">EventBuilder</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">eventType</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">data</span>      <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">metadata</span>  <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewEventBuilder</span>(<span style="color:#a6e22e">eventType</span> <span style="color:#66d9ef">string</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">EventBuilder</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">EventBuilder</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">eventType</span>: <span style="color:#a6e22e">eventType</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">data</span>:      make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">metadata</span>:  make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">EventBuilder</span>) <span style="color:#a6e22e">WithData</span>(<span style="color:#a6e22e">key</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">value</span> <span style="color:#66d9ef">interface</span>{}) <span style="color:#f92672">*</span><span style="color:#a6e22e">EventBuilder</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">key</span>] = <span style="color:#a6e22e">value</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">b</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">EventBuilder</span>) <span style="color:#a6e22e">WithMetadata</span>(<span style="color:#a6e22e">key</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">value</span> <span style="color:#66d9ef">interface</span>{}) <span style="color:#f92672">*</span><span style="color:#a6e22e">EventBuilder</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">metadata</span>[<span style="color:#a6e22e">key</span>] = <span style="color:#a6e22e">value</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">b</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">EventBuilder</span>) <span style="color:#a6e22e">Build</span>() <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">Event</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">event</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">NewEvent</span>(<span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">eventType</span>, <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">data</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">value</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">metadata</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">Metadata</span>[<span style="color:#a6e22e">key</span>] = <span style="color:#a6e22e">value</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">event</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">StateBuilder</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sessionID</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">userID</span>    <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">data</span>      <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewStateBuilder</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">StateBuilder</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">StateBuilder</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">data</span>: make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">StateBuilder</span>) <span style="color:#a6e22e">WithSession</span>(<span style="color:#a6e22e">sessionID</span> <span style="color:#66d9ef">string</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">StateBuilder</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">sessionID</span> = <span style="color:#a6e22e">sessionID</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">b</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">StateBuilder</span>) <span style="color:#a6e22e">WithUser</span>(<span style="color:#a6e22e">userID</span> <span style="color:#66d9ef">string</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">StateBuilder</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">userID</span> = <span style="color:#a6e22e">userID</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">b</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">StateBuilder</span>) <span style="color:#a6e22e">WithData</span>(<span style="color:#a6e22e">key</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">value</span> <span style="color:#66d9ef">interface</span>{}) <span style="color:#f92672">*</span><span style="color:#a6e22e">StateBuilder</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">key</span>] = <span style="color:#a6e22e">value</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">b</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">StateBuilder</span>) <span style="color:#a6e22e">Build</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SessionID</span>: <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">sessionID</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">UserID</span>:    <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">userID</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Data</span>:      <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">data</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="2-test-scenarios"><strong>2. Test Scenarios</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestCommonScenarios</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scenarios</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span>     <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">setup</span>    <span style="color:#66d9ef">func</span>() (<span style="color:#f92672">*</span><span style="color:#a6e22e">TestSystem</span>, <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">Event</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">validate</span> <span style="color:#66d9ef">func</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentResult</span>, <span style="color:#66d9ef">error</span>)
</span></span><span style="display:flex;"><span>    }{
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;successful_analysis&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">setup</span>: <span style="color:#66d9ef">func</span>() (<span style="color:#f92672">*</span><span style="color:#a6e22e">TestSystem</span>, <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">Event</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">system</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewTestSystemBuilder</span>().
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">WithAgent</span>(<span style="color:#e6db74">&#34;analyzer&#34;</span>, <span style="color:#a6e22e">NewMockAnalyzer</span>(<span style="color:#e6db74">&#34;success&#34;</span>)).
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">Build</span>()
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">event</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewEventBuilder</span>(<span style="color:#e6db74">&#34;analyze&#34;</span>).
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">WithData</span>(<span style="color:#e6db74">&#34;content&#34;</span>, <span style="color:#e6db74">&#34;test data&#34;</span>).
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">Build</span>()
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">state</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewStateBuilder</span>().
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">WithSession</span>(<span style="color:#e6db74">&#34;test-session&#34;</span>).
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">Build</span>()
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">system</span>, <span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">state</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">validate</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>, <span style="color:#a6e22e">result</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentResult</span>, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">NoError</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Equal</span>(<span style="color:#a6e22e">t</span>, <span style="color:#e6db74">&#34;completed&#34;</span>, <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#e6db74">&#34;status&#34;</span>])
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;timeout_handling&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">setup</span>: <span style="color:#66d9ef">func</span>() (<span style="color:#f92672">*</span><span style="color:#a6e22e">TestSystem</span>, <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">Event</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">system</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewTestSystemBuilder</span>().
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">WithAgent</span>(<span style="color:#e6db74">&#34;slow_agent&#34;</span>, <span style="color:#a6e22e">NewSlowMockAgent</span>(<span style="color:#ae81ff">10</span><span style="color:#f92672">*</span><span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)).
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">Build</span>()
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">event</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewEventBuilder</span>(<span style="color:#e6db74">&#34;process&#34;</span>).
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">WithData</span>(<span style="color:#e6db74">&#34;timeout&#34;</span>, <span style="color:#e6db74">&#34;5s&#34;</span>).
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">Build</span>()
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">state</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewStateBuilder</span>().
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">WithSession</span>(<span style="color:#e6db74">&#34;timeout-test&#34;</span>).
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">Build</span>()
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">system</span>, <span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">state</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">validate</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>, <span style="color:#a6e22e">result</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentResult</span>, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>(), <span style="color:#e6db74">&#34;timeout&#34;</span>)
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">scenario</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">scenarios</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#a6e22e">scenario</span>.<span style="color:#a6e22e">name</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">system</span>, <span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">state</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">scenario</span>.<span style="color:#a6e22e">setup</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">system</span>.<span style="color:#a6e22e">Cleanup</span>()
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">system</span>.<span style="color:#a6e22e">ProcessSingleEvent</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">state</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">scenario</span>.<span style="color:#a6e22e">validate</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="-best-practices">🎯 Best Practices</h2>
<h3 id="1-test-organization"><strong>1. Test Organization</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Package structure for tests</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// agents/</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//   analyzer_test.go          - Unit tests for analyzer agent</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//   validator_test.go         - Unit tests for validator agent</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//   integration_test.go       - Integration tests between agents</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// orchestration/</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//   sequential_test.go        - Sequential orchestration tests</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//   collaborative_test.go     - Collaborative orchestration tests</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// system/</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//   e2e_test.go              - End-to-end system tests</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//   performance_test.go       - Performance and load tests</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// testutils/</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//   builders.go              - Test data builders</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//   mocks.go                 - Mock implementations</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//   fixtures.go              - Test fixtures and helpers</span></span></span></code></pre></div>
<h3 id="2-test-configuration"><strong>2. Test Configuration</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Test configuration management</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">TestConfig</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">DatabaseURL</span>    <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">RedisURL</span>       <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">MockServices</span>   <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">LogLevel</span>       <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">TestTimeout</span>    <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">LoadTestConfig</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">TestConfig</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">TestConfig</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">DatabaseURL</span>:  <span style="color:#a6e22e">getEnvOrDefault</span>(<span style="color:#e6db74">&#34;TEST_DATABASE_URL&#34;</span>, <span style="color:#e6db74">&#34;postgres://localhost/agentflow_test&#34;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">RedisURL</span>:     <span style="color:#a6e22e">getEnvOrDefault</span>(<span style="color:#e6db74">&#34;TEST_REDIS_URL&#34;</span>, <span style="color:#e6db74">&#34;redis://localhost:6379/1&#34;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">MockServices</span>: <span style="color:#a6e22e">getEnvOrDefault</span>(<span style="color:#e6db74">&#34;MOCK_SERVICES&#34;</span>, <span style="color:#e6db74">&#34;true&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">LogLevel</span>:     <span style="color:#a6e22e">getEnvOrDefault</span>(<span style="color:#e6db74">&#34;TEST_LOG_LEVEL&#34;</span>, <span style="color:#e6db74">&#34;error&#34;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">TestTimeout</span>:  <span style="color:#ae81ff">30</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="3-continuous-integration"><strong>3. Continuous Integration</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># .github/workflows/test.yml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Test Suite</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">on</span>: [<span style="color:#ae81ff">push, pull_request]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">unit-tests</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v3</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/setup-go@v3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">go-version</span>: <span style="color:#e6db74">&#39;1.21&#39;</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Run unit tests</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: <span style="color:#ae81ff">go test -v -race -coverprofile=coverage.out ./...</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Upload coverage</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">codecov/codecov-action@v3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">integration-tests</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">postgres</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">pgvector/pgvector:pg15</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">POSTGRES_PASSWORD</span>: <span style="color:#ae81ff">test</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">POSTGRES_DB</span>: <span style="color:#ae81ff">agentflow_test</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">options</span>: &gt;-<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          --health-cmd pg_isready
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          --health-interval 10s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          --health-timeout 5s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          --health-retries 5</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">redis</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">redis:7-alpine</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">options</span>: &gt;-<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          --health-cmd &#34;redis-cli ping&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          --health-interval 10s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          --health-timeout 5s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          --health-retries 5</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v3</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/setup-go@v3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">go-version</span>: <span style="color:#e6db74">&#39;1.21&#39;</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Run integration tests</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: <span style="color:#ae81ff">go test -v -tags=integration ./...</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">TEST_DATABASE_URL</span>: <span style="color:#ae81ff">postgres://postgres:test@localhost:5432/agentflow_test</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">TEST_REDIS_URL</span>: <span style="color:#ae81ff">redis://localhost:6379/1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">e2e-tests</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v3</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/setup-go@v3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">go-version</span>: <span style="color:#e6db74">&#39;1.21&#39;</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Start test environment</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: <span style="color:#ae81ff">docker-compose -f docker-compose.test.yml up -d</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Wait for services</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: <span style="color:#ae81ff">./scripts/wait-for-services.sh</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Run E2E tests</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: <span style="color:#ae81ff">go test -v -tags=e2e ./...</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Cleanup</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: <span style="color:#ae81ff">docker-compose -f docker-compose.test.yml down</span></span></span></code></pre></div>
<p>Testing multi-agent systems requires a comprehensive approach that covers unit, integration, and end-to-end scenarios. By following these strategies and patterns, you can build reliable and maintainable agent systems with confidence.</p>
<h2 id="-next-steps">🚀 Next Steps</h2>
<ul>
<li><strong><a href="/AgenticGoKitDocs/tutorials/advanced/circuit-breaker-patterns/index.html">Circuit Breaker Patterns</a></strong> - Add fault tolerance to your tested systems</li>
<li><strong><a href="/AgenticGoKitDocs/tutorials/advanced/load-balancing-scaling/index.html">Load Balancing and Scaling</a></strong> - Test scaled deployments</li>
<li><strong><a href="../debugging/performance-monitoring.md">Production Monitoring</a></strong> - Monitor your tested systems in production</li>
<li><strong><a href="/AgenticGoKitDocs/tutorials/debugging/debugging-multi-agent-systems/index.html">Debugging Guide</a></strong> - Debug issues found during testing</li>
</ul>

  <footer class="footline">
              <i class='fa-fw fas fa-calendar'></i> Jul 25, 2025
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          <a id="R-logo" class="R-default" href="/AgenticGoKitDocs/index.html">
            <div class="logo-title">AgenticGoKit Docs</div>
          </a>
        </div>
        <search><form action="/AgenticGoKitDocs/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks">
          <ul class="space collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/index.html"><a class="padding" href="/AgenticGoKitDocs/index.html"><i class="fa-fw fas fa-home"></i> Home</a></li>
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/readme/index.html">content</a></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/guides/index.html"><input type="checkbox" id="R-section-8fc2fd7736125e87cab8840a86c2af5a" aria-controls="R-subsections-8fc2fd7736125e87cab8840a86c2af5a" checked><label for="R-section-8fc2fd7736125e87cab8840a86c2af5a"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu guides</span></label><a class="padding" href="/AgenticGoKitDocs/guides/index.html">guides</a><ul id="R-subsections-8fc2fd7736125e87cab8840a86c2af5a" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/readme/index.html">guides</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/agentbasics/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/agentbasics/index.html">AgentBasics</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/examples/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/examples/index.html">Examples</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/configuration/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/configuration/index.html">Configuration</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/customtools/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/customtools/index.html">CustomTools</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/providers/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/providers/index.html">Providers</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/memoryprovidersetup/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/memoryprovidersetup/index.html">MemoryProviderSetup</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/memorytroubleshooting/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/memorytroubleshooting/index.html">MemoryTroubleshooting</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/embeddingmodelguide/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/embeddingmodelguide/index.html">EmbeddingModelGuide</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/ragconfiguration/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/ragconfiguration/index.html">RAGConfiguration</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/toolintegration/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/toolintegration/index.html">ToolIntegration</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/pgvectorsetup/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/pgvectorsetup/index.html">PgVectorSetup</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/weaviatesetup/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/weaviatesetup/index.html">WeaviateSetup</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/performance/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/performance/index.html">Performance</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/errorhandling/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/errorhandling/index.html">ErrorHandling</a></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/guides/deployment/index.html"><input type="checkbox" id="R-section-ecc839349395ef3c015a12132049dff2" aria-controls="R-subsections-ecc839349395ef3c015a12132049dff2" checked><label for="R-section-ecc839349395ef3c015a12132049dff2"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu deployment</span></label><a class="padding" href="/AgenticGoKitDocs/guides/deployment/index.html">deployment</a><ul id="R-subsections-ecc839349395ef3c015a12132049dff2" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/deployment/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/deployment/readme/index.html">deployment</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/guides/development/index.html"><input type="checkbox" id="R-section-fff1f5eca5d0a93209b9c6262762c25a" aria-controls="R-subsections-fff1f5eca5d0a93209b9c6262762c25a" checked><label for="R-section-fff1f5eca5d0a93209b9c6262762c25a"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu development</span></label><a class="padding" href="/AgenticGoKitDocs/guides/development/index.html">development</a><ul id="R-subsections-fff1f5eca5d0a93209b9c6262762c25a" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/development/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/development/readme/index.html">development</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/development/best-practices/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/development/best-practices/index.html">best-practices</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/development/debugging/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/development/debugging/index.html">debugging</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/development/research-assistant/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/development/research-assistant/index.html">research-assistant</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/development/testing-agents/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/development/testing-agents/index.html">testing-agents</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/development/visualization/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/development/visualization/index.html">visualization</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/development/web-search-integration/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/development/web-search-integration/index.html">web-search-integration</a></li></ul></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/framework-comparison/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/framework-comparison/index.html">framework-comparison</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/memory/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/memory/index.html">Memory</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/scaffoldmemoryguide/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/scaffoldmemoryguide/index.html">ScaffoldMemoryGuide</a></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/guides/setup/index.html"><input type="checkbox" id="R-section-0124aed9abb5064d53391168f3c95c22" aria-controls="R-subsections-0124aed9abb5064d53391168f3c95c22" checked><label for="R-section-0124aed9abb5064d53391168f3c95c22"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu setup</span></label><a class="padding" href="/AgenticGoKitDocs/guides/setup/index.html">setup</a><ul id="R-subsections-0124aed9abb5064d53391168f3c95c22" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/setup/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/setup/readme/index.html">setup</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/setup/llm-providers/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/setup/llm-providers/index.html">llm-providers</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/setup/mcp-tools/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/setup/mcp-tools/index.html">mcp-tools</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/setup/orchestration-configuration/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/setup/orchestration-configuration/index.html">orchestration-configuration</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/setup/vector-databases/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/setup/vector-databases/index.html">vector-databases</a></li></ul></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/troubleshooting/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/troubleshooting/index.html">troubleshooting</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/contributors/index.html"><input type="checkbox" id="R-section-190d9b328fbda7e13ab386f7a5417de5" aria-controls="R-subsections-190d9b328fbda7e13ab386f7a5417de5" checked><label for="R-section-190d9b328fbda7e13ab386f7a5417de5"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu contributors</span></label><a class="padding" href="/AgenticGoKitDocs/contributors/index.html">contributors</a><ul id="R-subsections-190d9b328fbda7e13ab386f7a5417de5" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/contributors/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/contributors/readme/index.html">contributors</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/contributors/contributorguide/index.html"><a class="padding" href="/AgenticGoKitDocs/contributors/contributorguide/index.html">ContributorGuide</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/contributors/codestyle/index.html"><a class="padding" href="/AgenticGoKitDocs/contributors/codestyle/index.html">CodeStyle</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/contributors/corevsinternal/index.html"><a class="padding" href="/AgenticGoKitDocs/contributors/corevsinternal/index.html">CoreVsInternal</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/contributors/addingfeatures/index.html"><a class="padding" href="/AgenticGoKitDocs/contributors/addingfeatures/index.html">AddingFeatures</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/contributors/testing/index.html"><a class="padding" href="/AgenticGoKitDocs/contributors/testing/index.html">Testing</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/contributors/docsstandards/index.html"><a class="padding" href="/AgenticGoKitDocs/contributors/docsstandards/index.html">DocsStandards</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/reference/index.html"><input type="checkbox" id="R-section-66002f201bef818664bb81aa67490c58" aria-controls="R-subsections-66002f201bef818664bb81aa67490c58" checked><label for="R-section-66002f201bef818664bb81aa67490c58"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu reference</span></label><a class="padding" href="/AgenticGoKitDocs/reference/index.html">reference</a><ul id="R-subsections-66002f201bef818664bb81aa67490c58" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/reference/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/reference/readme/index.html">reference</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/reference/api/configuration/index.html"><a class="padding" href="/AgenticGoKitDocs/reference/api/configuration/index.html">configuration</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/reference/cli/index.html"><a class="padding" href="/AgenticGoKitDocs/reference/cli/index.html">cli</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/reference/api/mcp/index.html"><a class="padding" href="/AgenticGoKitDocs/reference/api/mcp/index.html">mcp</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/reference/api/agent/index.html"><a class="padding" href="/AgenticGoKitDocs/reference/api/agent/index.html">agent</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/reference/api/memory/index.html"><a class="padding" href="/AgenticGoKitDocs/reference/api/memory/index.html">memory</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/reference/api/orchestration/index.html"><a class="padding" href="/AgenticGoKitDocs/reference/api/orchestration/index.html">orchestration</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/reference/api/state-event/index.html"><a class="padding" href="/AgenticGoKitDocs/reference/api/state-event/index.html">state-event</a></li></ul></li>
            <li class="parent alwaysopen " data-nav-id="/AgenticGoKitDocs/tutorials/index.html"><input type="checkbox" id="R-section-e1e8c1e70c5500b49e8dda2dc550651a" aria-controls="R-subsections-e1e8c1e70c5500b49e8dda2dc550651a" checked><label for="R-section-e1e8c1e70c5500b49e8dda2dc550651a"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu tutorials</span></label><a class="padding" href="/AgenticGoKitDocs/tutorials/index.html">tutorials</a><ul id="R-subsections-e1e8c1e70c5500b49e8dda2dc550651a" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/readme/index.html">tutorials</a></li>
            <li class="parent alwaysopen " data-nav-id="/AgenticGoKitDocs/tutorials/advanced/index.html"><input type="checkbox" id="R-section-d3def5cd76adc8096d0ff9fda6b8e479" aria-controls="R-subsections-d3def5cd76adc8096d0ff9fda6b8e479" checked><label for="R-section-d3def5cd76adc8096d0ff9fda6b8e479"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu advanced</span></label><a class="padding" href="/AgenticGoKitDocs/tutorials/advanced/index.html">advanced</a><ul id="R-subsections-d3def5cd76adc8096d0ff9fda6b8e479" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/advanced/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/advanced/readme/index.html">advanced</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/advanced/circuit-breaker-patterns/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/advanced/circuit-breaker-patterns/index.html">circuit-breaker-patterns</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/advanced/load-balancing-scaling/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/advanced/load-balancing-scaling/index.html">load-balancing-scaling</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/advanced/retry-policies/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/advanced/retry-policies/index.html">retry-policies</a></li>
            <li class="active " data-nav-id="/AgenticGoKitDocs/tutorials/advanced/testing-strategies/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/advanced/testing-strategies/index.html">testing-strategies</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/tutorials/core-concepts/index.html"><input type="checkbox" id="R-section-212c6ccffb40ecdd78eb2136f98c4cac" aria-controls="R-subsections-212c6ccffb40ecdd78eb2136f98c4cac" checked><label for="R-section-212c6ccffb40ecdd78eb2136f98c4cac"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu core-concepts</span></label><a class="padding" href="/AgenticGoKitDocs/tutorials/core-concepts/index.html">core-concepts</a><ul id="R-subsections-212c6ccffb40ecdd78eb2136f98c4cac" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/core-concepts/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/core-concepts/readme/index.html">core-concepts</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/core-concepts/agent-lifecycle/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/core-concepts/agent-lifecycle/index.html">agent-lifecycle</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/core-concepts/error-handling/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/core-concepts/error-handling/index.html">error-handling</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/core-concepts/message-passing/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/core-concepts/message-passing/index.html">message-passing</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/core-concepts/orchestration-patterns/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/core-concepts/orchestration-patterns/index.html">orchestration-patterns</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/core-concepts/state-management/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/core-concepts/state-management/index.html">state-management</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/tutorials/debugging/index.html"><input type="checkbox" id="R-section-d8dfe6eec6c6d4cb6f6f50bdd07fa3cc" aria-controls="R-subsections-d8dfe6eec6c6d4cb6f6f50bdd07fa3cc" checked><label for="R-section-d8dfe6eec6c6d4cb6f6f50bdd07fa3cc"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu debugging</span></label><a class="padding" href="/AgenticGoKitDocs/tutorials/debugging/index.html">debugging</a><ul id="R-subsections-d8dfe6eec6c6d4cb6f6f50bdd07fa3cc" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/debugging/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/debugging/readme/index.html">debugging</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/debugging/debugging-multi-agent-systems/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/debugging/debugging-multi-agent-systems/index.html">debugging-multi-agent-systems</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/debugging/logging-and-tracing/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/debugging/logging-and-tracing/index.html">logging-and-tracing</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/tutorials/getting-started/index.html"><input type="checkbox" id="R-section-e7f904c8b9d0f9bf1f07ca7d482d2247" aria-controls="R-subsections-e7f904c8b9d0f9bf1f07ca7d482d2247" checked><label for="R-section-e7f904c8b9d0f9bf1f07ca7d482d2247"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu getting-started</span></label><a class="padding" href="/AgenticGoKitDocs/tutorials/getting-started/index.html">getting-started</a><ul id="R-subsections-e7f904c8b9d0f9bf1f07ca7d482d2247" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/getting-started/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/getting-started/readme/index.html">getting-started</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/getting-started/memory-and-rag/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/getting-started/memory-and-rag/index.html">memory-and-rag</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/getting-started/multi-agent-collaboration/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/getting-started/multi-agent-collaboration/index.html">multi-agent-collaboration</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/getting-started/production-deployment/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/getting-started/production-deployment/index.html">production-deployment</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/getting-started/quickstart/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/getting-started/quickstart/index.html">quickstart</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/getting-started/tool-integration/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/getting-started/tool-integration/index.html">tool-integration</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/getting-started/your-first-agent/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/getting-started/your-first-agent/index.html">your-first-agent</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/tutorials/mcp/index.html"><input type="checkbox" id="R-section-153aac44598009a99dd5a60317a3eecc" aria-controls="R-subsections-153aac44598009a99dd5a60317a3eecc" checked><label for="R-section-153aac44598009a99dd5a60317a3eecc"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu mcp</span></label><a class="padding" href="/AgenticGoKitDocs/tutorials/mcp/index.html">mcp</a><ul id="R-subsections-153aac44598009a99dd5a60317a3eecc" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/mcp/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/mcp/readme/index.html">mcp</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/mcp/advanced-tool-patterns/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/mcp/advanced-tool-patterns/index.html">advanced-tool-patterns</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/mcp/tool-development/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/mcp/tool-development/index.html">tool-development</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/mcp/tool-integration/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/mcp/tool-integration/index.html">tool-integration</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/tutorials/memory-systems/index.html"><input type="checkbox" id="R-section-9c1a65f2d7b3888241dcafa51a0710e7" aria-controls="R-subsections-9c1a65f2d7b3888241dcafa51a0710e7" checked><label for="R-section-9c1a65f2d7b3888241dcafa51a0710e7"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu memory-systems</span></label><a class="padding" href="/AgenticGoKitDocs/tutorials/memory-systems/index.html">memory-systems</a><ul id="R-subsections-9c1a65f2d7b3888241dcafa51a0710e7" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/memory-systems/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/memory-systems/readme/index.html">memory-systems</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/memory-systems/basic-memory/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/memory-systems/basic-memory/index.html">basic-memory</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/memory-systems/document-ingestion/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/memory-systems/document-ingestion/index.html">document-ingestion</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/memory-systems/knowledge-bases/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/memory-systems/knowledge-bases/index.html">knowledge-bases</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/memory-systems/memory-optimization/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/memory-systems/memory-optimization/index.html">memory-optimization</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/memory-systems/rag-implementation/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/memory-systems/rag-implementation/index.html">rag-implementation</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/memory-systems/vector-databases/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/memory-systems/vector-databases/index.html">vector-databases</a></li></ul></li></ul></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div id="R-footer-margin"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols">
          <ul class="">
          </ul>
        </div>
<div id="R-footer"><p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p></div>
      </div>
    </aside>
    <script src="/AgenticGoKitDocs/js/js-yaml/js-yaml.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-color.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-dispatch.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-drag.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-ease.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-interpolate.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-selection.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-timer.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-transition.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-zoom.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/mermaid/mermaid.min.js?1753430931" defer></script>
    <script>
      window.relearn.themeUseMermaid = JSON.parse("{}");
    </script>
    <script src="/AgenticGoKitDocs/js/clipboard/clipboard.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/perfect-scrollbar/perfect-scrollbar.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/theme.js?1753430931" defer></script>
  </body>
</html>
