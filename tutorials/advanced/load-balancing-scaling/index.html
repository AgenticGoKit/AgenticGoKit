<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head><script src="/AgenticGoKitDocs/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=AgenticGoKitDocs/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.148.1">
    <meta name="generator" content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862">
    <meta name="description" content="Load Balancing and Scaling Patterns Building horizontally scalable agent systems with intelligent load distribution
As your agent systems grow, you need strategies to distribute load effectively and scale horizontally. This guide covers load balancing patterns, horizontal scaling strategies, and performance optimization techniques for AgenticGoKit applications.
🏗️ Scaling Architecture Overview flowchart TBsubgraph &#34;Load Balancer Layer&#34;LB[Load Balancer]HEALTH[Health Checker]endsubgraph &#34;Agent Instances&#34;AGENT1[Agent Instance 1]AGENT2[Agent Instance 2]AGENT3[Agent Instance 3]AGENTN[Agent Instance N]endsubgraph &#34;Shared Resources&#34;REDIS[Redis Cache]POSTGRES[PostgreSQL]VECTOR[Vector DB]MCP[MCP Servers]endsubgraph &#34;Monitoring&#34;METRICS[Metrics Collector]ALERTS[Alert Manager]endCLIENT[Client Requests] --&gt; LBLB --&gt; AGENT1LB --&gt; AGENT2LB --&gt; AGENT3LB --&gt; AGENTNHEALTH --&gt; AGENT1HEALTH --&gt; AGENT2HEALTH --&gt; AGENT3HEALTH --&gt; AGENTNAGENT1 --&gt; REDISAGENT2 --&gt; REDISAGENT3 --&gt; REDISAGENTN --&gt; REDISAGENT1 --&gt; POSTGRESAGENT2 --&gt; POSTGRESAGENT3 --&gt; POSTGRESAGENTN --&gt; POSTGRESAGENT1 --&gt; VECTORAGENT2 --&gt; VECTORAGENT3 --&gt; VECTORAGENTN --&gt; VECTORAGENT1 --&gt; MCPAGENT2 --&gt; MCPAGENT3 --&gt; MCPAGENTN --&gt; MCPAGENT1 --&gt; METRICSAGENT2 --&gt; METRICSAGENT3 --&gt; METRICSAGENTN --&gt; METRICSMETRICS --&gt; ALERTSclassDef lb fill:#e3f2fd,stroke:#1976d2,stroke-width:2pxclassDef agent fill:#e8f5e8,stroke:#388e3c,stroke-width:2pxclassDef shared fill:#fff3e0,stroke:#f57c00,stroke-width:2pxclassDef monitor fill:#fce4ec,stroke:#c2185b,stroke-width:2pxclass LB,HEALTH lbclass AGENT1,AGENT2,AGENT3,AGENTN agentclass REDIS,POSTGRES,VECTOR,MCP sharedclass METRICS,ALERTS monitor⚖️ Load Balancing Strategies 1. Round Robin Load Balancing package balancer import ( &#34;context&#34; &#34;sync&#34; &#34;sync/atomic&#34; &#34;github.com/kunalkushwaha/agenticgokit/core&#34; ) type RoundRobinBalancer struct { agents []core.AgentHandler counter int64 mu sync.RWMutex } func NewRoundRobinBalancer(agents []core.AgentHandler) *RoundRobinBalancer { return &amp;RoundRobinBalancer{ agents: agents, } } func (rb *RoundRobinBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { if len(rb.agents) == 0 { return nil, errors.New(&#34;no agents available&#34;) } // Get next agent in round-robin fashion index := atomic.AddInt64(&amp;rb.counter, 1) % int64(len(rb.agents)) agent := rb.agents[index] return agent.Execute(ctx, event, state) } func (rb *RoundRobinBalancer) AddAgent(agent core.AgentHandler) { rb.mu.Lock() defer rb.mu.Unlock() rb.agents = append(rb.agents, agent) } func (rb *RoundRobinBalancer) RemoveAgent(index int) { rb.mu.Lock() defer rb.mu.Unlock() if index &gt;= 0 &amp;&amp; index &lt; len(rb.agents) { rb.agents = append(rb.agents[:index], rb.agents[index&#43;1:]...) } }2. Weighted Load Balancing type WeightedBalancer struct { agents []WeightedAgent totalWeight int mu sync.RWMutex } type WeightedAgent struct { Agent core.AgentHandler Weight int CurrentWeight int } func NewWeightedBalancer() *WeightedBalancer { return &amp;WeightedBalancer{ agents: make([]WeightedAgent, 0), } } func (wb *WeightedBalancer) AddAgent(agent core.AgentHandler, weight int) { wb.mu.Lock() defer wb.mu.Unlock() wb.agents = append(wb.agents, WeightedAgent{ Agent: agent, Weight: weight, CurrentWeight: 0, }) wb.totalWeight &#43;= weight } func (wb *WeightedBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { wb.mu.Lock() defer wb.mu.Unlock() if len(wb.agents) == 0 { return nil, errors.New(&#34;no agents available&#34;) } // Weighted round-robin algorithm selected := wb.selectAgent() if selected == nil { return nil, errors.New(&#34;no agent selected&#34;) } return selected.Execute(ctx, event, state) } func (wb *WeightedBalancer) selectAgent() core.AgentHandler { var selected *WeightedAgent for i := range wb.agents { agent := &amp;wb.agents[i] agent.CurrentWeight &#43;= agent.Weight if selected == nil || agent.CurrentWeight &gt; selected.CurrentWeight { selected = agent } } if selected != nil { selected.CurrentWeight -= wb.totalWeight return selected.Agent } return nil }3. Least Connections Load Balancing type LeastConnectionsBalancer struct { agents []ConnectionTrackingAgent mu sync.RWMutex } type ConnectionTrackingAgent struct { Agent core.AgentHandler Connections int64 mu sync.RWMutex } func NewLeastConnectionsBalancer(agents []core.AgentHandler) *LeastConnectionsBalancer { trackingAgents := make([]ConnectionTrackingAgent, len(agents)) for i, agent := range agents { trackingAgents[i] = ConnectionTrackingAgent{ Agent: agent, } } return &amp;LeastConnectionsBalancer{ agents: trackingAgents, } } func (lcb *LeastConnectionsBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { agent := lcb.selectLeastConnectedAgent() if agent == nil { return nil, errors.New(&#34;no agents available&#34;) } // Increment connection count atomic.AddInt64(&amp;agent.Connections, 1) defer atomic.AddInt64(&amp;agent.Connections, -1) return agent.Agent.Execute(ctx, event, state) } func (lcb *LeastConnectionsBalancer) selectLeastConnectedAgent() *ConnectionTrackingAgent { lcb.mu.RLock() defer lcb.mu.RUnlock() if len(lcb.agents) == 0 { return nil } var selected *ConnectionTrackingAgent minConnections := int64(^uint64(0) &gt;&gt; 1) // Max int64 for i := range lcb.agents { agent := &amp;lcb.agents[i] connections := atomic.LoadInt64(&amp;agent.Connections) if connections &lt; minConnections { minConnections = connections selected = agent } } return selected }4. Performance-Based Load Balancing type PerformanceBasedBalancer struct { agents []PerformanceTrackingAgent mu sync.RWMutex } type PerformanceTrackingAgent struct { Agent core.AgentHandler ResponseTimes []time.Duration SuccessRate float64 LastUpdate time.Time mu sync.RWMutex } func NewPerformanceBasedBalancer(agents []core.AgentHandler) *PerformanceBasedBalancer { trackingAgents := make([]PerformanceTrackingAgent, len(agents)) for i, agent := range agents { trackingAgents[i] = PerformanceTrackingAgent{ Agent: agent, ResponseTimes: make([]time.Duration, 0, 100), SuccessRate: 1.0, LastUpdate: time.Now(), } } return &amp;PerformanceBasedBalancer{ agents: trackingAgents, } } func (pbb *PerformanceBasedBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { agent := pbb.selectBestPerformingAgent() if agent == nil { return nil, errors.New(&#34;no agents available&#34;) } start := time.Now() result, err := agent.Agent.Execute(ctx, event, state) duration := time.Since(start) // Record performance metrics pbb.recordPerformance(agent, duration, err == nil) return result, err } func (pbb *PerformanceBasedBalancer) selectBestPerformingAgent() *PerformanceTrackingAgent { pbb.mu.RLock() defer pbb.mu.RUnlock() if len(pbb.agents) == 0 { return nil } var selected *PerformanceTrackingAgent bestScore := -1.0 for i := range pbb.agents { agent := &amp;pbb.agents[i] score := pbb.calculatePerformanceScore(agent) if score &gt; bestScore { bestScore = score selected = agent } } return selected } func (pbb *PerformanceBasedBalancer) calculatePerformanceScore(agent *PerformanceTrackingAgent) float64 { agent.mu.RLock() defer agent.mu.RUnlock() // Calculate average response time avgResponseTime := time.Duration(0) if len(agent.ResponseTimes) &gt; 0 { total := time.Duration(0) for _, rt := range agent.ResponseTimes { total &#43;= rt } avgResponseTime = total / time.Duration(len(agent.ResponseTimes)) } // Normalize response time (lower is better) responseTimeScore := 1.0 / (1.0 &#43; avgResponseTime.Seconds()) // Combine success rate and response time return (agent.SuccessRate * 0.7) &#43; (responseTimeScore * 0.3) } func (pbb *PerformanceBasedBalancer) recordPerformance(agent *PerformanceTrackingAgent, duration time.Duration, success bool) { agent.mu.Lock() defer agent.mu.Unlock() // Record response time agent.ResponseTimes = append(agent.ResponseTimes, duration) if len(agent.ResponseTimes) &gt; 100 { agent.ResponseTimes = agent.ResponseTimes[1:] } // Update success rate (exponential moving average) alpha := 0.1 if success { agent.SuccessRate = agent.SuccessRate*(1-alpha) &#43; alpha } else { agent.SuccessRate = agent.SuccessRate * (1 - alpha) } agent.LastUpdate = time.Now() }🔄 Horizontal Scaling Patterns 1. Stateless Agent Design // Stateless agent that can be scaled horizontally type StatelessAgent struct { name string llmProvider core.ModelProvider cache CacheProvider // Shared cache memory MemoryProvider // Shared memory } func NewStatelessAgent(name string, provider core.ModelProvider, cache CacheProvider, memory MemoryProvider) *StatelessAgent { return &amp;StatelessAgent{ name: name, llmProvider: provider, cache: cache, memory: memory, } } func (sa *StatelessAgent) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { // All state is passed in or retrieved from shared resources // No local state that would prevent horizontal scaling // Get context from shared memory context := sa.memory.GetContext(state.SessionID) // Check shared cache cacheKey := sa.generateCacheKey(event) if cached := sa.cache.Get(cacheKey); cached != nil { return cached.(*core.AgentResult), nil } // Process request result, err := sa.processRequest(ctx, event, context) if err != nil { return nil, err } // Store in shared cache sa.cache.Set(cacheKey, result, 5*time.Minute) return result, nil } func (sa *StatelessAgent) generateCacheKey(event core.Event) string { return fmt.Sprintf(&#34;%s:%s:%x&#34;, sa.name, event.Type, sha256.Sum256([]byte(fmt.Sprintf(&#34;%v&#34;, event.Data)))) }2. Auto-Scaling Controller type AutoScaler struct { minInstances int maxInstances int currentInstances int targetCPU float64 targetMemory float64 scaleUpCooldown time.Duration scaleDownCooldown time.Duration lastScaleAction time.Time metrics MetricsProvider orchestrator Orchestrator mu sync.RWMutex } func NewAutoScaler(min, max int, orchestrator Orchestrator) *AutoScaler { return &amp;AutoScaler{ minInstances: min, maxInstances: max, currentInstances: min, targetCPU: 70.0, // 70% CPU utilization targetMemory: 80.0, // 80% memory utilization scaleUpCooldown: 2 * time.Minute, scaleDownCooldown: 5 * time.Minute, orchestrator: orchestrator, } } func (as *AutoScaler) Start(ctx context.Context) { ticker := time.NewTicker(30 * time.Second) defer ticker.Stop() for { select { case &lt;-ticker.C: as.evaluateScaling() case &lt;-ctx.Done(): return } } } func (as *AutoScaler) evaluateScaling() { as.mu.Lock() defer as.mu.Unlock() // Get current metrics cpuUsage := as.metrics.GetCPUUsage() memoryUsage := as.metrics.GetMemoryUsage() requestRate := as.metrics.GetRequestRate() // Determine if scaling is needed shouldScaleUp := (cpuUsage &gt; as.targetCPU || memoryUsage &gt; as.targetMemory) &amp;&amp; as.currentInstances &lt; as.maxInstances &amp;&amp; time.Since(as.lastScaleAction) &gt; as.scaleUpCooldown shouldScaleDown := cpuUsage &lt; as.targetCPU*0.5 &amp;&amp; memoryUsage &lt; as.targetMemory*0.5 &amp;&amp; as.currentInstances &gt; as.minInstances &amp;&amp; time.Since(as.lastScaleAction) &gt; as.scaleDownCooldown if shouldScaleUp { as.scaleUp() } else if shouldScaleDown { as.scaleDown() } } func (as *AutoScaler) scaleUp() { newInstances := min(as.currentInstances&#43;1, as.maxInstances) if newInstances &gt; as.currentInstances { err := as.orchestrator.AddInstance() if err == nil { as.currentInstances = newInstances as.lastScaleAction = time.Now() log.Printf(&#34;Scaled up to %d instances&#34;, as.currentInstances) } } } func (as *AutoScaler) scaleDown() { newInstances := max(as.currentInstances-1, as.minInstances) if newInstances &lt; as.currentInstances { err := as.orchestrator.RemoveInstance() if err == nil { as.currentInstances = newInstances as.lastScaleAction = time.Now() log.Printf(&#34;Scaled down to %d instances&#34;, as.currentInstances) } } }3. Health-Aware Load Balancing type HealthAwareBalancer struct { agents []HealthTrackingAgent healthCheck time.Duration mu sync.RWMutex } type HealthTrackingAgent struct { Agent core.AgentHandler Healthy bool LastCheck time.Time Endpoint string } func NewHealthAwareBalancer(agents []core.AgentHandler) *HealthAwareBalancer { trackingAgents := make([]HealthTrackingAgent, len(agents)) for i, agent := range agents { trackingAgents[i] = HealthTrackingAgent{ Agent: agent, Healthy: true, } } hab := &amp;HealthAwareBalancer{ agents: trackingAgents, healthCheck: 30 * time.Second, } // Start health checking go hab.startHealthChecking() return hab } func (hab *HealthAwareBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { healthyAgents := hab.getHealthyAgents() if len(healthyAgents) == 0 { return nil, errors.New(&#34;no healthy agents available&#34;) } // Use round-robin among healthy agents index := rand.Intn(len(healthyAgents)) return healthyAgents[index].Execute(ctx, event, state) } func (hab *HealthAwareBalancer) getHealthyAgents() []core.AgentHandler { hab.mu.RLock() defer hab.mu.RUnlock() var healthy []core.AgentHandler for _, agent := range hab.agents { if agent.Healthy { healthy = append(healthy, agent.Agent) } } return healthy } func (hab *HealthAwareBalancer) startHealthChecking() { ticker := time.NewTicker(hab.healthCheck) defer ticker.Stop() for range ticker.C { hab.checkHealth() } } func (hab *HealthAwareBalancer) checkHealth() { hab.mu.Lock() defer hab.mu.Unlock() for i := range hab.agents { agent := &amp;hab.agents[i] // Perform health check healthy := hab.performHealthCheck(agent) if agent.Healthy != healthy { agent.Healthy = healthy if healthy { log.Printf(&#34;Agent %d is now healthy&#34;, i) } else { log.Printf(&#34;Agent %d is now unhealthy&#34;, i) } } agent.LastCheck = time.Now() } } func (hab *HealthAwareBalancer) performHealthCheck(agent *HealthTrackingAgent) bool { // Simple health check - try to execute a test request ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second) defer cancel() testEvent := core.NewEvent(&#34;health_check&#34;, &#34;ping&#34;) testState := &amp;core.State{} _, err := agent.Agent.Execute(ctx, testEvent, testState) return err == nil }🐳 Container Orchestration Docker Compose for Development # docker-compose.yml version: &#39;3.8&#39; services: agent-1: build: . environment: - INSTANCE_ID=1 - REDIS_URL=redis://redis:6379 - POSTGRES_URL=postgres://user:pass@postgres:5432/agentflow depends_on: - redis - postgres deploy: resources: limits: cpus: &#39;0.5&#39; memory: 512M reservations: cpus: &#39;0.25&#39; memory: 256M agent-2: build: . environment: - INSTANCE_ID=2 - REDIS_URL=redis://redis:6379 - POSTGRES_URL=postgres://user:pass@postgres:5432/agentflow depends_on: - redis - postgres deploy: resources: limits: cpus: &#39;0.5&#39; memory: 512M agent-3: build: . environment: - INSTANCE_ID=3 - REDIS_URL=redis://redis:6379 - POSTGRES_URL=postgres://user:pass@postgres:5432/agentflow depends_on: - redis - postgres nginx: image: nginx:alpine ports: - &#34;80:80&#34; volumes: - ./nginx.conf:/etc/nginx/nginx.conf depends_on: - agent-1 - agent-2 - agent-3 redis: image: redis:7-alpine volumes: - redis_data:/data postgres: image: pgvector/pgvector:pg15 environment: POSTGRES_DB: agentflow POSTGRES_USER: user POSTGRES_PASSWORD: pass volumes: - postgres_data:/var/lib/postgresql/data volumes: redis_data: postgres_data:Kubernetes Deployment # k8s/deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: agenticgokit-agents spec: replicas: 3 selector: matchLabels: app: agenticgokit-agents template: metadata: labels: app: agenticgokit-agents spec: containers: - name: agent image: agenticgokit:latest ports: - containerPort: 8080 env: - name: REDIS_URL value: &#34;redis://redis-service:6379&#34; - name: POSTGRES_URL valueFrom: secretKeyRef: name: db-secret key: postgres-url resources: requests: memory: &#34;256Mi&#34; cpu: &#34;250m&#34; limits: memory: &#34;512Mi&#34; cpu: &#34;500m&#34; livenessProbe: httpGet: path: /health port: 8080 initialDelaySeconds: 30 periodSeconds: 10 readinessProbe: httpGet: path: /ready port: 8080 initialDelaySeconds: 5 periodSeconds: 5 --- apiVersion: v1 kind: Service metadata: name: agenticgokit-service spec: selector: app: agenticgokit-agents ports: - port: 80 targetPort: 8080 type: LoadBalancer --- apiVersion: autoscaling/v2 kind: HorizontalPodAutoscaler metadata: name: agenticgokit-hpa spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: agenticgokit-agents minReplicas: 2 maxReplicas: 10 metrics: - type: Resource resource: name: cpu target: type: Utilization averageUtilization: 70 - type: Resource resource: name: memory target: type: Utilization averageUtilization: 80📊 Performance Monitoring Load Balancer Metrics type LoadBalancerMetrics struct { totalRequests int64 requestsPerAgent map[string]int64 responseTimesByAgent map[string][]time.Duration errorsByAgent map[string]int64 mu sync.RWMutex } func NewLoadBalancerMetrics() *LoadBalancerMetrics { return &amp;LoadBalancerMetrics{ requestsPerAgent: make(map[string]int64), responseTimesByAgent: make(map[string][]time.Duration), errorsByAgent: make(map[string]int64), } } func (lbm *LoadBalancerMetrics) RecordRequest(agentID string, duration time.Duration, success bool) { lbm.mu.Lock() defer lbm.mu.Unlock() lbm.totalRequests&#43;&#43; lbm.requestsPerAgent[agentID]&#43;&#43; // Record response time if lbm.responseTimesByAgent[agentID] == nil { lbm.responseTimesByAgent[agentID] = make([]time.Duration, 0, 100) } lbm.responseTimesByAgent[agentID] = append(lbm.responseTimesByAgent[agentID], duration) // Keep only recent response times if len(lbm.responseTimesByAgent[agentID]) &gt; 100 { lbm.responseTimesByAgent[agentID] = lbm.responseTimesByAgent[agentID][1:] } // Record errors if !success { lbm.errorsByAgent[agentID]&#43;&#43; } } func (lbm *LoadBalancerMetrics) GetStats() map[string]interface{} { lbm.mu.RLock() defer lbm.mu.RUnlock() stats := map[string]interface{}{ &#34;total_requests&#34;: lbm.totalRequests, &#34;agents&#34;: make(map[string]interface{}), } for agentID, requests := range lbm.requestsPerAgent { agentStats := map[string]interface{}{ &#34;requests&#34;: requests, &#34;errors&#34;: lbm.errorsByAgent[agentID], } // Calculate average response time if responseTimes := lbm.responseTimesByAgent[agentID]; len(responseTimes) &gt; 0 { total := time.Duration(0) for _, rt := range responseTimes { total &#43;= rt } agentStats[&#34;avg_response_time&#34;] = total / time.Duration(len(responseTimes)) } stats[&#34;agents&#34;].(map[string]interface{})[agentID] = agentStats } return stats }🎯 Best Practices 1. Configuration for Scaling # agentflow.toml - Production scaling configuration [runtime] max_concurrent_agents = 50 timeout_seconds = 30 enable_metrics = true metrics_port = 8080 [load_balancer] strategy = &#34;performance_based&#34; # round_robin, weighted, least_connections, performance_based health_check_interval = &#34;30s&#34; unhealthy_threshold = 3 healthy_threshold = 2 [scaling] min_instances = 2 max_instances = 20 target_cpu_utilization = 70 target_memory_utilization = 80 scale_up_cooldown = &#34;2m&#34; scale_down_cooldown = &#34;5m&#34; [shared_resources] redis_url = &#34;${REDIS_URL}&#34; postgres_url = &#34;${POSTGRES_URL}&#34; vector_db_url = &#34;${VECTOR_DB_URL}&#34;2. Health Check Implementation func (a *ScalableAgent) HealthCheck() map[string]interface{} { health := map[string]interface{}{ &#34;status&#34;: &#34;healthy&#34;, &#34;timestamp&#34;: time.Now().Format(time.RFC3339), } // Check LLM provider if err := a.checkLLMProvider(); err != nil { health[&#34;status&#34;] = &#34;unhealthy&#34; health[&#34;llm_provider_error&#34;] = err.Error() } // Check shared cache if err := a.checkCache(); err != nil { health[&#34;status&#34;] = &#34;degraded&#34; health[&#34;cache_error&#34;] = err.Error() } // Check memory system if err := a.checkMemory(); err != nil { health[&#34;status&#34;] = &#34;degraded&#34; health[&#34;memory_error&#34;] = err.Error() } // Add performance metrics health[&#34;metrics&#34;] = map[string]interface{}{ &#34;requests_per_minute&#34;: a.getRequestsPerMinute(), &#34;avg_response_time&#34;: a.getAverageResponseTime(), &#34;error_rate&#34;: a.getErrorRate(), } return health }3. Graceful Shutdown func (a *ScalableAgent) GracefulShutdown(ctx context.Context) error { log.Println(&#34;Starting graceful shutdown...&#34;) // Stop accepting new requests a.stopAcceptingRequests() // Wait for ongoing requests to complete done := make(chan struct{}) go func() { a.waitForOngoingRequests() close(done) }() select { case &lt;-done: log.Println(&#34;All requests completed&#34;) case &lt;-ctx.Done(): log.Println(&#34;Shutdown timeout reached, forcing shutdown&#34;) } // Clean up resources a.cleanup() log.Println(&#34;Graceful shutdown completed&#34;) return nil }Load balancing and scaling are essential for building production-ready agent systems that can handle varying loads efficiently and maintain high availability.">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="load-balancing-scaling :: AgenticGoKit Docs">
    <meta name="twitter:description" content="Load Balancing and Scaling Patterns Building horizontally scalable agent systems with intelligent load distribution
As your agent systems grow, you need strategies to distribute load effectively and scale horizontally. This guide covers load balancing patterns, horizontal scaling strategies, and performance optimization techniques for AgenticGoKit applications.
🏗️ Scaling Architecture Overview flowchart TBsubgraph &#34;Load Balancer Layer&#34;LB[Load Balancer]HEALTH[Health Checker]endsubgraph &#34;Agent Instances&#34;AGENT1[Agent Instance 1]AGENT2[Agent Instance 2]AGENT3[Agent Instance 3]AGENTN[Agent Instance N]endsubgraph &#34;Shared Resources&#34;REDIS[Redis Cache]POSTGRES[PostgreSQL]VECTOR[Vector DB]MCP[MCP Servers]endsubgraph &#34;Monitoring&#34;METRICS[Metrics Collector]ALERTS[Alert Manager]endCLIENT[Client Requests] --&gt; LBLB --&gt; AGENT1LB --&gt; AGENT2LB --&gt; AGENT3LB --&gt; AGENTNHEALTH --&gt; AGENT1HEALTH --&gt; AGENT2HEALTH --&gt; AGENT3HEALTH --&gt; AGENTNAGENT1 --&gt; REDISAGENT2 --&gt; REDISAGENT3 --&gt; REDISAGENTN --&gt; REDISAGENT1 --&gt; POSTGRESAGENT2 --&gt; POSTGRESAGENT3 --&gt; POSTGRESAGENTN --&gt; POSTGRESAGENT1 --&gt; VECTORAGENT2 --&gt; VECTORAGENT3 --&gt; VECTORAGENTN --&gt; VECTORAGENT1 --&gt; MCPAGENT2 --&gt; MCPAGENT3 --&gt; MCPAGENTN --&gt; MCPAGENT1 --&gt; METRICSAGENT2 --&gt; METRICSAGENT3 --&gt; METRICSAGENTN --&gt; METRICSMETRICS --&gt; ALERTSclassDef lb fill:#e3f2fd,stroke:#1976d2,stroke-width:2pxclassDef agent fill:#e8f5e8,stroke:#388e3c,stroke-width:2pxclassDef shared fill:#fff3e0,stroke:#f57c00,stroke-width:2pxclassDef monitor fill:#fce4ec,stroke:#c2185b,stroke-width:2pxclass LB,HEALTH lbclass AGENT1,AGENT2,AGENT3,AGENTN agentclass REDIS,POSTGRES,VECTOR,MCP sharedclass METRICS,ALERTS monitor⚖️ Load Balancing Strategies 1. Round Robin Load Balancing package balancer import ( &#34;context&#34; &#34;sync&#34; &#34;sync/atomic&#34; &#34;github.com/kunalkushwaha/agenticgokit/core&#34; ) type RoundRobinBalancer struct { agents []core.AgentHandler counter int64 mu sync.RWMutex } func NewRoundRobinBalancer(agents []core.AgentHandler) *RoundRobinBalancer { return &amp;RoundRobinBalancer{ agents: agents, } } func (rb *RoundRobinBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { if len(rb.agents) == 0 { return nil, errors.New(&#34;no agents available&#34;) } // Get next agent in round-robin fashion index := atomic.AddInt64(&amp;rb.counter, 1) % int64(len(rb.agents)) agent := rb.agents[index] return agent.Execute(ctx, event, state) } func (rb *RoundRobinBalancer) AddAgent(agent core.AgentHandler) { rb.mu.Lock() defer rb.mu.Unlock() rb.agents = append(rb.agents, agent) } func (rb *RoundRobinBalancer) RemoveAgent(index int) { rb.mu.Lock() defer rb.mu.Unlock() if index &gt;= 0 &amp;&amp; index &lt; len(rb.agents) { rb.agents = append(rb.agents[:index], rb.agents[index&#43;1:]...) } }2. Weighted Load Balancing type WeightedBalancer struct { agents []WeightedAgent totalWeight int mu sync.RWMutex } type WeightedAgent struct { Agent core.AgentHandler Weight int CurrentWeight int } func NewWeightedBalancer() *WeightedBalancer { return &amp;WeightedBalancer{ agents: make([]WeightedAgent, 0), } } func (wb *WeightedBalancer) AddAgent(agent core.AgentHandler, weight int) { wb.mu.Lock() defer wb.mu.Unlock() wb.agents = append(wb.agents, WeightedAgent{ Agent: agent, Weight: weight, CurrentWeight: 0, }) wb.totalWeight &#43;= weight } func (wb *WeightedBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { wb.mu.Lock() defer wb.mu.Unlock() if len(wb.agents) == 0 { return nil, errors.New(&#34;no agents available&#34;) } // Weighted round-robin algorithm selected := wb.selectAgent() if selected == nil { return nil, errors.New(&#34;no agent selected&#34;) } return selected.Execute(ctx, event, state) } func (wb *WeightedBalancer) selectAgent() core.AgentHandler { var selected *WeightedAgent for i := range wb.agents { agent := &amp;wb.agents[i] agent.CurrentWeight &#43;= agent.Weight if selected == nil || agent.CurrentWeight &gt; selected.CurrentWeight { selected = agent } } if selected != nil { selected.CurrentWeight -= wb.totalWeight return selected.Agent } return nil }3. Least Connections Load Balancing type LeastConnectionsBalancer struct { agents []ConnectionTrackingAgent mu sync.RWMutex } type ConnectionTrackingAgent struct { Agent core.AgentHandler Connections int64 mu sync.RWMutex } func NewLeastConnectionsBalancer(agents []core.AgentHandler) *LeastConnectionsBalancer { trackingAgents := make([]ConnectionTrackingAgent, len(agents)) for i, agent := range agents { trackingAgents[i] = ConnectionTrackingAgent{ Agent: agent, } } return &amp;LeastConnectionsBalancer{ agents: trackingAgents, } } func (lcb *LeastConnectionsBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { agent := lcb.selectLeastConnectedAgent() if agent == nil { return nil, errors.New(&#34;no agents available&#34;) } // Increment connection count atomic.AddInt64(&amp;agent.Connections, 1) defer atomic.AddInt64(&amp;agent.Connections, -1) return agent.Agent.Execute(ctx, event, state) } func (lcb *LeastConnectionsBalancer) selectLeastConnectedAgent() *ConnectionTrackingAgent { lcb.mu.RLock() defer lcb.mu.RUnlock() if len(lcb.agents) == 0 { return nil } var selected *ConnectionTrackingAgent minConnections := int64(^uint64(0) &gt;&gt; 1) // Max int64 for i := range lcb.agents { agent := &amp;lcb.agents[i] connections := atomic.LoadInt64(&amp;agent.Connections) if connections &lt; minConnections { minConnections = connections selected = agent } } return selected }4. Performance-Based Load Balancing type PerformanceBasedBalancer struct { agents []PerformanceTrackingAgent mu sync.RWMutex } type PerformanceTrackingAgent struct { Agent core.AgentHandler ResponseTimes []time.Duration SuccessRate float64 LastUpdate time.Time mu sync.RWMutex } func NewPerformanceBasedBalancer(agents []core.AgentHandler) *PerformanceBasedBalancer { trackingAgents := make([]PerformanceTrackingAgent, len(agents)) for i, agent := range agents { trackingAgents[i] = PerformanceTrackingAgent{ Agent: agent, ResponseTimes: make([]time.Duration, 0, 100), SuccessRate: 1.0, LastUpdate: time.Now(), } } return &amp;PerformanceBasedBalancer{ agents: trackingAgents, } } func (pbb *PerformanceBasedBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { agent := pbb.selectBestPerformingAgent() if agent == nil { return nil, errors.New(&#34;no agents available&#34;) } start := time.Now() result, err := agent.Agent.Execute(ctx, event, state) duration := time.Since(start) // Record performance metrics pbb.recordPerformance(agent, duration, err == nil) return result, err } func (pbb *PerformanceBasedBalancer) selectBestPerformingAgent() *PerformanceTrackingAgent { pbb.mu.RLock() defer pbb.mu.RUnlock() if len(pbb.agents) == 0 { return nil } var selected *PerformanceTrackingAgent bestScore := -1.0 for i := range pbb.agents { agent := &amp;pbb.agents[i] score := pbb.calculatePerformanceScore(agent) if score &gt; bestScore { bestScore = score selected = agent } } return selected } func (pbb *PerformanceBasedBalancer) calculatePerformanceScore(agent *PerformanceTrackingAgent) float64 { agent.mu.RLock() defer agent.mu.RUnlock() // Calculate average response time avgResponseTime := time.Duration(0) if len(agent.ResponseTimes) &gt; 0 { total := time.Duration(0) for _, rt := range agent.ResponseTimes { total &#43;= rt } avgResponseTime = total / time.Duration(len(agent.ResponseTimes)) } // Normalize response time (lower is better) responseTimeScore := 1.0 / (1.0 &#43; avgResponseTime.Seconds()) // Combine success rate and response time return (agent.SuccessRate * 0.7) &#43; (responseTimeScore * 0.3) } func (pbb *PerformanceBasedBalancer) recordPerformance(agent *PerformanceTrackingAgent, duration time.Duration, success bool) { agent.mu.Lock() defer agent.mu.Unlock() // Record response time agent.ResponseTimes = append(agent.ResponseTimes, duration) if len(agent.ResponseTimes) &gt; 100 { agent.ResponseTimes = agent.ResponseTimes[1:] } // Update success rate (exponential moving average) alpha := 0.1 if success { agent.SuccessRate = agent.SuccessRate*(1-alpha) &#43; alpha } else { agent.SuccessRate = agent.SuccessRate * (1 - alpha) } agent.LastUpdate = time.Now() }🔄 Horizontal Scaling Patterns 1. Stateless Agent Design // Stateless agent that can be scaled horizontally type StatelessAgent struct { name string llmProvider core.ModelProvider cache CacheProvider // Shared cache memory MemoryProvider // Shared memory } func NewStatelessAgent(name string, provider core.ModelProvider, cache CacheProvider, memory MemoryProvider) *StatelessAgent { return &amp;StatelessAgent{ name: name, llmProvider: provider, cache: cache, memory: memory, } } func (sa *StatelessAgent) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { // All state is passed in or retrieved from shared resources // No local state that would prevent horizontal scaling // Get context from shared memory context := sa.memory.GetContext(state.SessionID) // Check shared cache cacheKey := sa.generateCacheKey(event) if cached := sa.cache.Get(cacheKey); cached != nil { return cached.(*core.AgentResult), nil } // Process request result, err := sa.processRequest(ctx, event, context) if err != nil { return nil, err } // Store in shared cache sa.cache.Set(cacheKey, result, 5*time.Minute) return result, nil } func (sa *StatelessAgent) generateCacheKey(event core.Event) string { return fmt.Sprintf(&#34;%s:%s:%x&#34;, sa.name, event.Type, sha256.Sum256([]byte(fmt.Sprintf(&#34;%v&#34;, event.Data)))) }2. Auto-Scaling Controller type AutoScaler struct { minInstances int maxInstances int currentInstances int targetCPU float64 targetMemory float64 scaleUpCooldown time.Duration scaleDownCooldown time.Duration lastScaleAction time.Time metrics MetricsProvider orchestrator Orchestrator mu sync.RWMutex } func NewAutoScaler(min, max int, orchestrator Orchestrator) *AutoScaler { return &amp;AutoScaler{ minInstances: min, maxInstances: max, currentInstances: min, targetCPU: 70.0, // 70% CPU utilization targetMemory: 80.0, // 80% memory utilization scaleUpCooldown: 2 * time.Minute, scaleDownCooldown: 5 * time.Minute, orchestrator: orchestrator, } } func (as *AutoScaler) Start(ctx context.Context) { ticker := time.NewTicker(30 * time.Second) defer ticker.Stop() for { select { case &lt;-ticker.C: as.evaluateScaling() case &lt;-ctx.Done(): return } } } func (as *AutoScaler) evaluateScaling() { as.mu.Lock() defer as.mu.Unlock() // Get current metrics cpuUsage := as.metrics.GetCPUUsage() memoryUsage := as.metrics.GetMemoryUsage() requestRate := as.metrics.GetRequestRate() // Determine if scaling is needed shouldScaleUp := (cpuUsage &gt; as.targetCPU || memoryUsage &gt; as.targetMemory) &amp;&amp; as.currentInstances &lt; as.maxInstances &amp;&amp; time.Since(as.lastScaleAction) &gt; as.scaleUpCooldown shouldScaleDown := cpuUsage &lt; as.targetCPU*0.5 &amp;&amp; memoryUsage &lt; as.targetMemory*0.5 &amp;&amp; as.currentInstances &gt; as.minInstances &amp;&amp; time.Since(as.lastScaleAction) &gt; as.scaleDownCooldown if shouldScaleUp { as.scaleUp() } else if shouldScaleDown { as.scaleDown() } } func (as *AutoScaler) scaleUp() { newInstances := min(as.currentInstances&#43;1, as.maxInstances) if newInstances &gt; as.currentInstances { err := as.orchestrator.AddInstance() if err == nil { as.currentInstances = newInstances as.lastScaleAction = time.Now() log.Printf(&#34;Scaled up to %d instances&#34;, as.currentInstances) } } } func (as *AutoScaler) scaleDown() { newInstances := max(as.currentInstances-1, as.minInstances) if newInstances &lt; as.currentInstances { err := as.orchestrator.RemoveInstance() if err == nil { as.currentInstances = newInstances as.lastScaleAction = time.Now() log.Printf(&#34;Scaled down to %d instances&#34;, as.currentInstances) } } }3. Health-Aware Load Balancing type HealthAwareBalancer struct { agents []HealthTrackingAgent healthCheck time.Duration mu sync.RWMutex } type HealthTrackingAgent struct { Agent core.AgentHandler Healthy bool LastCheck time.Time Endpoint string } func NewHealthAwareBalancer(agents []core.AgentHandler) *HealthAwareBalancer { trackingAgents := make([]HealthTrackingAgent, len(agents)) for i, agent := range agents { trackingAgents[i] = HealthTrackingAgent{ Agent: agent, Healthy: true, } } hab := &amp;HealthAwareBalancer{ agents: trackingAgents, healthCheck: 30 * time.Second, } // Start health checking go hab.startHealthChecking() return hab } func (hab *HealthAwareBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { healthyAgents := hab.getHealthyAgents() if len(healthyAgents) == 0 { return nil, errors.New(&#34;no healthy agents available&#34;) } // Use round-robin among healthy agents index := rand.Intn(len(healthyAgents)) return healthyAgents[index].Execute(ctx, event, state) } func (hab *HealthAwareBalancer) getHealthyAgents() []core.AgentHandler { hab.mu.RLock() defer hab.mu.RUnlock() var healthy []core.AgentHandler for _, agent := range hab.agents { if agent.Healthy { healthy = append(healthy, agent.Agent) } } return healthy } func (hab *HealthAwareBalancer) startHealthChecking() { ticker := time.NewTicker(hab.healthCheck) defer ticker.Stop() for range ticker.C { hab.checkHealth() } } func (hab *HealthAwareBalancer) checkHealth() { hab.mu.Lock() defer hab.mu.Unlock() for i := range hab.agents { agent := &amp;hab.agents[i] // Perform health check healthy := hab.performHealthCheck(agent) if agent.Healthy != healthy { agent.Healthy = healthy if healthy { log.Printf(&#34;Agent %d is now healthy&#34;, i) } else { log.Printf(&#34;Agent %d is now unhealthy&#34;, i) } } agent.LastCheck = time.Now() } } func (hab *HealthAwareBalancer) performHealthCheck(agent *HealthTrackingAgent) bool { // Simple health check - try to execute a test request ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second) defer cancel() testEvent := core.NewEvent(&#34;health_check&#34;, &#34;ping&#34;) testState := &amp;core.State{} _, err := agent.Agent.Execute(ctx, testEvent, testState) return err == nil }🐳 Container Orchestration Docker Compose for Development # docker-compose.yml version: &#39;3.8&#39; services: agent-1: build: . environment: - INSTANCE_ID=1 - REDIS_URL=redis://redis:6379 - POSTGRES_URL=postgres://user:pass@postgres:5432/agentflow depends_on: - redis - postgres deploy: resources: limits: cpus: &#39;0.5&#39; memory: 512M reservations: cpus: &#39;0.25&#39; memory: 256M agent-2: build: . environment: - INSTANCE_ID=2 - REDIS_URL=redis://redis:6379 - POSTGRES_URL=postgres://user:pass@postgres:5432/agentflow depends_on: - redis - postgres deploy: resources: limits: cpus: &#39;0.5&#39; memory: 512M agent-3: build: . environment: - INSTANCE_ID=3 - REDIS_URL=redis://redis:6379 - POSTGRES_URL=postgres://user:pass@postgres:5432/agentflow depends_on: - redis - postgres nginx: image: nginx:alpine ports: - &#34;80:80&#34; volumes: - ./nginx.conf:/etc/nginx/nginx.conf depends_on: - agent-1 - agent-2 - agent-3 redis: image: redis:7-alpine volumes: - redis_data:/data postgres: image: pgvector/pgvector:pg15 environment: POSTGRES_DB: agentflow POSTGRES_USER: user POSTGRES_PASSWORD: pass volumes: - postgres_data:/var/lib/postgresql/data volumes: redis_data: postgres_data:Kubernetes Deployment # k8s/deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: agenticgokit-agents spec: replicas: 3 selector: matchLabels: app: agenticgokit-agents template: metadata: labels: app: agenticgokit-agents spec: containers: - name: agent image: agenticgokit:latest ports: - containerPort: 8080 env: - name: REDIS_URL value: &#34;redis://redis-service:6379&#34; - name: POSTGRES_URL valueFrom: secretKeyRef: name: db-secret key: postgres-url resources: requests: memory: &#34;256Mi&#34; cpu: &#34;250m&#34; limits: memory: &#34;512Mi&#34; cpu: &#34;500m&#34; livenessProbe: httpGet: path: /health port: 8080 initialDelaySeconds: 30 periodSeconds: 10 readinessProbe: httpGet: path: /ready port: 8080 initialDelaySeconds: 5 periodSeconds: 5 --- apiVersion: v1 kind: Service metadata: name: agenticgokit-service spec: selector: app: agenticgokit-agents ports: - port: 80 targetPort: 8080 type: LoadBalancer --- apiVersion: autoscaling/v2 kind: HorizontalPodAutoscaler metadata: name: agenticgokit-hpa spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: agenticgokit-agents minReplicas: 2 maxReplicas: 10 metrics: - type: Resource resource: name: cpu target: type: Utilization averageUtilization: 70 - type: Resource resource: name: memory target: type: Utilization averageUtilization: 80📊 Performance Monitoring Load Balancer Metrics type LoadBalancerMetrics struct { totalRequests int64 requestsPerAgent map[string]int64 responseTimesByAgent map[string][]time.Duration errorsByAgent map[string]int64 mu sync.RWMutex } func NewLoadBalancerMetrics() *LoadBalancerMetrics { return &amp;LoadBalancerMetrics{ requestsPerAgent: make(map[string]int64), responseTimesByAgent: make(map[string][]time.Duration), errorsByAgent: make(map[string]int64), } } func (lbm *LoadBalancerMetrics) RecordRequest(agentID string, duration time.Duration, success bool) { lbm.mu.Lock() defer lbm.mu.Unlock() lbm.totalRequests&#43;&#43; lbm.requestsPerAgent[agentID]&#43;&#43; // Record response time if lbm.responseTimesByAgent[agentID] == nil { lbm.responseTimesByAgent[agentID] = make([]time.Duration, 0, 100) } lbm.responseTimesByAgent[agentID] = append(lbm.responseTimesByAgent[agentID], duration) // Keep only recent response times if len(lbm.responseTimesByAgent[agentID]) &gt; 100 { lbm.responseTimesByAgent[agentID] = lbm.responseTimesByAgent[agentID][1:] } // Record errors if !success { lbm.errorsByAgent[agentID]&#43;&#43; } } func (lbm *LoadBalancerMetrics) GetStats() map[string]interface{} { lbm.mu.RLock() defer lbm.mu.RUnlock() stats := map[string]interface{}{ &#34;total_requests&#34;: lbm.totalRequests, &#34;agents&#34;: make(map[string]interface{}), } for agentID, requests := range lbm.requestsPerAgent { agentStats := map[string]interface{}{ &#34;requests&#34;: requests, &#34;errors&#34;: lbm.errorsByAgent[agentID], } // Calculate average response time if responseTimes := lbm.responseTimesByAgent[agentID]; len(responseTimes) &gt; 0 { total := time.Duration(0) for _, rt := range responseTimes { total &#43;= rt } agentStats[&#34;avg_response_time&#34;] = total / time.Duration(len(responseTimes)) } stats[&#34;agents&#34;].(map[string]interface{})[agentID] = agentStats } return stats }🎯 Best Practices 1. Configuration for Scaling # agentflow.toml - Production scaling configuration [runtime] max_concurrent_agents = 50 timeout_seconds = 30 enable_metrics = true metrics_port = 8080 [load_balancer] strategy = &#34;performance_based&#34; # round_robin, weighted, least_connections, performance_based health_check_interval = &#34;30s&#34; unhealthy_threshold = 3 healthy_threshold = 2 [scaling] min_instances = 2 max_instances = 20 target_cpu_utilization = 70 target_memory_utilization = 80 scale_up_cooldown = &#34;2m&#34; scale_down_cooldown = &#34;5m&#34; [shared_resources] redis_url = &#34;${REDIS_URL}&#34; postgres_url = &#34;${POSTGRES_URL}&#34; vector_db_url = &#34;${VECTOR_DB_URL}&#34;2. Health Check Implementation func (a *ScalableAgent) HealthCheck() map[string]interface{} { health := map[string]interface{}{ &#34;status&#34;: &#34;healthy&#34;, &#34;timestamp&#34;: time.Now().Format(time.RFC3339), } // Check LLM provider if err := a.checkLLMProvider(); err != nil { health[&#34;status&#34;] = &#34;unhealthy&#34; health[&#34;llm_provider_error&#34;] = err.Error() } // Check shared cache if err := a.checkCache(); err != nil { health[&#34;status&#34;] = &#34;degraded&#34; health[&#34;cache_error&#34;] = err.Error() } // Check memory system if err := a.checkMemory(); err != nil { health[&#34;status&#34;] = &#34;degraded&#34; health[&#34;memory_error&#34;] = err.Error() } // Add performance metrics health[&#34;metrics&#34;] = map[string]interface{}{ &#34;requests_per_minute&#34;: a.getRequestsPerMinute(), &#34;avg_response_time&#34;: a.getAverageResponseTime(), &#34;error_rate&#34;: a.getErrorRate(), } return health }3. Graceful Shutdown func (a *ScalableAgent) GracefulShutdown(ctx context.Context) error { log.Println(&#34;Starting graceful shutdown...&#34;) // Stop accepting new requests a.stopAcceptingRequests() // Wait for ongoing requests to complete done := make(chan struct{}) go func() { a.waitForOngoingRequests() close(done) }() select { case &lt;-done: log.Println(&#34;All requests completed&#34;) case &lt;-ctx.Done(): log.Println(&#34;Shutdown timeout reached, forcing shutdown&#34;) } // Clean up resources a.cleanup() log.Println(&#34;Graceful shutdown completed&#34;) return nil }Load balancing and scaling are essential for building production-ready agent systems that can handle varying loads efficiently and maintain high availability.">
    <meta property="og:url" content="http://localhost:1313/AgenticGoKitDocs/tutorials/advanced/load-balancing-scaling/index.html">
    <meta property="og:site_name" content="AgenticGoKit Docs">
    <meta property="og:title" content="load-balancing-scaling :: AgenticGoKit Docs">
    <meta property="og:description" content="Load Balancing and Scaling Patterns Building horizontally scalable agent systems with intelligent load distribution
As your agent systems grow, you need strategies to distribute load effectively and scale horizontally. This guide covers load balancing patterns, horizontal scaling strategies, and performance optimization techniques for AgenticGoKit applications.
🏗️ Scaling Architecture Overview flowchart TBsubgraph &#34;Load Balancer Layer&#34;LB[Load Balancer]HEALTH[Health Checker]endsubgraph &#34;Agent Instances&#34;AGENT1[Agent Instance 1]AGENT2[Agent Instance 2]AGENT3[Agent Instance 3]AGENTN[Agent Instance N]endsubgraph &#34;Shared Resources&#34;REDIS[Redis Cache]POSTGRES[PostgreSQL]VECTOR[Vector DB]MCP[MCP Servers]endsubgraph &#34;Monitoring&#34;METRICS[Metrics Collector]ALERTS[Alert Manager]endCLIENT[Client Requests] --&gt; LBLB --&gt; AGENT1LB --&gt; AGENT2LB --&gt; AGENT3LB --&gt; AGENTNHEALTH --&gt; AGENT1HEALTH --&gt; AGENT2HEALTH --&gt; AGENT3HEALTH --&gt; AGENTNAGENT1 --&gt; REDISAGENT2 --&gt; REDISAGENT3 --&gt; REDISAGENTN --&gt; REDISAGENT1 --&gt; POSTGRESAGENT2 --&gt; POSTGRESAGENT3 --&gt; POSTGRESAGENTN --&gt; POSTGRESAGENT1 --&gt; VECTORAGENT2 --&gt; VECTORAGENT3 --&gt; VECTORAGENTN --&gt; VECTORAGENT1 --&gt; MCPAGENT2 --&gt; MCPAGENT3 --&gt; MCPAGENTN --&gt; MCPAGENT1 --&gt; METRICSAGENT2 --&gt; METRICSAGENT3 --&gt; METRICSAGENTN --&gt; METRICSMETRICS --&gt; ALERTSclassDef lb fill:#e3f2fd,stroke:#1976d2,stroke-width:2pxclassDef agent fill:#e8f5e8,stroke:#388e3c,stroke-width:2pxclassDef shared fill:#fff3e0,stroke:#f57c00,stroke-width:2pxclassDef monitor fill:#fce4ec,stroke:#c2185b,stroke-width:2pxclass LB,HEALTH lbclass AGENT1,AGENT2,AGENT3,AGENTN agentclass REDIS,POSTGRES,VECTOR,MCP sharedclass METRICS,ALERTS monitor⚖️ Load Balancing Strategies 1. Round Robin Load Balancing package balancer import ( &#34;context&#34; &#34;sync&#34; &#34;sync/atomic&#34; &#34;github.com/kunalkushwaha/agenticgokit/core&#34; ) type RoundRobinBalancer struct { agents []core.AgentHandler counter int64 mu sync.RWMutex } func NewRoundRobinBalancer(agents []core.AgentHandler) *RoundRobinBalancer { return &amp;RoundRobinBalancer{ agents: agents, } } func (rb *RoundRobinBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { if len(rb.agents) == 0 { return nil, errors.New(&#34;no agents available&#34;) } // Get next agent in round-robin fashion index := atomic.AddInt64(&amp;rb.counter, 1) % int64(len(rb.agents)) agent := rb.agents[index] return agent.Execute(ctx, event, state) } func (rb *RoundRobinBalancer) AddAgent(agent core.AgentHandler) { rb.mu.Lock() defer rb.mu.Unlock() rb.agents = append(rb.agents, agent) } func (rb *RoundRobinBalancer) RemoveAgent(index int) { rb.mu.Lock() defer rb.mu.Unlock() if index &gt;= 0 &amp;&amp; index &lt; len(rb.agents) { rb.agents = append(rb.agents[:index], rb.agents[index&#43;1:]...) } }2. Weighted Load Balancing type WeightedBalancer struct { agents []WeightedAgent totalWeight int mu sync.RWMutex } type WeightedAgent struct { Agent core.AgentHandler Weight int CurrentWeight int } func NewWeightedBalancer() *WeightedBalancer { return &amp;WeightedBalancer{ agents: make([]WeightedAgent, 0), } } func (wb *WeightedBalancer) AddAgent(agent core.AgentHandler, weight int) { wb.mu.Lock() defer wb.mu.Unlock() wb.agents = append(wb.agents, WeightedAgent{ Agent: agent, Weight: weight, CurrentWeight: 0, }) wb.totalWeight &#43;= weight } func (wb *WeightedBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { wb.mu.Lock() defer wb.mu.Unlock() if len(wb.agents) == 0 { return nil, errors.New(&#34;no agents available&#34;) } // Weighted round-robin algorithm selected := wb.selectAgent() if selected == nil { return nil, errors.New(&#34;no agent selected&#34;) } return selected.Execute(ctx, event, state) } func (wb *WeightedBalancer) selectAgent() core.AgentHandler { var selected *WeightedAgent for i := range wb.agents { agent := &amp;wb.agents[i] agent.CurrentWeight &#43;= agent.Weight if selected == nil || agent.CurrentWeight &gt; selected.CurrentWeight { selected = agent } } if selected != nil { selected.CurrentWeight -= wb.totalWeight return selected.Agent } return nil }3. Least Connections Load Balancing type LeastConnectionsBalancer struct { agents []ConnectionTrackingAgent mu sync.RWMutex } type ConnectionTrackingAgent struct { Agent core.AgentHandler Connections int64 mu sync.RWMutex } func NewLeastConnectionsBalancer(agents []core.AgentHandler) *LeastConnectionsBalancer { trackingAgents := make([]ConnectionTrackingAgent, len(agents)) for i, agent := range agents { trackingAgents[i] = ConnectionTrackingAgent{ Agent: agent, } } return &amp;LeastConnectionsBalancer{ agents: trackingAgents, } } func (lcb *LeastConnectionsBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { agent := lcb.selectLeastConnectedAgent() if agent == nil { return nil, errors.New(&#34;no agents available&#34;) } // Increment connection count atomic.AddInt64(&amp;agent.Connections, 1) defer atomic.AddInt64(&amp;agent.Connections, -1) return agent.Agent.Execute(ctx, event, state) } func (lcb *LeastConnectionsBalancer) selectLeastConnectedAgent() *ConnectionTrackingAgent { lcb.mu.RLock() defer lcb.mu.RUnlock() if len(lcb.agents) == 0 { return nil } var selected *ConnectionTrackingAgent minConnections := int64(^uint64(0) &gt;&gt; 1) // Max int64 for i := range lcb.agents { agent := &amp;lcb.agents[i] connections := atomic.LoadInt64(&amp;agent.Connections) if connections &lt; minConnections { minConnections = connections selected = agent } } return selected }4. Performance-Based Load Balancing type PerformanceBasedBalancer struct { agents []PerformanceTrackingAgent mu sync.RWMutex } type PerformanceTrackingAgent struct { Agent core.AgentHandler ResponseTimes []time.Duration SuccessRate float64 LastUpdate time.Time mu sync.RWMutex } func NewPerformanceBasedBalancer(agents []core.AgentHandler) *PerformanceBasedBalancer { trackingAgents := make([]PerformanceTrackingAgent, len(agents)) for i, agent := range agents { trackingAgents[i] = PerformanceTrackingAgent{ Agent: agent, ResponseTimes: make([]time.Duration, 0, 100), SuccessRate: 1.0, LastUpdate: time.Now(), } } return &amp;PerformanceBasedBalancer{ agents: trackingAgents, } } func (pbb *PerformanceBasedBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { agent := pbb.selectBestPerformingAgent() if agent == nil { return nil, errors.New(&#34;no agents available&#34;) } start := time.Now() result, err := agent.Agent.Execute(ctx, event, state) duration := time.Since(start) // Record performance metrics pbb.recordPerformance(agent, duration, err == nil) return result, err } func (pbb *PerformanceBasedBalancer) selectBestPerformingAgent() *PerformanceTrackingAgent { pbb.mu.RLock() defer pbb.mu.RUnlock() if len(pbb.agents) == 0 { return nil } var selected *PerformanceTrackingAgent bestScore := -1.0 for i := range pbb.agents { agent := &amp;pbb.agents[i] score := pbb.calculatePerformanceScore(agent) if score &gt; bestScore { bestScore = score selected = agent } } return selected } func (pbb *PerformanceBasedBalancer) calculatePerformanceScore(agent *PerformanceTrackingAgent) float64 { agent.mu.RLock() defer agent.mu.RUnlock() // Calculate average response time avgResponseTime := time.Duration(0) if len(agent.ResponseTimes) &gt; 0 { total := time.Duration(0) for _, rt := range agent.ResponseTimes { total &#43;= rt } avgResponseTime = total / time.Duration(len(agent.ResponseTimes)) } // Normalize response time (lower is better) responseTimeScore := 1.0 / (1.0 &#43; avgResponseTime.Seconds()) // Combine success rate and response time return (agent.SuccessRate * 0.7) &#43; (responseTimeScore * 0.3) } func (pbb *PerformanceBasedBalancer) recordPerformance(agent *PerformanceTrackingAgent, duration time.Duration, success bool) { agent.mu.Lock() defer agent.mu.Unlock() // Record response time agent.ResponseTimes = append(agent.ResponseTimes, duration) if len(agent.ResponseTimes) &gt; 100 { agent.ResponseTimes = agent.ResponseTimes[1:] } // Update success rate (exponential moving average) alpha := 0.1 if success { agent.SuccessRate = agent.SuccessRate*(1-alpha) &#43; alpha } else { agent.SuccessRate = agent.SuccessRate * (1 - alpha) } agent.LastUpdate = time.Now() }🔄 Horizontal Scaling Patterns 1. Stateless Agent Design // Stateless agent that can be scaled horizontally type StatelessAgent struct { name string llmProvider core.ModelProvider cache CacheProvider // Shared cache memory MemoryProvider // Shared memory } func NewStatelessAgent(name string, provider core.ModelProvider, cache CacheProvider, memory MemoryProvider) *StatelessAgent { return &amp;StatelessAgent{ name: name, llmProvider: provider, cache: cache, memory: memory, } } func (sa *StatelessAgent) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { // All state is passed in or retrieved from shared resources // No local state that would prevent horizontal scaling // Get context from shared memory context := sa.memory.GetContext(state.SessionID) // Check shared cache cacheKey := sa.generateCacheKey(event) if cached := sa.cache.Get(cacheKey); cached != nil { return cached.(*core.AgentResult), nil } // Process request result, err := sa.processRequest(ctx, event, context) if err != nil { return nil, err } // Store in shared cache sa.cache.Set(cacheKey, result, 5*time.Minute) return result, nil } func (sa *StatelessAgent) generateCacheKey(event core.Event) string { return fmt.Sprintf(&#34;%s:%s:%x&#34;, sa.name, event.Type, sha256.Sum256([]byte(fmt.Sprintf(&#34;%v&#34;, event.Data)))) }2. Auto-Scaling Controller type AutoScaler struct { minInstances int maxInstances int currentInstances int targetCPU float64 targetMemory float64 scaleUpCooldown time.Duration scaleDownCooldown time.Duration lastScaleAction time.Time metrics MetricsProvider orchestrator Orchestrator mu sync.RWMutex } func NewAutoScaler(min, max int, orchestrator Orchestrator) *AutoScaler { return &amp;AutoScaler{ minInstances: min, maxInstances: max, currentInstances: min, targetCPU: 70.0, // 70% CPU utilization targetMemory: 80.0, // 80% memory utilization scaleUpCooldown: 2 * time.Minute, scaleDownCooldown: 5 * time.Minute, orchestrator: orchestrator, } } func (as *AutoScaler) Start(ctx context.Context) { ticker := time.NewTicker(30 * time.Second) defer ticker.Stop() for { select { case &lt;-ticker.C: as.evaluateScaling() case &lt;-ctx.Done(): return } } } func (as *AutoScaler) evaluateScaling() { as.mu.Lock() defer as.mu.Unlock() // Get current metrics cpuUsage := as.metrics.GetCPUUsage() memoryUsage := as.metrics.GetMemoryUsage() requestRate := as.metrics.GetRequestRate() // Determine if scaling is needed shouldScaleUp := (cpuUsage &gt; as.targetCPU || memoryUsage &gt; as.targetMemory) &amp;&amp; as.currentInstances &lt; as.maxInstances &amp;&amp; time.Since(as.lastScaleAction) &gt; as.scaleUpCooldown shouldScaleDown := cpuUsage &lt; as.targetCPU*0.5 &amp;&amp; memoryUsage &lt; as.targetMemory*0.5 &amp;&amp; as.currentInstances &gt; as.minInstances &amp;&amp; time.Since(as.lastScaleAction) &gt; as.scaleDownCooldown if shouldScaleUp { as.scaleUp() } else if shouldScaleDown { as.scaleDown() } } func (as *AutoScaler) scaleUp() { newInstances := min(as.currentInstances&#43;1, as.maxInstances) if newInstances &gt; as.currentInstances { err := as.orchestrator.AddInstance() if err == nil { as.currentInstances = newInstances as.lastScaleAction = time.Now() log.Printf(&#34;Scaled up to %d instances&#34;, as.currentInstances) } } } func (as *AutoScaler) scaleDown() { newInstances := max(as.currentInstances-1, as.minInstances) if newInstances &lt; as.currentInstances { err := as.orchestrator.RemoveInstance() if err == nil { as.currentInstances = newInstances as.lastScaleAction = time.Now() log.Printf(&#34;Scaled down to %d instances&#34;, as.currentInstances) } } }3. Health-Aware Load Balancing type HealthAwareBalancer struct { agents []HealthTrackingAgent healthCheck time.Duration mu sync.RWMutex } type HealthTrackingAgent struct { Agent core.AgentHandler Healthy bool LastCheck time.Time Endpoint string } func NewHealthAwareBalancer(agents []core.AgentHandler) *HealthAwareBalancer { trackingAgents := make([]HealthTrackingAgent, len(agents)) for i, agent := range agents { trackingAgents[i] = HealthTrackingAgent{ Agent: agent, Healthy: true, } } hab := &amp;HealthAwareBalancer{ agents: trackingAgents, healthCheck: 30 * time.Second, } // Start health checking go hab.startHealthChecking() return hab } func (hab *HealthAwareBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { healthyAgents := hab.getHealthyAgents() if len(healthyAgents) == 0 { return nil, errors.New(&#34;no healthy agents available&#34;) } // Use round-robin among healthy agents index := rand.Intn(len(healthyAgents)) return healthyAgents[index].Execute(ctx, event, state) } func (hab *HealthAwareBalancer) getHealthyAgents() []core.AgentHandler { hab.mu.RLock() defer hab.mu.RUnlock() var healthy []core.AgentHandler for _, agent := range hab.agents { if agent.Healthy { healthy = append(healthy, agent.Agent) } } return healthy } func (hab *HealthAwareBalancer) startHealthChecking() { ticker := time.NewTicker(hab.healthCheck) defer ticker.Stop() for range ticker.C { hab.checkHealth() } } func (hab *HealthAwareBalancer) checkHealth() { hab.mu.Lock() defer hab.mu.Unlock() for i := range hab.agents { agent := &amp;hab.agents[i] // Perform health check healthy := hab.performHealthCheck(agent) if agent.Healthy != healthy { agent.Healthy = healthy if healthy { log.Printf(&#34;Agent %d is now healthy&#34;, i) } else { log.Printf(&#34;Agent %d is now unhealthy&#34;, i) } } agent.LastCheck = time.Now() } } func (hab *HealthAwareBalancer) performHealthCheck(agent *HealthTrackingAgent) bool { // Simple health check - try to execute a test request ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second) defer cancel() testEvent := core.NewEvent(&#34;health_check&#34;, &#34;ping&#34;) testState := &amp;core.State{} _, err := agent.Agent.Execute(ctx, testEvent, testState) return err == nil }🐳 Container Orchestration Docker Compose for Development # docker-compose.yml version: &#39;3.8&#39; services: agent-1: build: . environment: - INSTANCE_ID=1 - REDIS_URL=redis://redis:6379 - POSTGRES_URL=postgres://user:pass@postgres:5432/agentflow depends_on: - redis - postgres deploy: resources: limits: cpus: &#39;0.5&#39; memory: 512M reservations: cpus: &#39;0.25&#39; memory: 256M agent-2: build: . environment: - INSTANCE_ID=2 - REDIS_URL=redis://redis:6379 - POSTGRES_URL=postgres://user:pass@postgres:5432/agentflow depends_on: - redis - postgres deploy: resources: limits: cpus: &#39;0.5&#39; memory: 512M agent-3: build: . environment: - INSTANCE_ID=3 - REDIS_URL=redis://redis:6379 - POSTGRES_URL=postgres://user:pass@postgres:5432/agentflow depends_on: - redis - postgres nginx: image: nginx:alpine ports: - &#34;80:80&#34; volumes: - ./nginx.conf:/etc/nginx/nginx.conf depends_on: - agent-1 - agent-2 - agent-3 redis: image: redis:7-alpine volumes: - redis_data:/data postgres: image: pgvector/pgvector:pg15 environment: POSTGRES_DB: agentflow POSTGRES_USER: user POSTGRES_PASSWORD: pass volumes: - postgres_data:/var/lib/postgresql/data volumes: redis_data: postgres_data:Kubernetes Deployment # k8s/deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: agenticgokit-agents spec: replicas: 3 selector: matchLabels: app: agenticgokit-agents template: metadata: labels: app: agenticgokit-agents spec: containers: - name: agent image: agenticgokit:latest ports: - containerPort: 8080 env: - name: REDIS_URL value: &#34;redis://redis-service:6379&#34; - name: POSTGRES_URL valueFrom: secretKeyRef: name: db-secret key: postgres-url resources: requests: memory: &#34;256Mi&#34; cpu: &#34;250m&#34; limits: memory: &#34;512Mi&#34; cpu: &#34;500m&#34; livenessProbe: httpGet: path: /health port: 8080 initialDelaySeconds: 30 periodSeconds: 10 readinessProbe: httpGet: path: /ready port: 8080 initialDelaySeconds: 5 periodSeconds: 5 --- apiVersion: v1 kind: Service metadata: name: agenticgokit-service spec: selector: app: agenticgokit-agents ports: - port: 80 targetPort: 8080 type: LoadBalancer --- apiVersion: autoscaling/v2 kind: HorizontalPodAutoscaler metadata: name: agenticgokit-hpa spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: agenticgokit-agents minReplicas: 2 maxReplicas: 10 metrics: - type: Resource resource: name: cpu target: type: Utilization averageUtilization: 70 - type: Resource resource: name: memory target: type: Utilization averageUtilization: 80📊 Performance Monitoring Load Balancer Metrics type LoadBalancerMetrics struct { totalRequests int64 requestsPerAgent map[string]int64 responseTimesByAgent map[string][]time.Duration errorsByAgent map[string]int64 mu sync.RWMutex } func NewLoadBalancerMetrics() *LoadBalancerMetrics { return &amp;LoadBalancerMetrics{ requestsPerAgent: make(map[string]int64), responseTimesByAgent: make(map[string][]time.Duration), errorsByAgent: make(map[string]int64), } } func (lbm *LoadBalancerMetrics) RecordRequest(agentID string, duration time.Duration, success bool) { lbm.mu.Lock() defer lbm.mu.Unlock() lbm.totalRequests&#43;&#43; lbm.requestsPerAgent[agentID]&#43;&#43; // Record response time if lbm.responseTimesByAgent[agentID] == nil { lbm.responseTimesByAgent[agentID] = make([]time.Duration, 0, 100) } lbm.responseTimesByAgent[agentID] = append(lbm.responseTimesByAgent[agentID], duration) // Keep only recent response times if len(lbm.responseTimesByAgent[agentID]) &gt; 100 { lbm.responseTimesByAgent[agentID] = lbm.responseTimesByAgent[agentID][1:] } // Record errors if !success { lbm.errorsByAgent[agentID]&#43;&#43; } } func (lbm *LoadBalancerMetrics) GetStats() map[string]interface{} { lbm.mu.RLock() defer lbm.mu.RUnlock() stats := map[string]interface{}{ &#34;total_requests&#34;: lbm.totalRequests, &#34;agents&#34;: make(map[string]interface{}), } for agentID, requests := range lbm.requestsPerAgent { agentStats := map[string]interface{}{ &#34;requests&#34;: requests, &#34;errors&#34;: lbm.errorsByAgent[agentID], } // Calculate average response time if responseTimes := lbm.responseTimesByAgent[agentID]; len(responseTimes) &gt; 0 { total := time.Duration(0) for _, rt := range responseTimes { total &#43;= rt } agentStats[&#34;avg_response_time&#34;] = total / time.Duration(len(responseTimes)) } stats[&#34;agents&#34;].(map[string]interface{})[agentID] = agentStats } return stats }🎯 Best Practices 1. Configuration for Scaling # agentflow.toml - Production scaling configuration [runtime] max_concurrent_agents = 50 timeout_seconds = 30 enable_metrics = true metrics_port = 8080 [load_balancer] strategy = &#34;performance_based&#34; # round_robin, weighted, least_connections, performance_based health_check_interval = &#34;30s&#34; unhealthy_threshold = 3 healthy_threshold = 2 [scaling] min_instances = 2 max_instances = 20 target_cpu_utilization = 70 target_memory_utilization = 80 scale_up_cooldown = &#34;2m&#34; scale_down_cooldown = &#34;5m&#34; [shared_resources] redis_url = &#34;${REDIS_URL}&#34; postgres_url = &#34;${POSTGRES_URL}&#34; vector_db_url = &#34;${VECTOR_DB_URL}&#34;2. Health Check Implementation func (a *ScalableAgent) HealthCheck() map[string]interface{} { health := map[string]interface{}{ &#34;status&#34;: &#34;healthy&#34;, &#34;timestamp&#34;: time.Now().Format(time.RFC3339), } // Check LLM provider if err := a.checkLLMProvider(); err != nil { health[&#34;status&#34;] = &#34;unhealthy&#34; health[&#34;llm_provider_error&#34;] = err.Error() } // Check shared cache if err := a.checkCache(); err != nil { health[&#34;status&#34;] = &#34;degraded&#34; health[&#34;cache_error&#34;] = err.Error() } // Check memory system if err := a.checkMemory(); err != nil { health[&#34;status&#34;] = &#34;degraded&#34; health[&#34;memory_error&#34;] = err.Error() } // Add performance metrics health[&#34;metrics&#34;] = map[string]interface{}{ &#34;requests_per_minute&#34;: a.getRequestsPerMinute(), &#34;avg_response_time&#34;: a.getAverageResponseTime(), &#34;error_rate&#34;: a.getErrorRate(), } return health }3. Graceful Shutdown func (a *ScalableAgent) GracefulShutdown(ctx context.Context) error { log.Println(&#34;Starting graceful shutdown...&#34;) // Stop accepting new requests a.stopAcceptingRequests() // Wait for ongoing requests to complete done := make(chan struct{}) go func() { a.waitForOngoingRequests() close(done) }() select { case &lt;-done: log.Println(&#34;All requests completed&#34;) case &lt;-ctx.Done(): log.Println(&#34;Shutdown timeout reached, forcing shutdown&#34;) } // Clean up resources a.cleanup() log.Println(&#34;Graceful shutdown completed&#34;) return nil }Load balancing and scaling are essential for building production-ready agent systems that can handle varying loads efficiently and maintain high availability.">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="tutorials">
    <meta property="article:published_time" content="2025-07-25T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-07-25T00:00:00+00:00">
    <meta itemprop="name" content="load-balancing-scaling :: AgenticGoKit Docs">
    <meta itemprop="description" content="Load Balancing and Scaling Patterns Building horizontally scalable agent systems with intelligent load distribution
As your agent systems grow, you need strategies to distribute load effectively and scale horizontally. This guide covers load balancing patterns, horizontal scaling strategies, and performance optimization techniques for AgenticGoKit applications.
🏗️ Scaling Architecture Overview flowchart TBsubgraph &#34;Load Balancer Layer&#34;LB[Load Balancer]HEALTH[Health Checker]endsubgraph &#34;Agent Instances&#34;AGENT1[Agent Instance 1]AGENT2[Agent Instance 2]AGENT3[Agent Instance 3]AGENTN[Agent Instance N]endsubgraph &#34;Shared Resources&#34;REDIS[Redis Cache]POSTGRES[PostgreSQL]VECTOR[Vector DB]MCP[MCP Servers]endsubgraph &#34;Monitoring&#34;METRICS[Metrics Collector]ALERTS[Alert Manager]endCLIENT[Client Requests] --&gt; LBLB --&gt; AGENT1LB --&gt; AGENT2LB --&gt; AGENT3LB --&gt; AGENTNHEALTH --&gt; AGENT1HEALTH --&gt; AGENT2HEALTH --&gt; AGENT3HEALTH --&gt; AGENTNAGENT1 --&gt; REDISAGENT2 --&gt; REDISAGENT3 --&gt; REDISAGENTN --&gt; REDISAGENT1 --&gt; POSTGRESAGENT2 --&gt; POSTGRESAGENT3 --&gt; POSTGRESAGENTN --&gt; POSTGRESAGENT1 --&gt; VECTORAGENT2 --&gt; VECTORAGENT3 --&gt; VECTORAGENTN --&gt; VECTORAGENT1 --&gt; MCPAGENT2 --&gt; MCPAGENT3 --&gt; MCPAGENTN --&gt; MCPAGENT1 --&gt; METRICSAGENT2 --&gt; METRICSAGENT3 --&gt; METRICSAGENTN --&gt; METRICSMETRICS --&gt; ALERTSclassDef lb fill:#e3f2fd,stroke:#1976d2,stroke-width:2pxclassDef agent fill:#e8f5e8,stroke:#388e3c,stroke-width:2pxclassDef shared fill:#fff3e0,stroke:#f57c00,stroke-width:2pxclassDef monitor fill:#fce4ec,stroke:#c2185b,stroke-width:2pxclass LB,HEALTH lbclass AGENT1,AGENT2,AGENT3,AGENTN agentclass REDIS,POSTGRES,VECTOR,MCP sharedclass METRICS,ALERTS monitor⚖️ Load Balancing Strategies 1. Round Robin Load Balancing package balancer import ( &#34;context&#34; &#34;sync&#34; &#34;sync/atomic&#34; &#34;github.com/kunalkushwaha/agenticgokit/core&#34; ) type RoundRobinBalancer struct { agents []core.AgentHandler counter int64 mu sync.RWMutex } func NewRoundRobinBalancer(agents []core.AgentHandler) *RoundRobinBalancer { return &amp;RoundRobinBalancer{ agents: agents, } } func (rb *RoundRobinBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { if len(rb.agents) == 0 { return nil, errors.New(&#34;no agents available&#34;) } // Get next agent in round-robin fashion index := atomic.AddInt64(&amp;rb.counter, 1) % int64(len(rb.agents)) agent := rb.agents[index] return agent.Execute(ctx, event, state) } func (rb *RoundRobinBalancer) AddAgent(agent core.AgentHandler) { rb.mu.Lock() defer rb.mu.Unlock() rb.agents = append(rb.agents, agent) } func (rb *RoundRobinBalancer) RemoveAgent(index int) { rb.mu.Lock() defer rb.mu.Unlock() if index &gt;= 0 &amp;&amp; index &lt; len(rb.agents) { rb.agents = append(rb.agents[:index], rb.agents[index&#43;1:]...) } }2. Weighted Load Balancing type WeightedBalancer struct { agents []WeightedAgent totalWeight int mu sync.RWMutex } type WeightedAgent struct { Agent core.AgentHandler Weight int CurrentWeight int } func NewWeightedBalancer() *WeightedBalancer { return &amp;WeightedBalancer{ agents: make([]WeightedAgent, 0), } } func (wb *WeightedBalancer) AddAgent(agent core.AgentHandler, weight int) { wb.mu.Lock() defer wb.mu.Unlock() wb.agents = append(wb.agents, WeightedAgent{ Agent: agent, Weight: weight, CurrentWeight: 0, }) wb.totalWeight &#43;= weight } func (wb *WeightedBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { wb.mu.Lock() defer wb.mu.Unlock() if len(wb.agents) == 0 { return nil, errors.New(&#34;no agents available&#34;) } // Weighted round-robin algorithm selected := wb.selectAgent() if selected == nil { return nil, errors.New(&#34;no agent selected&#34;) } return selected.Execute(ctx, event, state) } func (wb *WeightedBalancer) selectAgent() core.AgentHandler { var selected *WeightedAgent for i := range wb.agents { agent := &amp;wb.agents[i] agent.CurrentWeight &#43;= agent.Weight if selected == nil || agent.CurrentWeight &gt; selected.CurrentWeight { selected = agent } } if selected != nil { selected.CurrentWeight -= wb.totalWeight return selected.Agent } return nil }3. Least Connections Load Balancing type LeastConnectionsBalancer struct { agents []ConnectionTrackingAgent mu sync.RWMutex } type ConnectionTrackingAgent struct { Agent core.AgentHandler Connections int64 mu sync.RWMutex } func NewLeastConnectionsBalancer(agents []core.AgentHandler) *LeastConnectionsBalancer { trackingAgents := make([]ConnectionTrackingAgent, len(agents)) for i, agent := range agents { trackingAgents[i] = ConnectionTrackingAgent{ Agent: agent, } } return &amp;LeastConnectionsBalancer{ agents: trackingAgents, } } func (lcb *LeastConnectionsBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { agent := lcb.selectLeastConnectedAgent() if agent == nil { return nil, errors.New(&#34;no agents available&#34;) } // Increment connection count atomic.AddInt64(&amp;agent.Connections, 1) defer atomic.AddInt64(&amp;agent.Connections, -1) return agent.Agent.Execute(ctx, event, state) } func (lcb *LeastConnectionsBalancer) selectLeastConnectedAgent() *ConnectionTrackingAgent { lcb.mu.RLock() defer lcb.mu.RUnlock() if len(lcb.agents) == 0 { return nil } var selected *ConnectionTrackingAgent minConnections := int64(^uint64(0) &gt;&gt; 1) // Max int64 for i := range lcb.agents { agent := &amp;lcb.agents[i] connections := atomic.LoadInt64(&amp;agent.Connections) if connections &lt; minConnections { minConnections = connections selected = agent } } return selected }4. Performance-Based Load Balancing type PerformanceBasedBalancer struct { agents []PerformanceTrackingAgent mu sync.RWMutex } type PerformanceTrackingAgent struct { Agent core.AgentHandler ResponseTimes []time.Duration SuccessRate float64 LastUpdate time.Time mu sync.RWMutex } func NewPerformanceBasedBalancer(agents []core.AgentHandler) *PerformanceBasedBalancer { trackingAgents := make([]PerformanceTrackingAgent, len(agents)) for i, agent := range agents { trackingAgents[i] = PerformanceTrackingAgent{ Agent: agent, ResponseTimes: make([]time.Duration, 0, 100), SuccessRate: 1.0, LastUpdate: time.Now(), } } return &amp;PerformanceBasedBalancer{ agents: trackingAgents, } } func (pbb *PerformanceBasedBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { agent := pbb.selectBestPerformingAgent() if agent == nil { return nil, errors.New(&#34;no agents available&#34;) } start := time.Now() result, err := agent.Agent.Execute(ctx, event, state) duration := time.Since(start) // Record performance metrics pbb.recordPerformance(agent, duration, err == nil) return result, err } func (pbb *PerformanceBasedBalancer) selectBestPerformingAgent() *PerformanceTrackingAgent { pbb.mu.RLock() defer pbb.mu.RUnlock() if len(pbb.agents) == 0 { return nil } var selected *PerformanceTrackingAgent bestScore := -1.0 for i := range pbb.agents { agent := &amp;pbb.agents[i] score := pbb.calculatePerformanceScore(agent) if score &gt; bestScore { bestScore = score selected = agent } } return selected } func (pbb *PerformanceBasedBalancer) calculatePerformanceScore(agent *PerformanceTrackingAgent) float64 { agent.mu.RLock() defer agent.mu.RUnlock() // Calculate average response time avgResponseTime := time.Duration(0) if len(agent.ResponseTimes) &gt; 0 { total := time.Duration(0) for _, rt := range agent.ResponseTimes { total &#43;= rt } avgResponseTime = total / time.Duration(len(agent.ResponseTimes)) } // Normalize response time (lower is better) responseTimeScore := 1.0 / (1.0 &#43; avgResponseTime.Seconds()) // Combine success rate and response time return (agent.SuccessRate * 0.7) &#43; (responseTimeScore * 0.3) } func (pbb *PerformanceBasedBalancer) recordPerformance(agent *PerformanceTrackingAgent, duration time.Duration, success bool) { agent.mu.Lock() defer agent.mu.Unlock() // Record response time agent.ResponseTimes = append(agent.ResponseTimes, duration) if len(agent.ResponseTimes) &gt; 100 { agent.ResponseTimes = agent.ResponseTimes[1:] } // Update success rate (exponential moving average) alpha := 0.1 if success { agent.SuccessRate = agent.SuccessRate*(1-alpha) &#43; alpha } else { agent.SuccessRate = agent.SuccessRate * (1 - alpha) } agent.LastUpdate = time.Now() }🔄 Horizontal Scaling Patterns 1. Stateless Agent Design // Stateless agent that can be scaled horizontally type StatelessAgent struct { name string llmProvider core.ModelProvider cache CacheProvider // Shared cache memory MemoryProvider // Shared memory } func NewStatelessAgent(name string, provider core.ModelProvider, cache CacheProvider, memory MemoryProvider) *StatelessAgent { return &amp;StatelessAgent{ name: name, llmProvider: provider, cache: cache, memory: memory, } } func (sa *StatelessAgent) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { // All state is passed in or retrieved from shared resources // No local state that would prevent horizontal scaling // Get context from shared memory context := sa.memory.GetContext(state.SessionID) // Check shared cache cacheKey := sa.generateCacheKey(event) if cached := sa.cache.Get(cacheKey); cached != nil { return cached.(*core.AgentResult), nil } // Process request result, err := sa.processRequest(ctx, event, context) if err != nil { return nil, err } // Store in shared cache sa.cache.Set(cacheKey, result, 5*time.Minute) return result, nil } func (sa *StatelessAgent) generateCacheKey(event core.Event) string { return fmt.Sprintf(&#34;%s:%s:%x&#34;, sa.name, event.Type, sha256.Sum256([]byte(fmt.Sprintf(&#34;%v&#34;, event.Data)))) }2. Auto-Scaling Controller type AutoScaler struct { minInstances int maxInstances int currentInstances int targetCPU float64 targetMemory float64 scaleUpCooldown time.Duration scaleDownCooldown time.Duration lastScaleAction time.Time metrics MetricsProvider orchestrator Orchestrator mu sync.RWMutex } func NewAutoScaler(min, max int, orchestrator Orchestrator) *AutoScaler { return &amp;AutoScaler{ minInstances: min, maxInstances: max, currentInstances: min, targetCPU: 70.0, // 70% CPU utilization targetMemory: 80.0, // 80% memory utilization scaleUpCooldown: 2 * time.Minute, scaleDownCooldown: 5 * time.Minute, orchestrator: orchestrator, } } func (as *AutoScaler) Start(ctx context.Context) { ticker := time.NewTicker(30 * time.Second) defer ticker.Stop() for { select { case &lt;-ticker.C: as.evaluateScaling() case &lt;-ctx.Done(): return } } } func (as *AutoScaler) evaluateScaling() { as.mu.Lock() defer as.mu.Unlock() // Get current metrics cpuUsage := as.metrics.GetCPUUsage() memoryUsage := as.metrics.GetMemoryUsage() requestRate := as.metrics.GetRequestRate() // Determine if scaling is needed shouldScaleUp := (cpuUsage &gt; as.targetCPU || memoryUsage &gt; as.targetMemory) &amp;&amp; as.currentInstances &lt; as.maxInstances &amp;&amp; time.Since(as.lastScaleAction) &gt; as.scaleUpCooldown shouldScaleDown := cpuUsage &lt; as.targetCPU*0.5 &amp;&amp; memoryUsage &lt; as.targetMemory*0.5 &amp;&amp; as.currentInstances &gt; as.minInstances &amp;&amp; time.Since(as.lastScaleAction) &gt; as.scaleDownCooldown if shouldScaleUp { as.scaleUp() } else if shouldScaleDown { as.scaleDown() } } func (as *AutoScaler) scaleUp() { newInstances := min(as.currentInstances&#43;1, as.maxInstances) if newInstances &gt; as.currentInstances { err := as.orchestrator.AddInstance() if err == nil { as.currentInstances = newInstances as.lastScaleAction = time.Now() log.Printf(&#34;Scaled up to %d instances&#34;, as.currentInstances) } } } func (as *AutoScaler) scaleDown() { newInstances := max(as.currentInstances-1, as.minInstances) if newInstances &lt; as.currentInstances { err := as.orchestrator.RemoveInstance() if err == nil { as.currentInstances = newInstances as.lastScaleAction = time.Now() log.Printf(&#34;Scaled down to %d instances&#34;, as.currentInstances) } } }3. Health-Aware Load Balancing type HealthAwareBalancer struct { agents []HealthTrackingAgent healthCheck time.Duration mu sync.RWMutex } type HealthTrackingAgent struct { Agent core.AgentHandler Healthy bool LastCheck time.Time Endpoint string } func NewHealthAwareBalancer(agents []core.AgentHandler) *HealthAwareBalancer { trackingAgents := make([]HealthTrackingAgent, len(agents)) for i, agent := range agents { trackingAgents[i] = HealthTrackingAgent{ Agent: agent, Healthy: true, } } hab := &amp;HealthAwareBalancer{ agents: trackingAgents, healthCheck: 30 * time.Second, } // Start health checking go hab.startHealthChecking() return hab } func (hab *HealthAwareBalancer) Execute(ctx context.Context, event core.Event, state *core.State) (*core.AgentResult, error) { healthyAgents := hab.getHealthyAgents() if len(healthyAgents) == 0 { return nil, errors.New(&#34;no healthy agents available&#34;) } // Use round-robin among healthy agents index := rand.Intn(len(healthyAgents)) return healthyAgents[index].Execute(ctx, event, state) } func (hab *HealthAwareBalancer) getHealthyAgents() []core.AgentHandler { hab.mu.RLock() defer hab.mu.RUnlock() var healthy []core.AgentHandler for _, agent := range hab.agents { if agent.Healthy { healthy = append(healthy, agent.Agent) } } return healthy } func (hab *HealthAwareBalancer) startHealthChecking() { ticker := time.NewTicker(hab.healthCheck) defer ticker.Stop() for range ticker.C { hab.checkHealth() } } func (hab *HealthAwareBalancer) checkHealth() { hab.mu.Lock() defer hab.mu.Unlock() for i := range hab.agents { agent := &amp;hab.agents[i] // Perform health check healthy := hab.performHealthCheck(agent) if agent.Healthy != healthy { agent.Healthy = healthy if healthy { log.Printf(&#34;Agent %d is now healthy&#34;, i) } else { log.Printf(&#34;Agent %d is now unhealthy&#34;, i) } } agent.LastCheck = time.Now() } } func (hab *HealthAwareBalancer) performHealthCheck(agent *HealthTrackingAgent) bool { // Simple health check - try to execute a test request ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second) defer cancel() testEvent := core.NewEvent(&#34;health_check&#34;, &#34;ping&#34;) testState := &amp;core.State{} _, err := agent.Agent.Execute(ctx, testEvent, testState) return err == nil }🐳 Container Orchestration Docker Compose for Development # docker-compose.yml version: &#39;3.8&#39; services: agent-1: build: . environment: - INSTANCE_ID=1 - REDIS_URL=redis://redis:6379 - POSTGRES_URL=postgres://user:pass@postgres:5432/agentflow depends_on: - redis - postgres deploy: resources: limits: cpus: &#39;0.5&#39; memory: 512M reservations: cpus: &#39;0.25&#39; memory: 256M agent-2: build: . environment: - INSTANCE_ID=2 - REDIS_URL=redis://redis:6379 - POSTGRES_URL=postgres://user:pass@postgres:5432/agentflow depends_on: - redis - postgres deploy: resources: limits: cpus: &#39;0.5&#39; memory: 512M agent-3: build: . environment: - INSTANCE_ID=3 - REDIS_URL=redis://redis:6379 - POSTGRES_URL=postgres://user:pass@postgres:5432/agentflow depends_on: - redis - postgres nginx: image: nginx:alpine ports: - &#34;80:80&#34; volumes: - ./nginx.conf:/etc/nginx/nginx.conf depends_on: - agent-1 - agent-2 - agent-3 redis: image: redis:7-alpine volumes: - redis_data:/data postgres: image: pgvector/pgvector:pg15 environment: POSTGRES_DB: agentflow POSTGRES_USER: user POSTGRES_PASSWORD: pass volumes: - postgres_data:/var/lib/postgresql/data volumes: redis_data: postgres_data:Kubernetes Deployment # k8s/deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: agenticgokit-agents spec: replicas: 3 selector: matchLabels: app: agenticgokit-agents template: metadata: labels: app: agenticgokit-agents spec: containers: - name: agent image: agenticgokit:latest ports: - containerPort: 8080 env: - name: REDIS_URL value: &#34;redis://redis-service:6379&#34; - name: POSTGRES_URL valueFrom: secretKeyRef: name: db-secret key: postgres-url resources: requests: memory: &#34;256Mi&#34; cpu: &#34;250m&#34; limits: memory: &#34;512Mi&#34; cpu: &#34;500m&#34; livenessProbe: httpGet: path: /health port: 8080 initialDelaySeconds: 30 periodSeconds: 10 readinessProbe: httpGet: path: /ready port: 8080 initialDelaySeconds: 5 periodSeconds: 5 --- apiVersion: v1 kind: Service metadata: name: agenticgokit-service spec: selector: app: agenticgokit-agents ports: - port: 80 targetPort: 8080 type: LoadBalancer --- apiVersion: autoscaling/v2 kind: HorizontalPodAutoscaler metadata: name: agenticgokit-hpa spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: agenticgokit-agents minReplicas: 2 maxReplicas: 10 metrics: - type: Resource resource: name: cpu target: type: Utilization averageUtilization: 70 - type: Resource resource: name: memory target: type: Utilization averageUtilization: 80📊 Performance Monitoring Load Balancer Metrics type LoadBalancerMetrics struct { totalRequests int64 requestsPerAgent map[string]int64 responseTimesByAgent map[string][]time.Duration errorsByAgent map[string]int64 mu sync.RWMutex } func NewLoadBalancerMetrics() *LoadBalancerMetrics { return &amp;LoadBalancerMetrics{ requestsPerAgent: make(map[string]int64), responseTimesByAgent: make(map[string][]time.Duration), errorsByAgent: make(map[string]int64), } } func (lbm *LoadBalancerMetrics) RecordRequest(agentID string, duration time.Duration, success bool) { lbm.mu.Lock() defer lbm.mu.Unlock() lbm.totalRequests&#43;&#43; lbm.requestsPerAgent[agentID]&#43;&#43; // Record response time if lbm.responseTimesByAgent[agentID] == nil { lbm.responseTimesByAgent[agentID] = make([]time.Duration, 0, 100) } lbm.responseTimesByAgent[agentID] = append(lbm.responseTimesByAgent[agentID], duration) // Keep only recent response times if len(lbm.responseTimesByAgent[agentID]) &gt; 100 { lbm.responseTimesByAgent[agentID] = lbm.responseTimesByAgent[agentID][1:] } // Record errors if !success { lbm.errorsByAgent[agentID]&#43;&#43; } } func (lbm *LoadBalancerMetrics) GetStats() map[string]interface{} { lbm.mu.RLock() defer lbm.mu.RUnlock() stats := map[string]interface{}{ &#34;total_requests&#34;: lbm.totalRequests, &#34;agents&#34;: make(map[string]interface{}), } for agentID, requests := range lbm.requestsPerAgent { agentStats := map[string]interface{}{ &#34;requests&#34;: requests, &#34;errors&#34;: lbm.errorsByAgent[agentID], } // Calculate average response time if responseTimes := lbm.responseTimesByAgent[agentID]; len(responseTimes) &gt; 0 { total := time.Duration(0) for _, rt := range responseTimes { total &#43;= rt } agentStats[&#34;avg_response_time&#34;] = total / time.Duration(len(responseTimes)) } stats[&#34;agents&#34;].(map[string]interface{})[agentID] = agentStats } return stats }🎯 Best Practices 1. Configuration for Scaling # agentflow.toml - Production scaling configuration [runtime] max_concurrent_agents = 50 timeout_seconds = 30 enable_metrics = true metrics_port = 8080 [load_balancer] strategy = &#34;performance_based&#34; # round_robin, weighted, least_connections, performance_based health_check_interval = &#34;30s&#34; unhealthy_threshold = 3 healthy_threshold = 2 [scaling] min_instances = 2 max_instances = 20 target_cpu_utilization = 70 target_memory_utilization = 80 scale_up_cooldown = &#34;2m&#34; scale_down_cooldown = &#34;5m&#34; [shared_resources] redis_url = &#34;${REDIS_URL}&#34; postgres_url = &#34;${POSTGRES_URL}&#34; vector_db_url = &#34;${VECTOR_DB_URL}&#34;2. Health Check Implementation func (a *ScalableAgent) HealthCheck() map[string]interface{} { health := map[string]interface{}{ &#34;status&#34;: &#34;healthy&#34;, &#34;timestamp&#34;: time.Now().Format(time.RFC3339), } // Check LLM provider if err := a.checkLLMProvider(); err != nil { health[&#34;status&#34;] = &#34;unhealthy&#34; health[&#34;llm_provider_error&#34;] = err.Error() } // Check shared cache if err := a.checkCache(); err != nil { health[&#34;status&#34;] = &#34;degraded&#34; health[&#34;cache_error&#34;] = err.Error() } // Check memory system if err := a.checkMemory(); err != nil { health[&#34;status&#34;] = &#34;degraded&#34; health[&#34;memory_error&#34;] = err.Error() } // Add performance metrics health[&#34;metrics&#34;] = map[string]interface{}{ &#34;requests_per_minute&#34;: a.getRequestsPerMinute(), &#34;avg_response_time&#34;: a.getAverageResponseTime(), &#34;error_rate&#34;: a.getErrorRate(), } return health }3. Graceful Shutdown func (a *ScalableAgent) GracefulShutdown(ctx context.Context) error { log.Println(&#34;Starting graceful shutdown...&#34;) // Stop accepting new requests a.stopAcceptingRequests() // Wait for ongoing requests to complete done := make(chan struct{}) go func() { a.waitForOngoingRequests() close(done) }() select { case &lt;-done: log.Println(&#34;All requests completed&#34;) case &lt;-ctx.Done(): log.Println(&#34;Shutdown timeout reached, forcing shutdown&#34;) } // Clean up resources a.cleanup() log.Println(&#34;Graceful shutdown completed&#34;) return nil }Load balancing and scaling are essential for building production-ready agent systems that can handle varying loads efficiently and maintain high availability.">
    <meta itemprop="datePublished" content="2025-07-25T00:00:00+00:00">
    <meta itemprop="dateModified" content="2025-07-25T00:00:00+00:00">
    <meta itemprop="wordCount" content="2316">
    <title>load-balancing-scaling :: AgenticGoKit Docs</title>
    <link href="/AgenticGoKitDocs/css/auto-complete/auto-complete.min.css?1753430931" rel="stylesheet">
    <script src="/AgenticGoKitDocs/js/auto-complete/auto-complete.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/search-lunr.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/search.js?1753430931" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/AgenticGoKitDocs/searchindex.en.js?1753430931";
    </script>
    <script src="/AgenticGoKitDocs/js/lunr/lunr.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/lunr/lunr.stemmer.support.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/lunr/lunr.multi.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/lunr/lunr.en.min.js?1753430931" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/AgenticGoKitDocs/fonts/fontawesome/css/fontawesome-all.min.css?1753430931" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/AgenticGoKitDocs/fonts/fontawesome/css/fontawesome-all.min.css?1753430931" rel="stylesheet"></noscript>
    <link href="/AgenticGoKitDocs/css/perfect-scrollbar/perfect-scrollbar.min.css?1753430931" rel="stylesheet">
    <link href="/AgenticGoKitDocs/css/theme.css?1753430931" rel="stylesheet">
    <link href="/AgenticGoKitDocs/css/format-html.css?1753430931" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = ``;
      window.relearn.path='\/tutorials\/advanced\/load-balancing-scaling\/index.html';
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..\/..';
      window.relearn.absBaseUri='http:\/\/localhost:1313\/AgenticGoKitDocs';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=false;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'blue' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
  </head>
  <body class="mobile-support html" data-url="/AgenticGoKitDocs/tutorials/advanced/load-balancing-scaling/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li><a href="#-scaling-architecture-overview">🏗️ Scaling Architecture Overview</a></li>
    <li><a href="#-load-balancing-strategies">⚖️ Load Balancing Strategies</a>
      <ul>
        <li><a href="#1-round-robin-load-balancing"><strong>1. Round Robin Load Balancing</strong></a></li>
        <li><a href="#2-weighted-load-balancing"><strong>2. Weighted Load Balancing</strong></a></li>
        <li><a href="#3-least-connections-load-balancing"><strong>3. Least Connections Load Balancing</strong></a></li>
        <li><a href="#4-performance-based-load-balancing"><strong>4. Performance-Based Load Balancing</strong></a></li>
      </ul>
    </li>
    <li><a href="#-horizontal-scaling-patterns">🔄 Horizontal Scaling Patterns</a>
      <ul>
        <li><a href="#1-stateless-agent-design"><strong>1. Stateless Agent Design</strong></a></li>
        <li><a href="#2-auto-scaling-controller"><strong>2. Auto-Scaling Controller</strong></a></li>
        <li><a href="#3-health-aware-load-balancing"><strong>3. Health-Aware Load Balancing</strong></a></li>
      </ul>
    </li>
    <li><a href="#-container-orchestration">🐳 Container Orchestration</a>
      <ul>
        <li><a href="#docker-compose-for-development"><strong>Docker Compose for Development</strong></a></li>
        <li><a href="#kubernetes-deployment"><strong>Kubernetes Deployment</strong></a></li>
      </ul>
    </li>
    <li><a href="#-performance-monitoring">📊 Performance Monitoring</a>
      <ul>
        <li><a href="#load-balancer-metrics"><strong>Load Balancer Metrics</strong></a></li>
      </ul>
    </li>
    <li><a href="#-best-practices">🎯 Best Practices</a>
      <ul>
        <li><a href="#1-configuration-for-scaling"><strong>1. Configuration for Scaling</strong></a></li>
        <li><a href="#2-health-check-implementation"><strong>2. Health Check Implementation</strong></a></li>
        <li><a href="#3-graceful-shutdown"><strong>3. Graceful Shutdown</strong></a></li>
      </ul>
    </li>
    <li><a href="#-next-steps">🚀 Next Steps</a></li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/AgenticGoKitDocs/index.html"><span itemprop="name">content</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/AgenticGoKitDocs/tutorials/index.html"><span itemprop="name">tutorials</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/AgenticGoKitDocs/tutorials/advanced/index.html"><span itemprop="name">advanced</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><span itemprop="name">load-balancing-scaling</span><meta itemprop="position" content="4"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/AgenticGoKitDocs/tutorials/advanced/circuit-breaker-patterns/index.html" title="circuit-breaker-patterns (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/AgenticGoKitDocs/tutorials/advanced/retry-policies/index.html" title="retry-policies (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable tutorials" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="load-balancing-scaling">load-balancing-scaling</h1>

<h1 id="load-balancing-and-scaling-patterns">Load Balancing and Scaling Patterns</h1>
<p><strong>Building horizontally scalable agent systems with intelligent load distribution</strong></p>
<p>As your agent systems grow, you need strategies to distribute load effectively and scale horizontally. This guide covers load balancing patterns, horizontal scaling strategies, and performance optimization techniques for AgenticGoKit applications.</p>
<h2 id="-scaling-architecture-overview">🏗️ Scaling Architecture Overview</h2>
<pre class="mermaid align-center ">flowchart TB
    subgraph &#34;Load Balancer Layer&#34;
        LB[Load Balancer]
        HEALTH[Health Checker]
    end
    
    subgraph &#34;Agent Instances&#34;
        AGENT1[Agent Instance 1]
        AGENT2[Agent Instance 2]
        AGENT3[Agent Instance 3]
        AGENTN[Agent Instance N]
    end
    
    subgraph &#34;Shared Resources&#34;
        REDIS[Redis Cache]
        POSTGRES[PostgreSQL]
        VECTOR[Vector DB]
        MCP[MCP Servers]
    end
    
    subgraph &#34;Monitoring&#34;
        METRICS[Metrics Collector]
        ALERTS[Alert Manager]
    end
    
    CLIENT[Client Requests] --&gt; LB
    LB --&gt; AGENT1
    LB --&gt; AGENT2
    LB --&gt; AGENT3
    LB --&gt; AGENTN
    
    HEALTH --&gt; AGENT1
    HEALTH --&gt; AGENT2
    HEALTH --&gt; AGENT3
    HEALTH --&gt; AGENTN
    
    AGENT1 --&gt; REDIS
    AGENT2 --&gt; REDIS
    AGENT3 --&gt; REDIS
    AGENTN --&gt; REDIS
    
    AGENT1 --&gt; POSTGRES
    AGENT2 --&gt; POSTGRES
    AGENT3 --&gt; POSTGRES
    AGENTN --&gt; POSTGRES
    
    AGENT1 --&gt; VECTOR
    AGENT2 --&gt; VECTOR
    AGENT3 --&gt; VECTOR
    AGENTN --&gt; VECTOR
    
    AGENT1 --&gt; MCP
    AGENT2 --&gt; MCP
    AGENT3 --&gt; MCP
    AGENTN --&gt; MCP
    
    AGENT1 --&gt; METRICS
    AGENT2 --&gt; METRICS
    AGENT3 --&gt; METRICS
    AGENTN --&gt; METRICS
    
    METRICS --&gt; ALERTS
    
    classDef lb fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef agent fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef shared fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef monitor fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    
    class LB,HEALTH lb
    class AGENT1,AGENT2,AGENT3,AGENTN agent
    class REDIS,POSTGRES,VECTOR,MCP shared
    class METRICS,ALERTS monitor</pre>
<h2 id="-load-balancing-strategies">⚖️ Load Balancing Strategies</h2>
<h3 id="1-round-robin-load-balancing"><strong>1. Round Robin Load Balancing</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">balancer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;sync&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;sync/atomic&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;github.com/kunalkushwaha/agenticgokit/core&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RoundRobinBalancer</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">agents</span>  []<span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">counter</span> <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mu</span>      <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewRoundRobinBalancer</span>(<span style="color:#a6e22e">agents</span> []<span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">RoundRobinBalancer</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">RoundRobinBalancer</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">agents</span>: <span style="color:#a6e22e">agents</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">rb</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">RoundRobinBalancer</span>) <span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">event</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">Event</span>, <span style="color:#a6e22e">state</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentResult</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">rb</span>.<span style="color:#a6e22e">agents</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;no agents available&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Get next agent in round-robin fashion</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">index</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">atomic</span>.<span style="color:#a6e22e">AddInt64</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">rb</span>.<span style="color:#a6e22e">counter</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> int64(len(<span style="color:#a6e22e">rb</span>.<span style="color:#a6e22e">agents</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">agent</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rb</span>.<span style="color:#a6e22e">agents</span>[<span style="color:#a6e22e">index</span>]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">state</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">rb</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">RoundRobinBalancer</span>) <span style="color:#a6e22e">AddAgent</span>(<span style="color:#a6e22e">agent</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">rb</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Lock</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">rb</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Unlock</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">rb</span>.<span style="color:#a6e22e">agents</span> = append(<span style="color:#a6e22e">rb</span>.<span style="color:#a6e22e">agents</span>, <span style="color:#a6e22e">agent</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">rb</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">RoundRobinBalancer</span>) <span style="color:#a6e22e">RemoveAgent</span>(<span style="color:#a6e22e">index</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">rb</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Lock</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">rb</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Unlock</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">index</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">index</span> &lt; len(<span style="color:#a6e22e">rb</span>.<span style="color:#a6e22e">agents</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">rb</span>.<span style="color:#a6e22e">agents</span> = append(<span style="color:#a6e22e">rb</span>.<span style="color:#a6e22e">agents</span>[:<span style="color:#a6e22e">index</span>], <span style="color:#a6e22e">rb</span>.<span style="color:#a6e22e">agents</span>[<span style="color:#a6e22e">index</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>:]<span style="color:#f92672">...</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="2-weighted-load-balancing"><strong>2. Weighted Load Balancing</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">WeightedBalancer</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">agents</span>  []<span style="color:#a6e22e">WeightedAgent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">totalWeight</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mu</span>      <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">WeightedAgent</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Agent</span>  <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Weight</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">CurrentWeight</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewWeightedBalancer</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">WeightedBalancer</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">WeightedBalancer</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">agents</span>: make([]<span style="color:#a6e22e">WeightedAgent</span>, <span style="color:#ae81ff">0</span>),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">wb</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">WeightedBalancer</span>) <span style="color:#a6e22e">AddAgent</span>(<span style="color:#a6e22e">agent</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span>, <span style="color:#a6e22e">weight</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wb</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Lock</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wb</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Unlock</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wb</span>.<span style="color:#a6e22e">agents</span> = append(<span style="color:#a6e22e">wb</span>.<span style="color:#a6e22e">agents</span>, <span style="color:#a6e22e">WeightedAgent</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Agent</span>:  <span style="color:#a6e22e">agent</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Weight</span>: <span style="color:#a6e22e">weight</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">CurrentWeight</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wb</span>.<span style="color:#a6e22e">totalWeight</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">weight</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">wb</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">WeightedBalancer</span>) <span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">event</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">Event</span>, <span style="color:#a6e22e">state</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentResult</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wb</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Lock</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wb</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Unlock</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">wb</span>.<span style="color:#a6e22e">agents</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;no agents available&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Weighted round-robin algorithm</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">selected</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">wb</span>.<span style="color:#a6e22e">selectAgent</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">selected</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;no agent selected&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">selected</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">state</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">wb</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">WeightedBalancer</span>) <span style="color:#a6e22e">selectAgent</span>() <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">selected</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">WeightedAgent</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">wb</span>.<span style="color:#a6e22e">agents</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">agent</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">wb</span>.<span style="color:#a6e22e">agents</span>[<span style="color:#a6e22e">i</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">CurrentWeight</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">Weight</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">selected</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">CurrentWeight</span> &gt; <span style="color:#a6e22e">selected</span>.<span style="color:#a6e22e">CurrentWeight</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">selected</span> = <span style="color:#a6e22e">agent</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">selected</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">selected</span>.<span style="color:#a6e22e">CurrentWeight</span> <span style="color:#f92672">-=</span> <span style="color:#a6e22e">wb</span>.<span style="color:#a6e22e">totalWeight</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">selected</span>.<span style="color:#a6e22e">Agent</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="3-least-connections-load-balancing"><strong>3. Least Connections Load Balancing</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">LeastConnectionsBalancer</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">agents</span> []<span style="color:#a6e22e">ConnectionTrackingAgent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mu</span>     <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">ConnectionTrackingAgent</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Agent</span>       <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Connections</span> <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mu</span>          <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewLeastConnectionsBalancer</span>(<span style="color:#a6e22e">agents</span> []<span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">LeastConnectionsBalancer</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">trackingAgents</span> <span style="color:#f92672">:=</span> make([]<span style="color:#a6e22e">ConnectionTrackingAgent</span>, len(<span style="color:#a6e22e">agents</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">agent</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">agents</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">trackingAgents</span>[<span style="color:#a6e22e">i</span>] = <span style="color:#a6e22e">ConnectionTrackingAgent</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Agent</span>: <span style="color:#a6e22e">agent</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">LeastConnectionsBalancer</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">agents</span>: <span style="color:#a6e22e">trackingAgents</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">lcb</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">LeastConnectionsBalancer</span>) <span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">event</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">Event</span>, <span style="color:#a6e22e">state</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentResult</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">agent</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">lcb</span>.<span style="color:#a6e22e">selectLeastConnectedAgent</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">agent</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;no agents available&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Increment connection count</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">atomic</span>.<span style="color:#a6e22e">AddInt64</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">Connections</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">atomic</span>.<span style="color:#a6e22e">AddInt64</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">Connections</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">Agent</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">state</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">lcb</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">LeastConnectionsBalancer</span>) <span style="color:#a6e22e">selectLeastConnectedAgent</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">ConnectionTrackingAgent</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lcb</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">RLock</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">lcb</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">RUnlock</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">lcb</span>.<span style="color:#a6e22e">agents</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">selected</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ConnectionTrackingAgent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">minConnections</span> <span style="color:#f92672">:=</span> int64(^uint64(<span style="color:#ae81ff">0</span>) <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>) <span style="color:#75715e">// Max int64</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">lcb</span>.<span style="color:#a6e22e">agents</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">agent</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">lcb</span>.<span style="color:#a6e22e">agents</span>[<span style="color:#a6e22e">i</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">connections</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">atomic</span>.<span style="color:#a6e22e">LoadInt64</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">Connections</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">connections</span> &lt; <span style="color:#a6e22e">minConnections</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">minConnections</span> = <span style="color:#a6e22e">connections</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">selected</span> = <span style="color:#a6e22e">agent</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">selected</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="4-performance-based-load-balancing"><strong>4. Performance-Based Load Balancing</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">PerformanceBasedBalancer</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">agents</span> []<span style="color:#a6e22e">PerformanceTrackingAgent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mu</span>     <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">PerformanceTrackingAgent</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Agent</span>           <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ResponseTimes</span>   []<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">SuccessRate</span>     <span style="color:#66d9ef">float64</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">LastUpdate</span>      <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mu</span>              <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewPerformanceBasedBalancer</span>(<span style="color:#a6e22e">agents</span> []<span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">PerformanceBasedBalancer</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">trackingAgents</span> <span style="color:#f92672">:=</span> make([]<span style="color:#a6e22e">PerformanceTrackingAgent</span>, len(<span style="color:#a6e22e">agents</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">agent</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">agents</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">trackingAgents</span>[<span style="color:#a6e22e">i</span>] = <span style="color:#a6e22e">PerformanceTrackingAgent</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Agent</span>:         <span style="color:#a6e22e">agent</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">ResponseTimes</span>: make([]<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">100</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">SuccessRate</span>:   <span style="color:#ae81ff">1.0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">LastUpdate</span>:    <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>(),
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">PerformanceBasedBalancer</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">agents</span>: <span style="color:#a6e22e">trackingAgents</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">pbb</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PerformanceBasedBalancer</span>) <span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">event</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">Event</span>, <span style="color:#a6e22e">state</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentResult</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">agent</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">pbb</span>.<span style="color:#a6e22e">selectBestPerformingAgent</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">agent</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;no agents available&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">start</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">Agent</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">state</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">duration</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Since</span>(<span style="color:#a6e22e">start</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Record performance metrics</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pbb</span>.<span style="color:#a6e22e">recordPerformance</span>(<span style="color:#a6e22e">agent</span>, <span style="color:#a6e22e">duration</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">pbb</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PerformanceBasedBalancer</span>) <span style="color:#a6e22e">selectBestPerformingAgent</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">PerformanceTrackingAgent</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pbb</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">RLock</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">pbb</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">RUnlock</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">pbb</span>.<span style="color:#a6e22e">agents</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">selected</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PerformanceTrackingAgent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">bestScore</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1.0</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">pbb</span>.<span style="color:#a6e22e">agents</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">agent</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pbb</span>.<span style="color:#a6e22e">agents</span>[<span style="color:#a6e22e">i</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">score</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">pbb</span>.<span style="color:#a6e22e">calculatePerformanceScore</span>(<span style="color:#a6e22e">agent</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">score</span> &gt; <span style="color:#a6e22e">bestScore</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">bestScore</span> = <span style="color:#a6e22e">score</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">selected</span> = <span style="color:#a6e22e">agent</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">selected</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">pbb</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PerformanceBasedBalancer</span>) <span style="color:#a6e22e">calculatePerformanceScore</span>(<span style="color:#a6e22e">agent</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PerformanceTrackingAgent</span>) <span style="color:#66d9ef">float64</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">RLock</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">RUnlock</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Calculate average response time</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">avgResponseTime</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">ResponseTimes</span>) &gt; <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">total</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">rt</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">ResponseTimes</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">total</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">rt</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">avgResponseTime</span> = <span style="color:#a6e22e">total</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>(len(<span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">ResponseTimes</span>))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Normalize response time (lower is better)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">responseTimeScore</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">1.0</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">avgResponseTime</span>.<span style="color:#a6e22e">Seconds</span>())
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Combine success rate and response time</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (<span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">SuccessRate</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.7</span>) <span style="color:#f92672">+</span> (<span style="color:#a6e22e">responseTimeScore</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.3</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">pbb</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PerformanceBasedBalancer</span>) <span style="color:#a6e22e">recordPerformance</span>(<span style="color:#a6e22e">agent</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PerformanceTrackingAgent</span>, <span style="color:#a6e22e">duration</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>, <span style="color:#a6e22e">success</span> <span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Lock</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Unlock</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Record response time</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">ResponseTimes</span> = append(<span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">ResponseTimes</span>, <span style="color:#a6e22e">duration</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">ResponseTimes</span>) &gt; <span style="color:#ae81ff">100</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">ResponseTimes</span> = <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">ResponseTimes</span>[<span style="color:#ae81ff">1</span>:]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Update success rate (exponential moving average)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">alpha</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">success</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">SuccessRate</span> = <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">SuccessRate</span><span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">alpha</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">alpha</span>
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">SuccessRate</span> = <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">SuccessRate</span> <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">alpha</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">LastUpdate</span> = <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="-horizontal-scaling-patterns">🔄 Horizontal Scaling Patterns</h2>
<h3 id="1-stateless-agent-design"><strong>1. Stateless Agent Design</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Stateless agent that can be scaled horizontally</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">StatelessAgent</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span>        <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">llmProvider</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">ModelProvider</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">cache</span>       <span style="color:#a6e22e">CacheProvider</span>    <span style="color:#75715e">// Shared cache</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">memory</span>      <span style="color:#a6e22e">MemoryProvider</span>   <span style="color:#75715e">// Shared memory</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewStatelessAgent</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">provider</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">ModelProvider</span>, <span style="color:#a6e22e">cache</span> <span style="color:#a6e22e">CacheProvider</span>, <span style="color:#a6e22e">memory</span> <span style="color:#a6e22e">MemoryProvider</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">StatelessAgent</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">StatelessAgent</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span>:        <span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">llmProvider</span>: <span style="color:#a6e22e">provider</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cache</span>:       <span style="color:#a6e22e">cache</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">memory</span>:      <span style="color:#a6e22e">memory</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">sa</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">StatelessAgent</span>) <span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">event</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">Event</span>, <span style="color:#a6e22e">state</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentResult</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// All state is passed in or retrieved from shared resources</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// No local state that would prevent horizontal scaling</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Get context from shared memory</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">context</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sa</span>.<span style="color:#a6e22e">memory</span>.<span style="color:#a6e22e">GetContext</span>(<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">SessionID</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Check shared cache</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">cacheKey</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sa</span>.<span style="color:#a6e22e">generateCacheKey</span>(<span style="color:#a6e22e">event</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">cached</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sa</span>.<span style="color:#a6e22e">cache</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#a6e22e">cacheKey</span>); <span style="color:#a6e22e">cached</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">cached</span>.(<span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentResult</span>), <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Process request</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sa</span>.<span style="color:#a6e22e">processRequest</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">context</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Store in shared cache</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sa</span>.<span style="color:#a6e22e">cache</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">cacheKey</span>, <span style="color:#a6e22e">result</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">*</span><span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Minute</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">sa</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">StatelessAgent</span>) <span style="color:#a6e22e">generateCacheKey</span>(<span style="color:#a6e22e">event</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">Event</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%s:%s:%x&#34;</span>, <span style="color:#a6e22e">sa</span>.<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">Type</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sha256</span>.<span style="color:#a6e22e">Sum256</span>([]byte(<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%v&#34;</span>, <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">Data</span>))))
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="2-auto-scaling-controller"><strong>2. Auto-Scaling Controller</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">AutoScaler</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">minInstances</span>    <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">maxInstances</span>    <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">currentInstances</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">targetCPU</span>       <span style="color:#66d9ef">float64</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">targetMemory</span>    <span style="color:#66d9ef">float64</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scaleUpCooldown</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scaleDownCooldown</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lastScaleAction</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">metrics</span>         <span style="color:#a6e22e">MetricsProvider</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">orchestrator</span>    <span style="color:#a6e22e">Orchestrator</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mu</span>              <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewAutoScaler</span>(<span style="color:#a6e22e">min</span>, <span style="color:#a6e22e">max</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">orchestrator</span> <span style="color:#a6e22e">Orchestrator</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">AutoScaler</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">AutoScaler</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">minInstances</span>:      <span style="color:#a6e22e">min</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">maxInstances</span>:      <span style="color:#a6e22e">max</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">currentInstances</span>:  <span style="color:#a6e22e">min</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">targetCPU</span>:         <span style="color:#ae81ff">70.0</span>, <span style="color:#75715e">// 70% CPU utilization</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">targetMemory</span>:      <span style="color:#ae81ff">80.0</span>, <span style="color:#75715e">// 80% memory utilization</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">scaleUpCooldown</span>:   <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Minute</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">scaleDownCooldown</span>: <span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Minute</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">orchestrator</span>:      <span style="color:#a6e22e">orchestrator</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">as</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">AutoScaler</span>) <span style="color:#a6e22e">Start</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ticker</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">NewTicker</span>(<span style="color:#ae81ff">30</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">ticker</span>.<span style="color:#a6e22e">Stop</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">select</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">ticker</span>.<span style="color:#a6e22e">C</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">evaluateScaling</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">Done</span>():
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">as</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">AutoScaler</span>) <span style="color:#a6e22e">evaluateScaling</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Lock</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Unlock</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Get current metrics</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">cpuUsage</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">metrics</span>.<span style="color:#a6e22e">GetCPUUsage</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">memoryUsage</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">metrics</span>.<span style="color:#a6e22e">GetMemoryUsage</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">requestRate</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">metrics</span>.<span style="color:#a6e22e">GetRequestRate</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Determine if scaling is needed</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">shouldScaleUp</span> <span style="color:#f92672">:=</span> (<span style="color:#a6e22e">cpuUsage</span> &gt; <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">targetCPU</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">memoryUsage</span> &gt; <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">targetMemory</span>) <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">currentInstances</span> &lt; <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">maxInstances</span> <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Since</span>(<span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">lastScaleAction</span>) &gt; <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">scaleUpCooldown</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">shouldScaleDown</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cpuUsage</span> &lt; <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">targetCPU</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0.5</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">memoryUsage</span> &lt; <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">targetMemory</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0.5</span> <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>                       <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">currentInstances</span> &gt; <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">minInstances</span> <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>                       <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Since</span>(<span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">lastScaleAction</span>) &gt; <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">scaleDownCooldown</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">shouldScaleUp</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">scaleUp</span>()
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">shouldScaleDown</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">scaleDown</span>()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">as</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">AutoScaler</span>) <span style="color:#a6e22e">scaleUp</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">newInstances</span> <span style="color:#f92672">:=</span> min(<span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">currentInstances</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">maxInstances</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">newInstances</span> &gt; <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">currentInstances</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">orchestrator</span>.<span style="color:#a6e22e">AddInstance</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">currentInstances</span> = <span style="color:#a6e22e">newInstances</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">lastScaleAction</span> = <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Scaled up to %d instances&#34;</span>, <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">currentInstances</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">as</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">AutoScaler</span>) <span style="color:#a6e22e">scaleDown</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">newInstances</span> <span style="color:#f92672">:=</span> max(<span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">currentInstances</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">minInstances</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">newInstances</span> &lt; <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">currentInstances</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">orchestrator</span>.<span style="color:#a6e22e">RemoveInstance</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">currentInstances</span> = <span style="color:#a6e22e">newInstances</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">lastScaleAction</span> = <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Scaled down to %d instances&#34;</span>, <span style="color:#a6e22e">as</span>.<span style="color:#a6e22e">currentInstances</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="3-health-aware-load-balancing"><strong>3. Health-Aware Load Balancing</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">HealthAwareBalancer</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">agents</span>      []<span style="color:#a6e22e">HealthTrackingAgent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">healthCheck</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mu</span>          <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">HealthTrackingAgent</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Agent</span>     <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Healthy</span>   <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">LastCheck</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Endpoint</span>  <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewHealthAwareBalancer</span>(<span style="color:#a6e22e">agents</span> []<span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">HealthAwareBalancer</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">trackingAgents</span> <span style="color:#f92672">:=</span> make([]<span style="color:#a6e22e">HealthTrackingAgent</span>, len(<span style="color:#a6e22e">agents</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">agent</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">agents</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">trackingAgents</span>[<span style="color:#a6e22e">i</span>] = <span style="color:#a6e22e">HealthTrackingAgent</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Agent</span>:   <span style="color:#a6e22e">agent</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Healthy</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hab</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">HealthAwareBalancer</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">agents</span>:      <span style="color:#a6e22e">trackingAgents</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">healthCheck</span>: <span style="color:#ae81ff">30</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Start health checking</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">go</span> <span style="color:#a6e22e">hab</span>.<span style="color:#a6e22e">startHealthChecking</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hab</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">hab</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">HealthAwareBalancer</span>) <span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">event</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">Event</span>, <span style="color:#a6e22e">state</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentResult</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">healthyAgents</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">hab</span>.<span style="color:#a6e22e">getHealthyAgents</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">healthyAgents</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;no healthy agents available&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Use round-robin among healthy agents</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">index</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Intn</span>(len(<span style="color:#a6e22e">healthyAgents</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">healthyAgents</span>[<span style="color:#a6e22e">index</span>].<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">state</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">hab</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">HealthAwareBalancer</span>) <span style="color:#a6e22e">getHealthyAgents</span>() []<span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hab</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">RLock</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">hab</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">RUnlock</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">healthy</span> []<span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">AgentHandler</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">agent</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">hab</span>.<span style="color:#a6e22e">agents</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">Healthy</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">healthy</span> = append(<span style="color:#a6e22e">healthy</span>, <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">Agent</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">healthy</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">hab</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">HealthAwareBalancer</span>) <span style="color:#a6e22e">startHealthChecking</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ticker</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">NewTicker</span>(<span style="color:#a6e22e">hab</span>.<span style="color:#a6e22e">healthCheck</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">ticker</span>.<span style="color:#a6e22e">Stop</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">ticker</span>.<span style="color:#a6e22e">C</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">hab</span>.<span style="color:#a6e22e">checkHealth</span>()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">hab</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">HealthAwareBalancer</span>) <span style="color:#a6e22e">checkHealth</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hab</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Lock</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">hab</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Unlock</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">hab</span>.<span style="color:#a6e22e">agents</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">agent</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">hab</span>.<span style="color:#a6e22e">agents</span>[<span style="color:#a6e22e">i</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Perform health check</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">healthy</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">hab</span>.<span style="color:#a6e22e">performHealthCheck</span>(<span style="color:#a6e22e">agent</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">Healthy</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">healthy</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">Healthy</span> = <span style="color:#a6e22e">healthy</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">healthy</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Agent %d is now healthy&#34;</span>, <span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Agent %d is now unhealthy&#34;</span>, <span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">LastCheck</span> = <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">hab</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">HealthAwareBalancer</span>) <span style="color:#a6e22e">performHealthCheck</span>(<span style="color:#a6e22e">agent</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">HealthTrackingAgent</span>) <span style="color:#66d9ef">bool</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Simple health check - try to execute a test request</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">cancel</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">WithTimeout</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#ae81ff">5</span><span style="color:#f92672">*</span><span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">cancel</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">testEvent</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">NewEvent</span>(<span style="color:#e6db74">&#34;health_check&#34;</span>, <span style="color:#e6db74">&#34;ping&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">testState</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">State</span>{}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">agent</span>.<span style="color:#a6e22e">Agent</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">testEvent</span>, <span style="color:#a6e22e">testState</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="-container-orchestration">🐳 Container Orchestration</h2>
<h3 id="docker-compose-for-development"><strong>Docker Compose for Development</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># docker-compose.yml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3.8&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">agent-1</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">build</span>: <span style="color:#ae81ff">.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">INSTANCE_ID=1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">REDIS_URL=redis://redis:6379</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">POSTGRES_URL=postgres://user:pass@postgres:5432/agentflow</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">redis</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">postgres</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">deploy</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cpus</span>: <span style="color:#e6db74">&#39;0.5&#39;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">512M</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">reservations</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cpus</span>: <span style="color:#e6db74">&#39;0.25&#39;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">256M</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">agent-2</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">build</span>: <span style="color:#ae81ff">.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">INSTANCE_ID=2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">REDIS_URL=redis://redis:6379</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">POSTGRES_URL=postgres://user:pass@postgres:5432/agentflow</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">redis</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">postgres</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">deploy</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cpus</span>: <span style="color:#e6db74">&#39;0.5&#39;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">512M</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">agent-3</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">build</span>: <span style="color:#ae81ff">.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">INSTANCE_ID=3</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">REDIS_URL=redis://redis:6379</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">POSTGRES_URL=postgres://user:pass@postgres:5432/agentflow</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">redis</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">postgres</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nginx</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:alpine</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;80:80&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./nginx.conf:/etc/nginx/nginx.conf</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">agent-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">agent-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">agent-3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">redis</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">redis:7-alpine</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">redis_data:/data</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">postgres</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">pgvector/pgvector:pg15</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">POSTGRES_DB</span>: <span style="color:#ae81ff">agentflow</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">POSTGRES_USER</span>: <span style="color:#ae81ff">user</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">POSTGRES_PASSWORD</span>: <span style="color:#ae81ff">pass</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">postgres_data:/var/lib/postgresql/data</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">redis_data</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">postgres_data:</span></span></span></code></pre></div>
<h3 id="kubernetes-deployment"><strong>Kubernetes Deployment</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># k8s/deployment.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">agenticgokit-agents</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">agenticgokit-agents</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">agenticgokit-agents</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">agent</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">agenticgokit:latest</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">REDIS_URL</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;redis://redis-service:6379&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">POSTGRES_URL</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">valueFrom</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">secretKeyRef</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">name</span>: <span style="color:#ae81ff">db-secret</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">key</span>: <span style="color:#ae81ff">postgres-url</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;256Mi&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;250m&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;512Mi&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;500m&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">httpGet</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/health</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">readinessProbe</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">httpGet</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/ready</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">agenticgokit-service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">agenticgokit-agents</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">LoadBalancer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">autoscaling/v2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">HorizontalPodAutoscaler</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">agenticgokit-hpa</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">scaleTargetRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">agenticgokit-agents</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">minReplicas</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">maxReplicas</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">metrics</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Resource</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resource</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cpu</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">target</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Utilization</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">averageUtilization</span>: <span style="color:#ae81ff">70</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Resource</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resource</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">memory</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">target</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Utilization</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">averageUtilization</span>: <span style="color:#ae81ff">80</span></span></span></code></pre></div>
<h2 id="-performance-monitoring">📊 Performance Monitoring</h2>
<h3 id="load-balancer-metrics"><strong>Load Balancer Metrics</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">LoadBalancerMetrics</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">totalRequests</span>     <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">requestsPerAgent</span>  <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">responseTimesByAgent</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>][]<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">errorsByAgent</span>     <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mu</span>                <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewLoadBalancerMetrics</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">LoadBalancerMetrics</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">LoadBalancerMetrics</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">requestsPerAgent</span>:     make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">int64</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">responseTimesByAgent</span>: make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>][]<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">errorsByAgent</span>:        make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">int64</span>),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">lbm</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">LoadBalancerMetrics</span>) <span style="color:#a6e22e">RecordRequest</span>(<span style="color:#a6e22e">agentID</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">duration</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>, <span style="color:#a6e22e">success</span> <span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Lock</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Unlock</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">totalRequests</span><span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">requestsPerAgent</span>[<span style="color:#a6e22e">agentID</span>]<span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Record response time</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">responseTimesByAgent</span>[<span style="color:#a6e22e">agentID</span>] <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">responseTimesByAgent</span>[<span style="color:#a6e22e">agentID</span>] = make([]<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">responseTimesByAgent</span>[<span style="color:#a6e22e">agentID</span>] = append(<span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">responseTimesByAgent</span>[<span style="color:#a6e22e">agentID</span>], <span style="color:#a6e22e">duration</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Keep only recent response times</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">responseTimesByAgent</span>[<span style="color:#a6e22e">agentID</span>]) &gt; <span style="color:#ae81ff">100</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">responseTimesByAgent</span>[<span style="color:#a6e22e">agentID</span>] = <span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">responseTimesByAgent</span>[<span style="color:#a6e22e">agentID</span>][<span style="color:#ae81ff">1</span>:]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Record errors</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">success</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">errorsByAgent</span>[<span style="color:#a6e22e">agentID</span>]<span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">lbm</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">LoadBalancerMetrics</span>) <span style="color:#a6e22e">GetStats</span>() <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{} {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">RLock</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">RUnlock</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">stats</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;total_requests&#34;</span>: <span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">totalRequests</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;agents&#34;</span>: make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">agentID</span>, <span style="color:#a6e22e">requests</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">requestsPerAgent</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">agentStats</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;requests&#34;</span>: <span style="color:#a6e22e">requests</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;errors&#34;</span>:   <span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">errorsByAgent</span>[<span style="color:#a6e22e">agentID</span>],
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Calculate average response time</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">responseTimes</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">lbm</span>.<span style="color:#a6e22e">responseTimesByAgent</span>[<span style="color:#a6e22e">agentID</span>]; len(<span style="color:#a6e22e">responseTimes</span>) &gt; <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">total</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">rt</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">responseTimes</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">total</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">rt</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">agentStats</span>[<span style="color:#e6db74">&#34;avg_response_time&#34;</span>] = <span style="color:#a6e22e">total</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>(len(<span style="color:#a6e22e">responseTimes</span>))
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">stats</span>[<span style="color:#e6db74">&#34;agents&#34;</span>].(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{})[<span style="color:#a6e22e">agentID</span>] = <span style="color:#a6e22e">agentStats</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">stats</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="-best-practices">🎯 Best Practices</h2>
<h3 id="1-configuration-for-scaling"><strong>1. Configuration for Scaling</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span><span style="color:#75715e"># agentflow.toml - Production scaling configuration</span>
</span></span><span style="display:flex;"><span>[<span style="color:#a6e22e">runtime</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">max_concurrent_agents</span> = <span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">timeout_seconds</span> = <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">enable_metrics</span> = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">metrics_port</span> = <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#a6e22e">load_balancer</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">strategy</span> = <span style="color:#e6db74">&#34;performance_based&#34;</span>  <span style="color:#75715e"># round_robin, weighted, least_connections, performance_based</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">health_check_interval</span> = <span style="color:#e6db74">&#34;30s&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">unhealthy_threshold</span> = <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">healthy_threshold</span> = <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#a6e22e">scaling</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">min_instances</span> = <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">max_instances</span> = <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">target_cpu_utilization</span> = <span style="color:#ae81ff">70</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">target_memory_utilization</span> = <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">scale_up_cooldown</span> = <span style="color:#e6db74">&#34;2m&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">scale_down_cooldown</span> = <span style="color:#e6db74">&#34;5m&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#a6e22e">shared_resources</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">redis_url</span> = <span style="color:#e6db74">&#34;${REDIS_URL}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">postgres_url</span> = <span style="color:#e6db74">&#34;${POSTGRES_URL}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">vector_db_url</span> = <span style="color:#e6db74">&#34;${VECTOR_DB_URL}&#34;</span></span></span></code></pre></div>
<h3 id="2-health-check-implementation"><strong>2. Health Check Implementation</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">a</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ScalableAgent</span>) <span style="color:#a6e22e">HealthCheck</span>() <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{} {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">health</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;status&#34;</span>: <span style="color:#e6db74">&#34;healthy&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;timestamp&#34;</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">Format</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">RFC3339</span>),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Check LLM provider</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">checkLLMProvider</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">health</span>[<span style="color:#e6db74">&#34;status&#34;</span>] = <span style="color:#e6db74">&#34;unhealthy&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">health</span>[<span style="color:#e6db74">&#34;llm_provider_error&#34;</span>] = <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Check shared cache</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">checkCache</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">health</span>[<span style="color:#e6db74">&#34;status&#34;</span>] = <span style="color:#e6db74">&#34;degraded&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">health</span>[<span style="color:#e6db74">&#34;cache_error&#34;</span>] = <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Check memory system</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">checkMemory</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">health</span>[<span style="color:#e6db74">&#34;status&#34;</span>] = <span style="color:#e6db74">&#34;degraded&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">health</span>[<span style="color:#e6db74">&#34;memory_error&#34;</span>] = <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Add performance metrics</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">health</span>[<span style="color:#e6db74">&#34;metrics&#34;</span>] = <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;requests_per_minute&#34;</span>: <span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">getRequestsPerMinute</span>(),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;avg_response_time&#34;</span>:   <span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">getAverageResponseTime</span>(),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;error_rate&#34;</span>:          <span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">getErrorRate</span>(),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">health</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="3-graceful-shutdown"><strong>3. Graceful Shutdown</strong></h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">a</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ScalableAgent</span>) <span style="color:#a6e22e">GracefulShutdown</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Starting graceful shutdown...&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Stop accepting new requests</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">stopAcceptingRequests</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Wait for ongoing requests to complete</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">done</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">struct</span>{})
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">waitForOngoingRequests</span>()
</span></span><span style="display:flex;"><span>        close(<span style="color:#a6e22e">done</span>)
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">select</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">done</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;All requests completed&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">Done</span>():
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Shutdown timeout reached, forcing shutdown&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Clean up resources</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">cleanup</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Graceful shutdown completed&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Load balancing and scaling are essential for building production-ready agent systems that can handle varying loads efficiently and maintain high availability.</p>
<h2 id="-next-steps">🚀 Next Steps</h2>
<ul>
<li><strong><a href="/AgenticGoKitDocs/tutorials/advanced/testing-strategies/index.html">Testing Strategies</a></strong> - Test your scaled agent systems</li>
<li><strong><a href="/AgenticGoKitDocs/tutorials/advanced/circuit-breaker-patterns/index.html">Circuit Breaker Patterns</a></strong> - Add fault tolerance to scaled systems</li>
<li><strong><a href="../debugging/performance-monitoring.md">Production Monitoring</a></strong> - Monitor your scaled deployments</li>
<li><strong><a href="/AgenticGoKitDocs/tutorials/getting-started/production-deployment/index.html">Production Deployment</a></strong> - Deploy your scaled systems</li>
</ul>

  <footer class="footline">
              <i class='fa-fw fas fa-calendar'></i> Jul 25, 2025
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          <a id="R-logo" class="R-default" href="/AgenticGoKitDocs/index.html">
            <div class="logo-title">AgenticGoKit Docs</div>
          </a>
        </div>
        <search><form action="/AgenticGoKitDocs/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks">
          <ul class="space collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/index.html"><a class="padding" href="/AgenticGoKitDocs/index.html"><i class="fa-fw fas fa-home"></i> Home</a></li>
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/readme/index.html">content</a></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/guides/index.html"><input type="checkbox" id="R-section-8fc2fd7736125e87cab8840a86c2af5a" aria-controls="R-subsections-8fc2fd7736125e87cab8840a86c2af5a" checked><label for="R-section-8fc2fd7736125e87cab8840a86c2af5a"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu guides</span></label><a class="padding" href="/AgenticGoKitDocs/guides/index.html">guides</a><ul id="R-subsections-8fc2fd7736125e87cab8840a86c2af5a" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/readme/index.html">guides</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/agentbasics/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/agentbasics/index.html">AgentBasics</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/examples/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/examples/index.html">Examples</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/configuration/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/configuration/index.html">Configuration</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/customtools/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/customtools/index.html">CustomTools</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/providers/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/providers/index.html">Providers</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/memoryprovidersetup/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/memoryprovidersetup/index.html">MemoryProviderSetup</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/memorytroubleshooting/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/memorytroubleshooting/index.html">MemoryTroubleshooting</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/embeddingmodelguide/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/embeddingmodelguide/index.html">EmbeddingModelGuide</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/ragconfiguration/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/ragconfiguration/index.html">RAGConfiguration</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/toolintegration/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/toolintegration/index.html">ToolIntegration</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/pgvectorsetup/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/pgvectorsetup/index.html">PgVectorSetup</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/weaviatesetup/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/weaviatesetup/index.html">WeaviateSetup</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/performance/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/performance/index.html">Performance</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/errorhandling/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/errorhandling/index.html">ErrorHandling</a></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/guides/deployment/index.html"><input type="checkbox" id="R-section-ecc839349395ef3c015a12132049dff2" aria-controls="R-subsections-ecc839349395ef3c015a12132049dff2" checked><label for="R-section-ecc839349395ef3c015a12132049dff2"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu deployment</span></label><a class="padding" href="/AgenticGoKitDocs/guides/deployment/index.html">deployment</a><ul id="R-subsections-ecc839349395ef3c015a12132049dff2" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/deployment/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/deployment/readme/index.html">deployment</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/guides/development/index.html"><input type="checkbox" id="R-section-fff1f5eca5d0a93209b9c6262762c25a" aria-controls="R-subsections-fff1f5eca5d0a93209b9c6262762c25a" checked><label for="R-section-fff1f5eca5d0a93209b9c6262762c25a"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu development</span></label><a class="padding" href="/AgenticGoKitDocs/guides/development/index.html">development</a><ul id="R-subsections-fff1f5eca5d0a93209b9c6262762c25a" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/development/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/development/readme/index.html">development</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/development/best-practices/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/development/best-practices/index.html">best-practices</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/development/debugging/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/development/debugging/index.html">debugging</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/development/research-assistant/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/development/research-assistant/index.html">research-assistant</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/development/testing-agents/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/development/testing-agents/index.html">testing-agents</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/development/visualization/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/development/visualization/index.html">visualization</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/development/web-search-integration/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/development/web-search-integration/index.html">web-search-integration</a></li></ul></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/framework-comparison/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/framework-comparison/index.html">framework-comparison</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/memory/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/memory/index.html">Memory</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/scaffoldmemoryguide/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/scaffoldmemoryguide/index.html">ScaffoldMemoryGuide</a></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/guides/setup/index.html"><input type="checkbox" id="R-section-0124aed9abb5064d53391168f3c95c22" aria-controls="R-subsections-0124aed9abb5064d53391168f3c95c22" checked><label for="R-section-0124aed9abb5064d53391168f3c95c22"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu setup</span></label><a class="padding" href="/AgenticGoKitDocs/guides/setup/index.html">setup</a><ul id="R-subsections-0124aed9abb5064d53391168f3c95c22" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/setup/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/setup/readme/index.html">setup</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/setup/llm-providers/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/setup/llm-providers/index.html">llm-providers</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/setup/mcp-tools/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/setup/mcp-tools/index.html">mcp-tools</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/setup/orchestration-configuration/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/setup/orchestration-configuration/index.html">orchestration-configuration</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/setup/vector-databases/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/setup/vector-databases/index.html">vector-databases</a></li></ul></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/guides/troubleshooting/index.html"><a class="padding" href="/AgenticGoKitDocs/guides/troubleshooting/index.html">troubleshooting</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/contributors/index.html"><input type="checkbox" id="R-section-190d9b328fbda7e13ab386f7a5417de5" aria-controls="R-subsections-190d9b328fbda7e13ab386f7a5417de5" checked><label for="R-section-190d9b328fbda7e13ab386f7a5417de5"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu contributors</span></label><a class="padding" href="/AgenticGoKitDocs/contributors/index.html">contributors</a><ul id="R-subsections-190d9b328fbda7e13ab386f7a5417de5" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/contributors/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/contributors/readme/index.html">contributors</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/contributors/contributorguide/index.html"><a class="padding" href="/AgenticGoKitDocs/contributors/contributorguide/index.html">ContributorGuide</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/contributors/codestyle/index.html"><a class="padding" href="/AgenticGoKitDocs/contributors/codestyle/index.html">CodeStyle</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/contributors/corevsinternal/index.html"><a class="padding" href="/AgenticGoKitDocs/contributors/corevsinternal/index.html">CoreVsInternal</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/contributors/addingfeatures/index.html"><a class="padding" href="/AgenticGoKitDocs/contributors/addingfeatures/index.html">AddingFeatures</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/contributors/testing/index.html"><a class="padding" href="/AgenticGoKitDocs/contributors/testing/index.html">Testing</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/contributors/docsstandards/index.html"><a class="padding" href="/AgenticGoKitDocs/contributors/docsstandards/index.html">DocsStandards</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/reference/index.html"><input type="checkbox" id="R-section-66002f201bef818664bb81aa67490c58" aria-controls="R-subsections-66002f201bef818664bb81aa67490c58" checked><label for="R-section-66002f201bef818664bb81aa67490c58"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu reference</span></label><a class="padding" href="/AgenticGoKitDocs/reference/index.html">reference</a><ul id="R-subsections-66002f201bef818664bb81aa67490c58" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/reference/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/reference/readme/index.html">reference</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/reference/api/configuration/index.html"><a class="padding" href="/AgenticGoKitDocs/reference/api/configuration/index.html">configuration</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/reference/cli/index.html"><a class="padding" href="/AgenticGoKitDocs/reference/cli/index.html">cli</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/reference/api/mcp/index.html"><a class="padding" href="/AgenticGoKitDocs/reference/api/mcp/index.html">mcp</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/reference/api/agent/index.html"><a class="padding" href="/AgenticGoKitDocs/reference/api/agent/index.html">agent</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/reference/api/memory/index.html"><a class="padding" href="/AgenticGoKitDocs/reference/api/memory/index.html">memory</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/reference/api/orchestration/index.html"><a class="padding" href="/AgenticGoKitDocs/reference/api/orchestration/index.html">orchestration</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/reference/api/state-event/index.html"><a class="padding" href="/AgenticGoKitDocs/reference/api/state-event/index.html">state-event</a></li></ul></li>
            <li class="parent alwaysopen " data-nav-id="/AgenticGoKitDocs/tutorials/index.html"><input type="checkbox" id="R-section-e1e8c1e70c5500b49e8dda2dc550651a" aria-controls="R-subsections-e1e8c1e70c5500b49e8dda2dc550651a" checked><label for="R-section-e1e8c1e70c5500b49e8dda2dc550651a"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu tutorials</span></label><a class="padding" href="/AgenticGoKitDocs/tutorials/index.html">tutorials</a><ul id="R-subsections-e1e8c1e70c5500b49e8dda2dc550651a" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/readme/index.html">tutorials</a></li>
            <li class="parent alwaysopen " data-nav-id="/AgenticGoKitDocs/tutorials/advanced/index.html"><input type="checkbox" id="R-section-d3def5cd76adc8096d0ff9fda6b8e479" aria-controls="R-subsections-d3def5cd76adc8096d0ff9fda6b8e479" checked><label for="R-section-d3def5cd76adc8096d0ff9fda6b8e479"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu advanced</span></label><a class="padding" href="/AgenticGoKitDocs/tutorials/advanced/index.html">advanced</a><ul id="R-subsections-d3def5cd76adc8096d0ff9fda6b8e479" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/advanced/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/advanced/readme/index.html">advanced</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/advanced/circuit-breaker-patterns/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/advanced/circuit-breaker-patterns/index.html">circuit-breaker-patterns</a></li>
            <li class="active " data-nav-id="/AgenticGoKitDocs/tutorials/advanced/load-balancing-scaling/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/advanced/load-balancing-scaling/index.html">load-balancing-scaling</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/advanced/retry-policies/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/advanced/retry-policies/index.html">retry-policies</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/advanced/testing-strategies/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/advanced/testing-strategies/index.html">testing-strategies</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/tutorials/core-concepts/index.html"><input type="checkbox" id="R-section-212c6ccffb40ecdd78eb2136f98c4cac" aria-controls="R-subsections-212c6ccffb40ecdd78eb2136f98c4cac" checked><label for="R-section-212c6ccffb40ecdd78eb2136f98c4cac"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu core-concepts</span></label><a class="padding" href="/AgenticGoKitDocs/tutorials/core-concepts/index.html">core-concepts</a><ul id="R-subsections-212c6ccffb40ecdd78eb2136f98c4cac" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/core-concepts/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/core-concepts/readme/index.html">core-concepts</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/core-concepts/agent-lifecycle/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/core-concepts/agent-lifecycle/index.html">agent-lifecycle</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/core-concepts/error-handling/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/core-concepts/error-handling/index.html">error-handling</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/core-concepts/message-passing/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/core-concepts/message-passing/index.html">message-passing</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/core-concepts/orchestration-patterns/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/core-concepts/orchestration-patterns/index.html">orchestration-patterns</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/core-concepts/state-management/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/core-concepts/state-management/index.html">state-management</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/tutorials/debugging/index.html"><input type="checkbox" id="R-section-d8dfe6eec6c6d4cb6f6f50bdd07fa3cc" aria-controls="R-subsections-d8dfe6eec6c6d4cb6f6f50bdd07fa3cc" checked><label for="R-section-d8dfe6eec6c6d4cb6f6f50bdd07fa3cc"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu debugging</span></label><a class="padding" href="/AgenticGoKitDocs/tutorials/debugging/index.html">debugging</a><ul id="R-subsections-d8dfe6eec6c6d4cb6f6f50bdd07fa3cc" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/debugging/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/debugging/readme/index.html">debugging</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/debugging/debugging-multi-agent-systems/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/debugging/debugging-multi-agent-systems/index.html">debugging-multi-agent-systems</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/debugging/logging-and-tracing/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/debugging/logging-and-tracing/index.html">logging-and-tracing</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/tutorials/getting-started/index.html"><input type="checkbox" id="R-section-e7f904c8b9d0f9bf1f07ca7d482d2247" aria-controls="R-subsections-e7f904c8b9d0f9bf1f07ca7d482d2247" checked><label for="R-section-e7f904c8b9d0f9bf1f07ca7d482d2247"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu getting-started</span></label><a class="padding" href="/AgenticGoKitDocs/tutorials/getting-started/index.html">getting-started</a><ul id="R-subsections-e7f904c8b9d0f9bf1f07ca7d482d2247" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/getting-started/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/getting-started/readme/index.html">getting-started</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/getting-started/memory-and-rag/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/getting-started/memory-and-rag/index.html">memory-and-rag</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/getting-started/multi-agent-collaboration/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/getting-started/multi-agent-collaboration/index.html">multi-agent-collaboration</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/getting-started/production-deployment/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/getting-started/production-deployment/index.html">production-deployment</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/getting-started/quickstart/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/getting-started/quickstart/index.html">quickstart</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/getting-started/tool-integration/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/getting-started/tool-integration/index.html">tool-integration</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/getting-started/your-first-agent/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/getting-started/your-first-agent/index.html">your-first-agent</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/tutorials/mcp/index.html"><input type="checkbox" id="R-section-153aac44598009a99dd5a60317a3eecc" aria-controls="R-subsections-153aac44598009a99dd5a60317a3eecc" checked><label for="R-section-153aac44598009a99dd5a60317a3eecc"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu mcp</span></label><a class="padding" href="/AgenticGoKitDocs/tutorials/mcp/index.html">mcp</a><ul id="R-subsections-153aac44598009a99dd5a60317a3eecc" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/mcp/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/mcp/readme/index.html">mcp</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/mcp/advanced-tool-patterns/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/mcp/advanced-tool-patterns/index.html">advanced-tool-patterns</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/mcp/tool-development/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/mcp/tool-development/index.html">tool-development</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/mcp/tool-integration/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/mcp/tool-integration/index.html">tool-integration</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/AgenticGoKitDocs/tutorials/memory-systems/index.html"><input type="checkbox" id="R-section-9c1a65f2d7b3888241dcafa51a0710e7" aria-controls="R-subsections-9c1a65f2d7b3888241dcafa51a0710e7" checked><label for="R-section-9c1a65f2d7b3888241dcafa51a0710e7"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu memory-systems</span></label><a class="padding" href="/AgenticGoKitDocs/tutorials/memory-systems/index.html">memory-systems</a><ul id="R-subsections-9c1a65f2d7b3888241dcafa51a0710e7" class="collapsible-menu">
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/memory-systems/readme/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/memory-systems/readme/index.html">memory-systems</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/memory-systems/basic-memory/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/memory-systems/basic-memory/index.html">basic-memory</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/memory-systems/document-ingestion/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/memory-systems/document-ingestion/index.html">document-ingestion</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/memory-systems/knowledge-bases/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/memory-systems/knowledge-bases/index.html">knowledge-bases</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/memory-systems/memory-optimization/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/memory-systems/memory-optimization/index.html">memory-optimization</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/memory-systems/rag-implementation/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/memory-systems/rag-implementation/index.html">rag-implementation</a></li>
            <li class="" data-nav-id="/AgenticGoKitDocs/tutorials/memory-systems/vector-databases/index.html"><a class="padding" href="/AgenticGoKitDocs/tutorials/memory-systems/vector-databases/index.html">vector-databases</a></li></ul></li></ul></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div id="R-footer-margin"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols">
          <ul class="">
          </ul>
        </div>
<div id="R-footer"><p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p></div>
      </div>
    </aside>
    <script src="/AgenticGoKitDocs/js/js-yaml/js-yaml.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-color.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-dispatch.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-drag.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-ease.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-interpolate.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-selection.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-timer.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-transition.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/d3/d3-zoom.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/mermaid/mermaid.min.js?1753430931" defer></script>
    <script>
      window.relearn.themeUseMermaid = JSON.parse("{}");
    </script>
    <script src="/AgenticGoKitDocs/js/clipboard/clipboard.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/perfect-scrollbar/perfect-scrollbar.min.js?1753430931" defer></script>
    <script src="/AgenticGoKitDocs/js/theme.js?1753430931" defer></script>
  </body>
</html>
